<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>bAttle text-based game</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="icon" type="image/png" href="./theme_ico.png">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet" />

<style>
/* --- Início do Código CSS Original (Desktop) --- */
.buttonnn {
border: 2px solid #d4a761;
background-color: #d4a761 ;
}
#hpBar, #mpBar, #xpBar {
height: 16px;
background: #444;
border-radius: 8px;
overflow: hidden;
width: 150px;
}
:root {
--bg: #1a170f; --card: #1f1c14; --muted: #8a8a7c; --text: #f0e9d9; --accent: #d4a761; --accent2: #bfa33f; --danger: #bf6d3f; --ok: #a3bf3f;
}
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; font-family: Roboto, system-ui, -apple-system, Segoe UI, Arial; color: var(--text); background: radial-gradient(1200px 800px at 20% 10%, #252219, var(--bg)); }
#lutaSistema { display: flex; align-items: center; gap: 10px; padding: 10px; background: #2a2a25; border-radius: 12px; margin-bottom: 16px; }
#lutaSistema button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; background: #d4a761; font-weight: 700; }
#lutaSistema button:hover { filter: brightness(1.1); }
.grid { display: grid; grid-template-columns: 320px 1fr; gap: 16px; }
@media(max-width: 900px) { .grid { grid-template-columns: 1fr; } }
.panel { background: var(--card); border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); overflow: hidden; }
.panel h2, .panel h3 { margin: 0 0 8px; }
.pad { padding: 16px 18px; }
.title { display: flex; align-items: center; gap: 10px; font-size: 20px; font-weight: 700; }
.section { border-top: 1px solid #323025; margin-top: 12px; padding-top: 12px; }
.list { display: grid; gap: 10px; }
.stat { display: flex; justify-content: space-between; margin-top: 4px; }
.bar #hpBar span { background-color: green; }
.bar #xpBar span { background-color: blue; }
.bar #xpBar span { background-color: white; }
.bar { width: 150px; height: 16px; border-radius: 8px; overflow: hidden; margin-top: 4px; border: white }
#statusPanel .equip-slot { display: grid; grid-template-columns: 110px 1fr; gap: 8px; align-items: center; margin-bottom: 4px; }
#statusPanel span.equip { font-weight: bold; }
#enemyInfo { display: flex; align-items: center; gap: 12px; background: #2a2a25; padding: 10px; border-radius: 8px; margin-top: 8px; }
#enemyIcon { font-size: 30px; }
#notification { position: fixed; top: 20px; right: 20px; background-color: #d4a761; color: var(--bg); padding: 10px 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: opacity 0.5s ease-in-out; opacity: 0; z-index: 1000; }
/* --- Fim do Código CSS Original --- */

/* --- Início do Código Responsivo (Tema Egípcio) --- */
@media (max-width: 900px) {
:root {
  --bg: #2b261b; /* Fundo mais escuro */
  --card: #3f3929; /* Card de papiro */
  --muted: #c9c3ac; /* Texto sutil */
  --text: #fef8dd; /* Cor de areia */
  --accent: #e2b714; /* Dourado */
  --accent2: #b47f0e; /* Ouro antigo */
  --danger: #9c3c1e; /* Vermelho ferrugem */
  --ok: #3a8a3f; /* Verde antigo */
}

body {
  background: #2b261b;
  font-family: 'Times New Roman', serif;
  font-weight: 400;
}

/* Layout principal para mobile */
.grid {
  grid-template-columns: 1fr;
}

.panel {
  border-radius: 0;
  box-shadow: none;
  border: 2px solid var(--accent);
  border-left: none;
  border-right: none;
  background: var(--card);
}

.panel:first-of-type {
  border-top: none;
}

.pad {
  padding: 10px;
}

/* Estilo do título e pilhas */
.title {
  font-family: 'Papyrus', 'Georgia', serif;
  font-size: 24px;
  justify-content: center;
  margin-bottom: 15px;
  color: var(--accent);
}

.pill {
  background: var(--accent);
  color: var(--bg);
  border-radius: 4px;
  padding: 2px 6px;
  font-weight: bold;
  text-transform: uppercase;
}

/* Ajustes nas barras de status */
#hpBar, #mpBar, #xpBar {
  width: 100%;
}

#lutaSistema {
  flex-direction: column;
  align-items: stretch;
  padding: 10px;
  background: var(--card);
  border-radius: 0;
  border: 2px solid var(--accent);
  border-bottom: none;
  border-left: none;
  border-right: none;
}

#lutaSistema button {
  background: var(--accent);
  color: var(--bg);
  font-weight: 700;
  width: 100%;
  margin-top: 8px;
}

#enemyDisplay {
  flex-direction: column;
  align-items: center;
  text-align: center;
}

/* Itens da loja e inventário */
.item-entry {
  flex-direction: column;
  align-items: flex-start;
  gap: 5px;
}

.buttonnn {
  width: 100%;
  margin-top: 5px;
}

#inventory .buttonnn {
  width: auto;
  margin-top: 0;
  font-size: 14px;
  padding: 4px 8px;
}

#notification {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80%;
  text-align: center;
  background: var(--accent);
  color: var(--bg);
  border: 2px solid var(--accent2);
}
}
/* --- Fim do Código Responsivo --- */
</style>
</head>
<body>
<div class="container">

<div id="lutaSistema">
<button onclick="encontrarInimigo()">Encontrar Inimigo</button>
<div id="enemyDisplay" style="display:flex; align-items:center; gap:10px;">
<div id="enemyIcon">?</div>
<div>
<div id="enemyNome">Nenhum inimigo</div>
<div>HP: <span id="enemyHP">0/0</span> / <span id="enemyMaxHP">0</span></div>
</div>
<button id="btnAtacar" disabled onclick="atacar()">Atacar</button>
</div>
<a href= "cust_scene_getting_out.gif"><button id="btnSair" onclick="sairDoCombate()" style="background: #d4a761; font-weight: 700;">Sair</button></a>
</div>

<div class="grid">
<aside class="panel" id="statusPanel">
<div class="pad">
<div class="title">⚔️ bAttle <span class="pill" id="rankTag">Nv 1</span></div>

<div class="stat"><span>HP</span><span id="hpLabel">100/100</span></div>
<div class="bar"><span id="hpBar"></span></div>

<div class="stat"><span>MP</span><span id="mpLabel">30/30</span></div>
<div class="bar"><span id="mpBar"></span></div>

<div class="stat"><span>XP</span><span id="xpLabel">0 / 50</span></div>
<div class="bar"><span id="xpBar"></span></div>

<div class="row" style="margin-top:10px">
<span class="pill">ATQ <b id="atkVal">10</b></span>
<span class="pill">DEF <b id="defVal">5</b></span>
<span class="pill">CRIT <b id="critVal">3%</b></span>
<span class="pill">OURO <b id="goldVal">0</b></span>
</div>

<div class="section">
<h3>🎒 Inventário</h3>
<div id="inventory" class="list"></div>
<button id="btnUsarPocao" class="buttonnn" style="background: #a3bf3f; margin-top: 10px;" onclick="usarPocao()">Usar Poção</button>
</div>

<div class="section">
<h3>🧰 Equipamento</h3>
<div class="equip-slot"><span class="muted">Arma</span><span id="eq-weapon">Nenhuma</span></div>
<div class="equip-slot"><span class="muted">Off-hand</span><span id="eq-offhand">Nenhum</span></div>
<div class="equip-slot"><span class="muted">Amuleto</span><span id="eq-amulet">Nenhum</span></div>
</div>
</div>
</aside>

<main class="panel" id="shopPanel">
<div class="pad">
<h2>Loja</h2>
<div id="filterButtons" style="margin-bottom: 10px;">
<button class="buttonnn" style="background: #d4a761" onclick="ordenarItens('asc')">Ordenar por Menor Preço</button>
<button class="buttonnn" style="background: #d4a761;" onclick="ordenarItens('desc')">Ordenar por Maior Preço</button>
</div>
<div id="itensContainer"></div>

<div id="paginationControls" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
<button class="buttonnn" onclick="mudarPagina(-1)" disabled id="prevPageBtn">Anterior</button>
<span id="pageInfo">Página 1 de 100</span>
<button class="buttonnn" onclick="mudarPagina(1)" id="nextPageBtn">Próxima</button>
</div>

<h3>Comprar item</h3>
<p>Selecione um item para comprar e adicionar ao inventário.</p>
</div>
</main>
</div>

<div class="section" style="margin-top:20px;">
<h2>Lista Completa de 1000 Itens</h2>
<div id="todosItens"></div>
</div>

<div class="foot"> grind fácil até 10 · médio até 60 · XP reduzida no 100 · itens até 2.000.000 ouro</div>

<div id="notification"></div>
<button onclick="limparDados()" style="position:fixed; bottom:20px; right:20px; padding:8px 12px;">Limpar Dados</button>

<div id="videoContainer" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; display: none;">
    <video id="cutsceneVideo" src="./cust_scene_getting_out.mp4" style="width: 100%; height: 100%; object-fit: contain;"></video>
</div>
<script>
// ========================
// Geração de itens
function gerarItens() {
const itens = [];
const nomes = ['Espada', 'Adaga', 'Lança', 'Escudo', 'Amuleto', 'Armadura', 'Elmo', 'Broquel', 'Cajado', 'Chicote', 'Disco', 'Cetro', 'Garras', 'Foice', 'Martelo'];
const elems = ['Fogo', 'Água', 'Terra', 'Vento', 'Luz', 'Trevas', 'Veneno', 'Impacto', 'Raio', 'Neutro', 'Sagrado'];
for(let i=1; i<=1000; i++){
const tipoRand = Math.random();
let preco;
let tipo = '';
let isEquipavel = true;
let nomeItem;

// Proporção 3:2:1
if (tipoRand < 0.5) { // 50% - Itens baratos (1-100)
preco = Math.floor(Math.random() * 100) + 1;
const tiposEquip = ['equip', 'off', 'amu'];
tipo = tiposEquip[Math.floor(Math.random() * tiposEquip.length)];
nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
} else if (tipoRand < 0.833) { // 33.3% - Itens de preço médio (101-5000)
preco = Math.floor(Math.random() * 4900) + 101;
const tiposArma = ['arma', 'off', 'amu'];
tipo = tiposArma[Math.floor(Math.random() * tiposArma.length)];
nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
} else { // 16.7% - Itens caros (5001-5000000)
preco = Math.floor(Math.random() * 4995000) + 5001;
const tiposArma = ['arma', 'off', 'amu', 'equip'];
tipo = tiposArma[Math.floor(Math.random() * tiposArma.length)];
nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
}

const elem = elems[Math.floor(Math.random()*elems.length)];
let item = { id:'auto'+i, nome:`${nomeItem} #${i}`, preco:preco, tipo:tipo, isEquipavel:isEquipavel };

// Atributos baseados no preço (a raiz cúbica suaviza a progressão)
const statBase = Math.cbrt(preco);

if(tipo==='arma'){
item.min = Math.floor(statBase * 1.5) + 3;
item.max = item.min + Math.floor(statBase) + 1;
item.crit = Math.floor(statBase / 2) + 1;
item.vel = (Math.random()*0.5+0.5).toFixed(2);
item.elem = elem;
} else if(tipo==='off'){
item.def = Math.floor(statBase) + 2;
item.bloco = Math.floor(statBase * 1.5) + 10;
} else if(tipo==='amu'){
if(Math.random()<0.5) item.bonusHP = Math.floor(statBase * 4) + 10;
if(Math.random()<0.5) item.bonusCRIT = Math.floor(statBase / 3) + 1;
if(Math.random()<0.5) item.bonusMP = Math.floor(statBase * 2) + 5;
if(Math.random()<0.5) item.bonusATK = Math.floor(statBase / 2) + 1;
} else if(tipo==='equip'){
if(nomeItem==='Espada'){
item.min = Math.floor(statBase * 1.5) + 5;
item.max = item.min + Math.floor(statBase) + 5;
item.elem = elems[Math.floor(Math.random()*elems.length)];
} else if(nomeItem==='Escudo'){
item.def = Math.floor(statBase * 1.5) + 3;
item.bloco = Math.floor(statBase * 2) + 5;
} else if(nomeItem==='Armadura'){
item.def = Math.floor(statBase * 2) + 5;
} else if(nomeItem==='Elmo'){
item.def = Math.floor(statBase * 0.8) + 2;
}
}
itens.push(item);
}
return itens;
}
const ITEMS = gerarItens();

// Variável para itens ordenados na loja
let itensOrdenados = [...ITEMS];
let paginaAtual = 1;
const ITENS_POR_PAGINA = 10;

// ========================
// Herói
let heroi = {
nome:'Herói',
lv:1,
hp:100,
maxHp:100,
mp:30,
maxMp:30,
xp:0,
gold:0,
atk:10,
def:5,
crit:3,
elem:'Neutro',
inventory:[],
equipWeapon:null,
equipOffhand:null,
equipAmulet:null
};

// Itens iniciais
const itemInicialArma = { id:'arma_inicial', nome:'Espada de Treino', preco:0, tipo:'arma', isEquipavel:true, min:5, max:10, crit:2, vel:1.0, elem:'Neutro' };
const itemInicialPocao = { id:'pocao_inicial', nome:'Poção de Cura', preco:0, tipo:'consum', isEquipavel:false, heal: 100 };

// Inimigo atual
let inimigoAtual = null;

// Lista de inimigos e chefes
const ENEMIES = [
{ nome:'Esqueleto', hp:50, atk:8, def:2, icon:'💀', gold:[10,20], drops:[['Poção de Cura',0.3]] },
{ nome:'Múmia', hp:80, atk:12, def:4, icon:'🤕', gold:[20,50], drops:[['Poção de Cura',0.4]] },
{ nome:'Faraó Fantasma', hp:120, atk:20, def:6, icon:'👻', gold:[50,100], drops:[['Poção de Cura',0.5]] }
];

const BOSSES = [
{ nome:'Lorde das Sombras', hp:500, atk:50, def:20, icon:'😈', gold:[500,1000], drops:[['Amuleto #990', 0.2]] },
{ nome:'Dragão Ancião', hp:800, atk:80, def:30, icon:'🐉', gold:[1000,2000], drops:[['Espada #995', 0.2]] },
{ nome:'Guerreiro Amaldiçoado', hp:600, atk:60, def:25, icon:'👹', gold:[700,1500], drops:[['Elmo #980', 0.2]] }
];

const nomesExtras = ['Lobisomem', 'Gárgula', 'Dragão Pequeno', 'Goblin', 'Orc', 'Troll', 'Basilisco', 'Vampiro', 'Serpente Gigante', 'Manticora', 'Hidra', 'Súcubo', 'Quimera', 'Lamia', 'Harpia', 'Fênix', 'Minotauro', 'Espectro', 'Demonio', 'Verdadeiro Demônio', 'Lobo Sombrio', 'Esquilo Assassino', 'Rato Gigante', 'Aranha Mortal', 'Cobra Gigante', 'Leão Selvagem', 'Urso Selvagem', 'Lobo Polido', 'Saci', 'Bicho-Papão', 'Cuca', 'Sereia', 'Sirene', 'Naga'];
for(let i=0; i<396; i++){
const nomeAleatorio = nomesExtras[Math.floor(Math.random()*nomesExtras.length)];
const hpBase=40+Math.floor(Math.random()*30);
const atkBase=6+Math.floor(Math.random()*6);
const defBase=2+Math.floor(Math.random()*3);
const goldMin=5+Math.floor(Math.random()*10);
const goldMax=goldMin+Math.floor(Math.random()*10);
ENEMIES.push({ nome:nomeAleatorio, hp:hpBase, atk:atkBase, def:defBase, icon:'👹', gold:[goldMin,goldMax], drops:[['Poção de Cura',0.2+Math.random()*0.3]] });
}

// ========================
// Funções para salvar e carregar
function salvarNoLocalStorage() {
localStorage.setItem('gameState', JSON.stringify(heroi));
}
function carregarDoLocalStorage() {
const data = localStorage.getItem('gameState');
if (data) {
const p = JSON.parse(data);
Object.assign(heroi, p);
recalcularStatus(); // Recalcula status baseados nos equipamentos carregados
}
}

// Função para limpar todos os dados do jogo
function limparDados() {
localStorage.clear();
location.reload();
}

// ========================
// Mostrar itens na loja com paginação
function mostrarItens() {
const container = document.getElementById('itensContainer');
container.innerHTML = '';

const inicio = (paginaAtual - 1) * ITENS_POR_PAGINA;
const fim = inicio + ITENS_POR_PAGINA;
const itensNaPagina = itensOrdenados.slice(inicio, fim);

for(let item of itensNaPagina){
container.innerHTML += `<div class="item-entry" style="display:flex; justify-content:space-between; align-items:center; padding:4px; border-bottom:1px solid #555;">
<div class="item-info"><b>${item.nome}</b> (${item.tipo}) - PO ${item.preco.toLocaleString()}</div>
<button class="buttonnn" onclick="comprarItem('${item.id}')">Comprar</button>
</div>`;
}

// Atualiza os controles de paginação
document.getElementById('pageInfo').textContent = `Página ${paginaAtual} de ${Math.ceil(ITEMS.length / ITENS_POR_PAGINA)}`;
document.getElementById('prevPageBtn').disabled = paginaAtual === 1;
document.getElementById('nextPageBtn').disabled = paginaAtual === Math.ceil(ITEMS.length / ITENS_POR_PAGINA);
}

// Ordenar itens e resetar a página para a primeira
function ordenarItens(ordem) {
if(ordem==='asc'){
itensOrdenados = [...ITEMS].sort((a,b)=>a.preco-b.preco);
} else {
itensOrdenados = [...ITEMS].sort((a,b)=>b.preco-a.preco);
}
paginaAtual = 1; // Reseta para a primeira página ao ordenar
mostrarItens();
}

// Função para mudar a página
function mudarPagina(direcao) {
const totalPaginas = Math.ceil(ITEMS.length / ITENS_POR_PAGINA);
if (direcao === 1 && paginaAtual < totalPaginas) {
paginaAtual++;
} else if (direcao === -1 && paginaAtual > 1) {
paginaAtual--;
}
mostrarItens();
}

// Comprar item
function comprarItem(id) {
const item = ITEMS.find(i=>i.id===id);
if(!item) return;
if(heroi.gold < item.preco){
alert('Ouro insuficiente para comprar este item.');
return;
}
heroi.gold -= item.preco;
// Adiciona ao inventário
let invItem = heroi.inventory.find(i=>i.id===item.id);
if(invItem){
invItem.quantidade=(invItem.quantidade||1)+1;
} else {
heroi.inventory.push({ ...item, quantidade:1 });
}
alert(`Você comprou: ${item.nome}`);
atualizarInventario();
atualizarStatus();
}

// Atualizar inventário
function atualizarInventario() {
const div = document.getElementById('inventory');
div.innerHTML='';
heroi.inventory.forEach(i => {
let itemHtml = `<div>${i.nome} x${i.quantidade}`;
if (i.isEquipavel) {
itemHtml += ` <button class="buttonnn" style="background: #d4a761; font-size: 12px; padding: 2px 6px;" onclick="equiparItemDoInventario('${i.id}')">Equipar</button>`;
}
itemHtml += `</div>`;
div.innerHTML += itemHtml;
});
}

// Equipar itens do inventário
function equiparItemDoInventario(id) {
const itemIndex = heroi.inventory.findIndex(i => i.id === id);
if (itemIndex === -1) return;
const item = heroi.inventory[itemIndex];

let slotEquip = null;
if (item.tipo === 'arma') slotEquip = 'equipWeapon';
else if (item.tipo === 'off') slotEquip = 'equipOffhand';
else if (item.tipo === 'amu') slotEquip = 'equipAmulet';
else if (item.tipo === 'equip') slotEquip = 'equipWeapon'; // Assume equip vai para o slot de arma por padrão

if (!slotEquip) {
alert('Este item não pode ser equipado.');
return;
}

const itemRemovido = heroi[slotEquip];
heroi[slotEquip] = item;
heroi.inventory.splice(itemIndex, 1);

if (itemRemovido) {
heroi.inventory.push(itemRemovido);
alert(`Você removeu ${itemRemovido.nome} e equipou ${item.nome}.`);
} else {
alert(`Você equipou ${item.nome}.`);
}

recalcularStatus();
atualizarStatus();
}

// Usar Poção
function usarPocao() {
const pocaoIndex = heroi.inventory.findIndex(i => i.nome.includes('Poção') && i.tipo === 'consum');
if(pocaoIndex === -1){
alert('Você não tem poções de HP no inventário.');
return;
}
const pocao = heroi.inventory[pocaoIndex];
heroi.hp = heroi.maxHp;
pocao.quantidade--;
if(pocao.quantidade <= 0){
heroi.inventory.splice(pocaoIndex, 1);
}
alert(`Você usou uma poção e recuperou todo o seu HP.`);
atualizarStatus();
}

// ========================
// Funções de notificação
function mostrarNotificacao(mensagem) {
const notification = document.getElementById('notification');
notification.textContent = mensagem;
notification.style.opacity = '1';
setTimeout(() => {
notification.style.opacity = '0';
}, 3000);
}

// ========================
// Sistema de luta
// ========================

function encontrarInimigo() {
// Chance de encontrar um chefe
if (Math.random() < 0.05) { // 5% de chance
const boss = BOSSES[Math.floor(Math.random() * BOSSES.length)];
inimigoAtual = { ...boss };
inimigoAtual.hpMax = boss.hp;
mostrarNotificacao(`Um monstro muito forte apareceu: ${boss.nome}!`);
} else {
const inim = ENEMIES[Math.floor(Math.random() * ENEMIES.length)];
inimigoAtual = { ...inim };
inimigoAtual.hpMax = inim.hp;
}
document.getElementById('enemyIcon').textContent = inimigoAtual.icon;
document.getElementById('enemyNome').textContent = inimigoAtual.nome;
document.getElementById('enemyHP').textContent = `${inimigoAtual.hp}/${inimigoAtual.hp}`;
document.getElementById('enemyMaxHP').textContent = inimigoAtual.hp;
document.getElementById('btnAtacar').disabled = false;
document.getElementById('btnSair').disabled = false; // Habilita o Sair
}

// Função para sair do combate (ATUALIZADA)
function sairDoCombate() {
    if (!inimigoAtual) return;

    // 1. Oculta a interface do jogo (opcional, mas bom para focar no vídeo)
    document.querySelector('.container').style.display = 'none';
    document.getElementById('lutaSistema').style.display = 'none';

    // 2. Prepara e exibe o container do vídeo
    const videoContainer = document.getElementById('videoContainer');
    const cutsceneVideo = document.getElementById('cutsceneVideo');

    videoContainer.style.display = 'block';

    // 3. Define a ação ao finalizar o vídeo
    cutsceneVideo.onended = function() {
        // Tenta fechar a aba/janela (na maioria dos navegadores só funciona se for aberta pelo script)
        window.close();
        
        // Ou, uma alternativa mais confiável: reseta o jogo (simulando o "fechamento" para a página inicial)
        alert('O jogo será reiniciado. Fim da cutscene!');
        location.reload(); 
    };

    // 4. Inicia a reprodução
    // Nota: Navegadores modernos podem bloquear a reprodução automática.
    cutsceneVideo.play().catch(error => {
        // Caso o play seja bloqueado (comum em navegadores):
        alert('Falha ao iniciar a cutscene. Clique em OK para reiniciar o jogo.');
        location.reload();
    });
}


function atacar() {
if(!inimigoAtual) return;
// Dano do herói
let danoHerói = Math.max(1, Math.floor(heroi.atk * (1 + Math.random()*0.5))) - (inimigoAtual.def || 0);
if(danoHerói<1) danoHerói=1;
inimigoAtual.hp -= danoHerói;
if(inimigoAtual.hp<0) inimigoAtual.hp=0;
// Atualiza o HP do inimigo
document.getElementById('enemyHP').textContent = `${inimigoAtual.hp}/${inimigoAtual.hpMax}`;

alert(`Você causou ${danoHerói} de dano!`);

if(inimigoAtual.hp<=0){
alert(`Inimigo ${inimigoAtual.nome} derrotado!`);
const ouroGanhos = Math.floor(Math.random()*(inimigoAtual.gold[1]-inimigoAtual.gold[0]+1))+inimigoAtual.gold[0];
heroi.gold+=ouroGanhos;
const xpGanhos = 10+Math.floor(Math.random()*10);
heroi.xp+=xpGanhos;
alert(`Ganhou ${ouroGanhos} ouro e ${xpGanhos} XP!`);

// Drop de item raro (somente se for um boss)
if (inimigoAtual.drops && inimigoAtual.drops.length > 0) {
for(const [itemName, dropChance] of inimigoAtual.drops){
if (Math.random() < dropChance) {
const itemDrop = ITEMS.find(i => i.nome === itemName);
if (itemDrop) {
let invItem = heroi.inventory.find(i=>i.id===itemDrop.id);
if(invItem){
invItem.quantidade=(invItem.quantidade||1)+1;
} else {
heroi.inventory.push({ ...itemDrop, quantidade:1 });
}
mostrarNotificacao(`Você recebeu um item raro: ${itemDrop.nome}!`);
}
}
}
}

// Subir de nível
const xpNecessaria=heroi.lv*50;
if(heroi.xp>=xpNecessaria) {
heroi.lv++;
heroi.xp-=xpNecessaria;
heroi.maxHp+=10;
heroi.hp=heroi.maxHp;
heroi.maxMp+=5;
heroi.mp=heroi.maxMp;
alert(`Parabéns! Você subiu para o nível ${heroi.lv}!`);
}
atualizarInventario();
atualizarStatus();
salvarNoLocalStorage(); // salva após ganhar xp e subir de nível

// reset inimigo
inimigoAtual=null;
document.getElementById('enemyIcon').textContent='?';
document.getElementById('enemyNome').textContent='Nenhum inimigo';
document.getElementById('enemyHP').textContent='0/0';
document.getElementById('enemyMaxHP').textContent='0';
document.getElementById('btnAtacar').disabled=true;
document.getElementById('btnSair').disabled = true; // Desabilita o Sair
return;
}

// Inimigo ataca
const danoInimigo = Math.max(0, inimigoAtual.atk - heroi.def);
heroi.hp -= danoInimigo;
if(heroi.hp<0) heroi.hp=0;
alert(`${inimigoAtual.nome} causou ${danoInimigo} de dano em você!`);
if(heroi.hp<=0){
alert('Você morreu! O personagem foi resetado.');
resetHerói();
}
atualizarStatus();
salvarNoLocalStorage(); // salva após ataque
}

function resetHerói() {
heroi.hp=heroi.maxHp;
heroi.mp=heroi.maxMp;
heroi.xp=0;
heroi.gold=0;
heroi.inventory = [{ ...itemInicialArma, quantidade: 1 }]; // Reseta com item inicial
heroi.inventory.push({ ...itemInicialPocao, quantidade: 1 });
heroi.equipWeapon=null;
heroi.equipOffhand=null;
heroi.equipAmulet=null;
recalcularStatus();
salvarNoLocalStorage(); // salva o reset
}

// Recalcular status do herói com base nos equipamentos
function recalcularStatus() {
// Status base
heroi.atk = 10;
heroi.def = 5;
heroi.crit = 3;
heroi.maxHp = 100 + (heroi.lv - 1) * 10; // Mantém o bônus de nível
heroi.maxMp = 30 + (heroi.lv - 1) * 5; // Mantém o bônus de nível

// Adiciona status dos equipamentos
if (heroi.equipWeapon) {
heroi.atk += heroi.equipWeapon.min || 0;
heroi.crit += heroi.equipWeapon.crit || 0;
}
if (heroi.equipOffhand) {
heroi.def += heroi.equipOffhand.def || 0;
}
if (heroi.equipAmulet) {
heroi.maxHp += heroi.equipAmulet.bonusHP || 0;
heroi.maxMp += heroi.equipAmulet.bonusMP || 0;
heroi.crit += heroi.equipAmulet.bonusCRIT || 0;
heroi.atk += heroi.equipAmulet.bonusATK || 0;
}
}

// ========================
// Inicializa a loja ao carregar
// ========================
mostrarItens();

// ========================
// Atualiza a UI
// ========================
function atualizarStatus() {
document.getElementById('hpLabel').textContent = `${heroi.hp}/${heroi.maxHp}`;
document.getElementById('hpBar').style.width = (heroi.hp / heroi.maxHp * 100) + '%';

document.getElementById('mpLabel').textContent = `${heroi.mp}/${heroi.maxMp}`;
document.getElementById('mpBar').style.width = (heroi.mp / heroi.maxMp * 100) + '%';

const xpNecessaria=heroi.lv*50;
document.getElementById('xpLabel').textContent = `${heroi.xp} / ${xpNecessaria}`;
document.getElementById('xpBar').style.width = (heroi.xp / xpNecessaria * 100) + '%';

document.getElementById('rankTag').textContent = `Nv ${heroi.lv}`;
document.getElementById('goldVal').textContent = heroi.gold;
document.getElementById('atkVal').textContent=heroi.atk;
document.getElementById('defVal').textContent=heroi.def;
document.getElementById('critVal').textContent=heroi.crit+'%';

// Atualiza equipamentos na UI
document.getElementById('eq-weapon').textContent=heroi.equipWeapon?heroi.equipWeapon.nome:'Nenhuma';
document.getElementById('eq-offhand').textContent=heroi.equipOffhand?heroi.equipOffhand.nome:'Nenhum';
document.getElementById('eq-amulet').textContent=heroi.equipAmulet?heroi.equipAmulet.nome:'Nenhum';

// Atualiza inventário
atualizarInventario();

// Salva toda vez que atualiza
salvarNoLocalStorage();
}

// ========================
// Carregar o estado salvo ao iniciar
// ========================
if(heroi.inventory.length === 0) {
heroi.inventory.push({ ...itemInicialArma, quantidade: 1 });
heroi.inventory.push({ ...itemInicialPocao, quantidade: 1 });
}
carregarDoLocalStorage();
atualizarStatus();
</script>
</body>
</html>
