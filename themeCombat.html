<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>bAttle text-based game</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="icon" type="image/png" href="./theme_ico.png">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet" />

<style>
/* --- In√≠cio do C√≥digo CSS Original (Desktop) --- */
.buttonnn {
border: 2px solid #d4a761;
background-color: #d4a761 ;
}
#hpBar, #mpBar, #xpBar {
height: 16px;
background: #444;
border-radius: 8px;
overflow: hidden;
width: 150px;
}
:root {
--bg: #1a170f; --card: #1f1c14; --muted: #8a8a7c; --text: #f0e9d9; --accent: #d4a761; --accent2: #bfa33f; --danger: #bf6d3f; --ok: #a3bf3f;
}
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; font-family: Roboto, system-ui, -apple-system, Segoe UI, Arial; color: var(--text); background: radial-gradient(1200px 800px at 20% 10%, #252219, var(--bg)); }
#lutaSistema { display: flex; align-items: center; gap: 10px; padding: 10px; background: #2a2a25; border-radius: 12px; margin-bottom: 16px; }
#lutaSistema button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; background: #d4a761; font-weight: 700; }
#lutaSistema button:hover { filter: brightness(1.1); }
.grid { display: grid; grid-template-columns: 320px 1fr; gap: 16px; }
@media(max-width: 900px) { .grid { grid-template-columns: 1fr; } }
.panel { background: var(--card); border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); overflow: hidden; }
.panel h2, .panel h3 { margin: 0 0 8px; }
.pad { padding: 16px 18px; }
.title { display: flex; align-items: center; gap: 10px; font-size: 20px; font-weight: 700; }
.section { border-top: 1px solid #323025; margin-top: 12px; padding-top: 12px; }
.list { display: grid; gap: 10px; }
.stat { display: flex; justify-content: space-between; margin-top: 4px; }
.bar #hpBar span { background-color: green; }
.bar #xpBar span { background-color: blue; }
.bar #xpBar span { background-color: white; }
.bar { width: 150px; height: 16px; border-radius: 8px; overflow: hidden; margin-top: 4px; border: white }
#statusPanel .equip-slot { display: grid; grid-template-columns: 110px 1fr; gap: 8px; align-items: center; margin-bottom: 4px; }
#statusPanel span.equip { font-weight: bold; }
#enemyInfo { display: flex; align-items: center; gap: 12px; background: #2a2a25; padding: 10px; border-radius: 8px; margin-top: 8px; }
#enemyIcon { font-size: 30px; }
#notification { position: fixed; top: 20px; right: 20px; background-color: #d4a761; color: var(--bg); padding: 10px 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: opacity 0.5s ease-in-out; opacity: 0; z-index: 1000; }
/* --- Fim do C√≥digo CSS Original --- */

/* --- Estilos para o Filtro de Pesquisa --- */
.search-container {
    position: relative;
    width: 38%;
    margin-left: auto;
}

.search-input {
    width: 100%;
    padding: 10px 15px;
    background: var(--bg);
    border: 2px solid var(--accent);
    border-radius: 8px;
    color: var(--text);
    font-size: 14px;
    outline: none;
}

.search-input::placeholder {
    color: var(--muted);
}

.search-input:focus {
    border-color: var(--accent2);
    box-shadow: 0 0 5px var(--accent);
}

.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--card);
    border: 2px solid var(--accent);
    border-top: none;
    border-radius: 0 0 8px 8px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    display: none;
}

.search-result-item {
    padding: 10px 15px;
    border-bottom: 1px solid #323025;
    cursor: pointer;
    transition: background 0.2s;
}

.search-result-item:hover {
    background: var(--accent);
    color: var(--bg);
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-name {
    font-weight: bold;
    margin-bottom: 5px;
}

.search-result-stats {
    font-size: 12px;
    color: var(--muted);
}

.search-result-item:hover .search-result-stats {
    color: var(--bg);
}

/* --- Estilos para o Sistema de Backup --- */
.backup-section {
    border-top: 1px solid #323025;
    margin-top: 12px;
    padding-top: 12px;
}

.backup-controls {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 12px;
}

.backup-btn {
    padding: 8px 12px;
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
}

.backup-btn:hover {
    background: var(--accent2);
    transform: translateY(-1px);
}

.backup-btn.delete {
    background: var(--danger);
    font-size: 12px;
    padding: 4px 8px;
}

.backup-btn.delete:hover {
    background: #9a5530;
}

.backup-btn.danger {
    background: var(--danger);
    color: white;
}

.backup-btn.danger:hover {
    background: #9a5530;
}

.backup-list {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #323025;
    border-radius: 6px;
    padding: 8px;
    background: rgba(0, 0, 0, 0.2);
}

.backup-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 8px;
    margin-bottom: 6px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    border-left: 3px solid var(--accent);
}

.backup-item:last-child {
    margin-bottom: 0;
}

.backup-item-info {
    flex: 1;
}

.backup-item-name {
    font-weight: bold;
    font-size: 14px;
}

.backup-item-details {
    font-size: 11px;
    color: var(--muted);
    display: flex;
    gap: 10px;
}

.backup-item-actions {
    display: flex;
    gap: 6px;
}

.backup-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
}

.backup-modal.active {
    opacity: 1;
    visibility: visible;
}

.backup-modal-content {
    background: var(--card);
    border-radius: 12px;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    border: 2px solid var(--accent);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

.backup-modal h3 {
    margin-top: 0;
    color: var(--accent);
}

.backup-input {
    width: 100%;
    padding: 10px;
    background: var(--bg);
    border: 2px solid var(--accent);
    border-radius: 6px;
    color: var(--text);
    margin-bottom: 15px;
    font-size: 14px;
}

.backup-input:focus {
    outline: none;
    border-color: var(--accent2);
}

.backup-modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.backup-confirm-btn {
    padding: 8px 16px;
    background: var(--ok);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}

.backup-cancel-btn {
    padding: 8px 16px;
    background: var(--danger);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}

.backup-warning-btn {
    padding: 8px 16px;
    background: var(--danger);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}

.backup-confirm-btn:hover {
    background: #8aaf36;
}

.backup-cancel-btn:hover {
    background: #9a5530;
}

.backup-warning-btn:hover {
    background: #9a5530;
}

/* --- Modal de Confirma√ß√£o de Recome√ßo --- */
.confirm-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 3000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
}

.confirm-modal.active {
    opacity: 1;
    visibility: visible;
}

.confirm-modal-content {
    background: var(--card);
    border-radius: 12px;
    padding: 25px;
    width: 90%;
    max-width: 450px;
    border: 2px solid var(--danger);
    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    text-align: center;
}

.confirm-icon {
    font-size: 48px;
    color: var(--danger);
    margin-bottom: 15px;
}

.confirm-modal h3 {
    margin-top: 0;
    color: var(--danger);
    font-size: 22px;
}

.confirm-message {
    margin: 15px 0;
    color: var(--text);
    line-height: 1.5;
}

.confirm-details {
    background: rgba(191, 109, 63, 0.1);
    padding: 10px;
    border-radius: 6px;
    margin: 15px 0;
    border-left: 3px solid var(--danger);
}

.confirm-details p {
    margin: 5px 0;
    font-size: 14px;
}

.confirm-modal-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
}

.confirm-cancel-btn {
    padding: 10px 20px;
    background: var(--muted);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    flex: 1;
}

.confirm-proceed-btn {
    padding: 10px 20px;
    background: var(--danger);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    flex: 1;
}

.confirm-cancel-btn:hover {
    background: #6a6a5c;
}

.confirm-proceed-btn:hover {
    background: #9a5530;
}

.warning-text {
    color: var(--danger);
    font-weight: bold;
}

/* --- In√≠cio do C√≥digo Responsivo (Tema Eg√≠pcio) --- */
@media (max-width: 900px) {
:root {
  --bg: #2b261b; /* Fundo mais escuro */
  --card: #3f3929; /* Card de papiro */
  --muted: #c9c3ac; /* Texto sutil */
  --text: #fef8dd; /* Cor de areia */
  --accent: #e2b714; /* Dourado */
  --accent2: #b47f0e; /* Ouro antigo */
  --danger: #9c3c1e; /* Vermelho ferrugem */
  --ok: #3a8a3f; /* Verde antigo */
}

body {
  background: #2b261b;
  font-family: 'Times New Roman', serif;
  font-weight: 400;
}

/* Layout principal para mobile */
.grid {
  grid-template-columns: 1fr;
}

.panel {
  border-radius: 0;
  box-shadow: none;
  border: 2px solid var(--accent);
  border-left: none;
  border-right: none;
  background: var(--card);
}

.panel:first-of-type {
  border-top: none;
}

.pad {
  padding: 10px;
}

/* Estilo do t√≠tulo e pilhas */
.title {
  font-family: 'Papyrus', 'Georgia', serif;
  font-size: 24px;
  justify-content: center;
  margin-bottom: 15px;
  color: var(--accent);
}

.pill {
  background: var(--accent);
  color: var(--bg);
  border-radius: 4px;
  padding: 2px 6px;
  font-weight: bold;
  text-transform: uppercase;
}

/* Ajustes nas barras de status */
#hpBar, #mpBar, #xpBar {
  width: 100%;
}

#lutaSistema {
  flex-direction: column;
  align-items: stretch;
  padding: 10px;
  background: var(--card);
  border-radius: 0;
  border: 2px solid var(--accent);
  border-bottom: none;
  border-left: none;
  border-right: none;
}

#lutaSistema button {
  background: var(--accent);
  color: var(--bg);
  font-weight: 700;
  width: 100%;
  margin-top: 8px;
}

#enemyDisplay {
  flex-direction: column;
  align-items: center;
  text-align: center;
}

/* Itens da loja e invent√°rio */
.item-entry {
  flex-direction: column;
  align-items: flex-start;
  gap: 5px;
}

.buttonnn {
  width: 100%;
  margin-top: 5px;
}

#inventory .buttonnn {
  width: auto;
  margin-top: 0;
  font-size: 14px;
  padding: 4px 8px;
}

#notification {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80%;
  text-align: center;
  background: var(--accent);
  color: var(--bg);
  border: 2px solid var(--accent2);
}

/* Ajustes para o filtro em mobile */
.search-container {
    width: 100%;
    margin-left: 0;
    margin-bottom: 10px;
}

/* Ajustes para backup em mobile */
.backup-controls {
    flex-direction: column;
}

.backup-btn {
    width: 100%;
}

.backup-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
}

.backup-item-actions {
    width: 100%;
    justify-content: flex-end;
}

.backup-modal-content {
    width: 95%;
    padding: 15px;
}

.confirm-modal-content {
    width: 95%;
    padding: 20px;
}

.confirm-modal-buttons {
    flex-direction: column;
    gap: 10px;
}

.confirm-cancel-btn,
.confirm-proceed-btn {
    width: 100%;
}
}
/* --- Fim do C√≥digo Responsivo --- */
</style>
</head>
<body>
<div class="container">

<div id="lutaSistema">
<button onclick="encontrarInimigo()">Encontrar Inimigo</button>
<div id="enemyDisplay" style="display:flex; align-items:center; gap:10px;">
<div id="enemyIcon">?</div>
<div>
<div id="enemyNome">Nenhum inimigo</div>
<div>HP: <span id="enemyHP">0/0</span> / <span id="enemyMaxHP">0</span></div>
</div>
<button id="btnAtacar" disabled onclick="atacar()">Atacar</button>
</div>
<a href= "cust_scene_getting_out.gif"><button id="btnSair" onclick="sairDoCombate()" style="background: #d4a761; font-weight: 700;">Sair</button></a>
</div>

<div class="grid">
<aside class="panel" id="statusPanel">
<div class="pad">
<div class="title">‚öîÔ∏è bAttle <span class="pill" id="rankTag">Nv 1</span></div>

<div class="stat"><span>HP</span><span id="hpLabel">100/100</span></div>
<div class="bar"><span id="hpBar"></span></div>

<div class="stat"><span>MP</span><span id="mpLabel">30/30</span></div>
<div class="bar"><span id="mpBar"></span></div>

<div class="stat"><span>XP</span><span id="xpLabel">0 / 50</span></div>
<div class="bar"><span id="xpBar"></span></div>

<div class="row" style="margin-top:10px">
<span class="pill">ATQ <b id="atkVal">10</b></span>
<span class="pill">DEF <b id="defVal">5</b></span>
<span class="pill">CRIT <b id="critVal">3%</b></span>
<span class="pill">OURO <b id="goldVal">0</b></span>
</div>

<!-- Se√ß√£o de Backup -->
<div class="backup-section">
    <h3>üíæ Sistema de Backup</h3>
    <div class="backup-controls">
        <button class="backup-btn" onclick="criarBackup()">Criar Backup</button>
        <button class="backup-btn" onclick="exportarBackup()">Exportar Backup</button>
        <button class="backup-btn" onclick="importarBackup()">Importar Backup</button>
        <button class="backup-btn danger" onclick="mostrarConfirmacaoRecomecar()">Recome√ßar Jogo</button>
    </div>
    
    <div class="backup-list" id="backupList">
        <!-- Lista de backups ser√° carregada aqui -->
    </div>
</div>

<div class="section">
<h3>üéí Invent√°rio</h3>
<div id="inventory" class="list"></div>
<button id="btnUsarPocao" class="buttonnn" style="background: #a3bf3f; margin-top: 10px;" onclick="usarPocao()">Usar Po√ß√£o</button>
</div>

<div class="section">
<h3>üß∞ Equipamento</h3>
<div class="equip-slot"><span class="muted">Arma</span><span id="eq-weapon">Nenhuma</span></div>
<div class="equip-slot"><span class="muted">Off-hand</span><span id="eq-offhand">Nenhum</span></div>
<div class="equip-slot"><span class="muted">Amuleto</span><span id="eq-amulet">Nenhum</span></div>
</div>
</div>
</aside>

<main class="panel" id="shopPanel">
<div class="pad">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
    <h2 style="margin: 0;">Loja</h2>
    <div class="search-container">
        <input type="text" class="search-input" placeholder="Pesquisar itens..." id="searchInput">
        <div class="search-results" id="searchResults"></div>
    </div>
</div>

<div id="filterButtons" style="margin-bottom: 10px;">
<button class="buttonnn" style="background: #d4a761" onclick="ordenarItens('asc')">Ordenar por Menor Pre√ßo</button>
<button class="buttonnn" style="background: #d4a761;" onclick="ordenarItens('desc')">Ordenar por Maior Pre√ßo</button>
</div>
<div id="itensContainer"></div>

<div id="paginationControls" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
<button class="buttonnn" onclick="mudarPagina(-1)" disabled id="prevPageBtn">Anterior</button>
<span id="pageInfo">P√°gina 1 de 100</span>
<button class="buttonnn" onclick="mudarPagina(1)" id="nextPageBtn">Pr√≥xima</button>
</div>

<h3>Comprar item</h3>
<p>Selecione um item para comprar e adicionar ao invent√°rio.</p>
</div>
</main>
</div>

<div class="section" style="margin-top:20px;">
<h2>Lista Completa de 1000 Itens</h2>
<div id="todosItens"></div>
</div>

<div class="foot"> grind f√°cil at√© 10 ¬∑ m√©dio at√© 60 ¬∑ XP reduzida no 100 ¬∑ itens at√© 2.000.000 ouro</div>

<div id="notification"></div>

<div id="videoContainer" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; display: none;">
    <video id="cutsceneVideo" src="./cust_scene_getting_out.mp4" style="width: 100%; height: 100%; object-fit: contain;"></video>
</div>

<!-- Modal para criar/importar backup -->
<div class="backup-modal" id="backupModal">
    <div class="backup-modal-content">
        <h3 id="backupModalTitle">Criar Backup</h3>
        <input type="text" id="backupNameInput" class="backup-input" placeholder="Nome do backup (opcional)" maxlength="30">
        <div class="backup-modal-buttons">
            <button id="backupConfirmBtn" class="backup-confirm-btn">Confirmar</button>
            <button onclick="fecharModalBackup()" class="backup-cancel-btn">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal de confirma√ß√£o para recome√ßar -->
<div class="confirm-modal" id="confirmRecomecarModal">
    <div class="confirm-modal-content">
        <div class="confirm-icon">‚ö†Ô∏è</div>
        <h3>CONFIRMAR RECOME√áO</h3>
        <div class="confirm-message">
            <p>Voc√™ est√° prestes a <span class="warning-text">recome√ßar o jogo completamente</span>.</p>
            <p>Todos os seus dados atuais ser√£o <span class="warning-text">perdidos permanentemente</span>.</p>
        </div>
        
        <div class="confirm-details">
            <p><strong>O que ser√° perdido:</strong></p>
            <p>‚Ä¢ N√≠vel atual: <span id="confirmNivel">1</span></p>
            <p>‚Ä¢ Ouro: <span id="confirmOuro">0</span></p>
            <p>‚Ä¢ Itens no invent√°rio: <span id="confirmItens">0</span></p>
            <p>‚Ä¢ Equipamentos: <span id="confirmEquips">0</span></p>
            <p>‚Ä¢ XP acumulada: <span id="confirmXP">0</span></p>
        </div>
        
        <div class="confirm-message">
            <p><strong>Recomenda√ß√£o:</strong> Crie um backup antes de recome√ßar!</p>
        </div>
        
        <div class="confirm-modal-buttons">
            <button onclick="fecharConfirmacaoRecomecar()" class="confirm-cancel-btn">Cancelar</button>
            <button onclick="confirmarRecomecar()" class="confirm-proceed-btn">Sim, Recome√ßar Agora</button>
        </div>
    </div>
</div>

<script>
// ========================
// Sistema de Backup
// ========================

let backups = [];
const MAX_BACKUPS = 10;

// Inicializar sistema de backup
function inicializarBackup() {
    const savedBackups = localStorage.getItem('gameBackups');
    if (savedBackups) {
        backups = JSON.parse(savedBackups);
        atualizarListaBackups();
    }
}

// Criar um novo backup
function criarBackup() {
    if (backups.length >= MAX_BACKUPS) {
        alert(`Limite de ${MAX_BACKUPS} backups atingido. Exclua um backup antigo para criar um novo.`);
        return;
    }
    
    abrirModalBackup('criar');
}

// Abrir modal de backup
function abrirModalBackup(tipo) {
    const modal = document.getElementById('backupModal');
    const title = document.getElementById('backupModalTitle');
    const input = document.getElementById('backupNameInput');
    const confirmBtn = document.getElementById('backupConfirmBtn');
    
    if (tipo === 'criar') {
        title.textContent = 'Criar Backup';
        input.placeholder = 'Nome do backup (opcional)';
        input.value = '';
        confirmBtn.onclick = confirmarCriarBackup;
    } else if (tipo === 'importar') {
        title.textContent = 'Importar Backup';
        input.placeholder = 'Cole o c√≥digo do backup aqui';
        input.value = '';
        confirmBtn.onclick = confirmarImportarBackup;
    }
    
    modal.classList.add('active');
    input.focus();
}

// Fechar modal de backup
function fecharModalBackup() {
    document.getElementById('backupModal').classList.remove('active');
}

// Confirmar cria√ß√£o de backup
function confirmarCriarBackup() {
    const nome = document.getElementById('backupNameInput').value.trim();
    const timestamp = new Date().toLocaleString('pt-BR');
    
    const backupData = {
        id: Date.now(),
        nome: nome || `Backup ${backups.length + 1}`,
        data: timestamp,
        heroi: JSON.parse(JSON.stringify(heroi)), // Deep clone do her√≥i
        version: '1.0'
    };
    
    backups.unshift(backupData); // Adiciona no in√≠cio
    
    if (backups.length > MAX_BACKUPS) {
        backups = backups.slice(0, MAX_BACKUPS); // Mant√©m apenas os mais recentes
    }
    
    salvarBackups();
    atualizarListaBackups();
    fecharModalBackup();
    
    mostrarNotificacao(`Backup "${backupData.nome}" criado com sucesso!`);
}

// Restaurar backup
function restaurarBackup(backupId) {
    if (!confirm('Tem certeza que deseja restaurar este backup? O progresso atual ser√° perdido.')) {
        return;
    }
    
    const backup = backups.find(b => b.id === backupId);
    if (!backup) return;
    
    // Restaura o estado do her√≥i
    Object.assign(heroi, backup.heroi);
    recalcularStatus();
    atualizarStatus();
    atualizarInventario();
    
    mostrarNotificacao(`Backup "${backup.nome}" restaurado com sucesso!`);
}

// Excluir backup
function excluirBackup(backupId) {
    if (!confirm('Tem certeza que deseja excluir este backup?')) {
        return;
    }
    
    backups = backups.filter(b => b.id !== backupId);
    salvarBackups();
    atualizarListaBackups();
    
    mostrarNotificacao('Backup exclu√≠do com sucesso!');
}

// Exportar backup como texto
function exportarBackup() {
    const backupParaExportar = {
        nome: `Backup_${new Date().toISOString().slice(0, 10)}`,
        data: new Date().toLocaleString('pt-BR'),
        heroi: heroi,
        version: '1.0'
    };
    
    const backupString = JSON.stringify(backupParaExportar, null, 2);
    const blob = new Blob([backupString], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `battle_backup_${Date.now()}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    mostrarNotificacao('Backup exportado com sucesso!');
}

// Importar backup - CORRE√á√ÉO AQUI
function importarBackup() {
    // Cria um input de arquivo oculto
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.json';
    fileInput.style.display = 'none';
    
    fileInput.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const backupData = JSON.parse(e.target.result);
                
                // Valida√ß√£o do backup
                if (!backupData.heroi || !backupData.heroi.nome) {
                    throw new Error('Formato de backup inv√°lido.');
                }
                
                // Verifica limite de backups
                if (backups.length >= MAX_BACKUPS) {
                    alert(`Limite de ${MAX_BACKUPS} backups atingido. Exclua um backup antigo primeiro.`);
                    return;
                }
                
                // Prepara o backup para salvar
                const novoBackup = {
                    id: Date.now(),
                    nome: backupData.nome || `Backup Importado ${new Date().toLocaleDateString()}`,
                    data: backupData.data || new Date().toLocaleString('pt-BR'),
                    heroi: backupData.heroi,
                    version: backupData.version || '1.0'
                };
                
                // Confirma√ß√£o antes de importar
                if (confirm(`Deseja importar o backup "${novoBackup.nome}"?\nN√≠vel: ${novoBackup.heroi.lv}\nOuro: ${novoBackup.heroi.gold}`)) {
                    backups.unshift(novoBackup);
                    
                    if (backups.length > MAX_BACKUPS) {
                        backups = backups.slice(0, MAX_BACKUPS);
                    }
                    
                    salvarBackups();
                    atualizarListaBackups();
                    
                    mostrarNotificacao(`Backup "${novoBackup.nome}" importado com sucesso!`);
                }
                
            } catch (error) {
                alert('Erro ao importar backup. Verifique se o arquivo est√° correto.\nErro: ' + error.message);
                console.error(error);
            }
        };
        
        reader.readAsText(file);
    };
    
    // Adiciona ao corpo e clica
    document.body.appendChild(fileInput);
    fileInput.click();
    document.body.removeChild(fileInput);
}

// Confirmar importa√ß√£o de backup (para importa√ß√£o manual via texto)
function confirmarImportarBackup() {
    const input = document.getElementById('backupNameInput');
    const backupString = input.value.trim();
    
    if (!backupString) {
        alert('Por favor, cole o c√≥digo do backup.');
        return;
    }
    
    try {
        const backupData = JSON.parse(backupString);
        
        // Valida√ß√£o b√°sica do backup
        if (!backupData.heroi || !backupData.heroi.nome) {
            throw new Error('Formato de backup inv√°lido.');
        }
        
        if (backups.length >= MAX_BACKUPS) {
            alert(`Limite de ${MAX_BACKUPS} backups atingido. Exclua um backup antigo primeiro.`);
            return;
        }
        
        backupData.id = Date.now();
        if (!backupData.data) {
            backupData.data = new Date().toLocaleString('pt-BR');
        }
        if (!backupData.nome) {
            backupData.nome = 'Backup Importado';
        }
        
        backups.unshift(backupData);
        
        if (backups.length > MAX_BACKUPS) {
            backups = backups.slice(0, MAX_BACKUPS);
        }
        
        salvarBackups();
        atualizarListaBackups();
        fecharModalBackup();
        
        mostrarNotificacao(`Backup "${backupData.nome}" importado com sucesso!`);
        
    } catch (error) {
        alert('Erro ao importar backup. Verifique se o c√≥digo est√° correto.');
        console.error(error);
    }
}

// Atualizar lista de backups na UI
function atualizarListaBackups() {
    const backupList = document.getElementById('backupList');
    backupList.innerHTML = '';
    
    if (backups.length === 0) {
        backupList.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">Nenhum backup criado ainda</div>';
        return;
    }
    
    backups.forEach(backup => {
        const backupItem = document.createElement('div');
        backupItem.className = 'backup-item';
        
        backupItem.innerHTML = `
            <div class="backup-item-info">
                <div class="backup-item-name">${backup.nome}</div>
                <div class="backup-item-details">
                    <span>Nv ${backup.heroi.lv}</span>
                    <span>${backup.heroi.gold} ouro</span>
                    <span>${backup.data}</span>
                </div>
            </div>
            <div class="backup-item-actions">
                <button class="backup-btn" onclick="restaurarBackup(${backup.id})">Restaurar</button>
                <button class="backup-btn delete" onclick="excluirBackup(${backup.id})">Excluir</button>
            </div>
        `;
        
        backupList.appendChild(backupItem);
    });
}

// Salvar backups no localStorage
function salvarBackups() {
    localStorage.setItem('gameBackups', JSON.stringify(backups));
}

// ========================
// Sistema de Recome√ßo
// ========================

// Mostrar modal de confirma√ß√£o para recome√ßar
function mostrarConfirmacaoRecomecar() {
    const modal = document.getElementById('confirmRecomecarModal');
    
    // Preencher dados atuais para confirma√ß√£o
    document.getElementById('confirmNivel').textContent = heroi.lv;
    document.getElementById('confirmOuro').textContent = heroi.gold.toLocaleString();
    document.getElementById('confirmItens').textContent = heroi.inventory.reduce((total, item) => total + (item.quantidade || 1), 0);
    document.getElementById('confirmEquips').textContent = 
        (heroi.equipWeapon ? 1 : 0) + 
        (heroi.equipOffhand ? 1 : 0) + 
        (heroi.equipAmulet ? 1 : 0);
    document.getElementById('confirmXP').textContent = heroi.xp;
    
    modal.classList.add('active');
}

// Fechar modal de confirma√ß√£o
function fecharConfirmacaoRecomecar() {
    document.getElementById('confirmRecomecarModal').classList.remove('active');
}

// Confirmar e executar o recome√ßo
function confirmarRecomecar() {
    // Fechar modal
    fecharConfirmacaoRecomecar();
    
    // Mostrar mensagem final
    alert('Reiniciando o jogo... Tudo ser√° resetado para os valores iniciais.');
    
    // Executar o reset completo
    recomecarJogoCompleto();
}

// Fun√ß√£o principal para recome√ßar o jogo
function recomecarJogoCompleto() {
    // Criar um √∫ltimo backup autom√°tico antes de recome√ßar (opcional)
    const timestamp = new Date().toLocaleString('pt-BR');
    const backupFinal = {
        id: Date.now(),
        nome: `√öltimo backup antes do recome√ßo`,
        data: timestamp,
        heroi: JSON.parse(JSON.stringify(heroi)), // Salva estado atual
        version: '1.0'
    };
    
    // Adicionar ao in√≠cio dos backups
    backups.unshift(backupFinal);
    if (backups.length > MAX_BACKUPS) {
        backups = backups.slice(0, MAX_BACKUPS);
    }
    salvarBackups();
    
    // ========================
    // RESET COMPLETO DO HER√ìI
    // ========================
    
    // Resetar todos os atributos do her√≥i para valores iniciais
    heroi.lv = 1;
    heroi.hp = 100;
    heroi.maxHp = 100;
    heroi.mp = 30;
    heroi.maxMp = 30;
    heroi.xp = 0;
    heroi.gold = 0;
    heroi.atk = 10;
    heroi.def = 5;
    heroi.crit = 3;
    heroi.elem = 'Neutro';
    
    // Limpar invent√°rio completamente
    heroi.inventory = [];
    
    // Remover todos os equipamentos
    heroi.equipWeapon = null;
    heroi.equipOffhand = null;
    heroi.equipAmulet = null;
    
    // Adicionar itens iniciais novamente
    const itemInicialArma = { 
        id:'arma_inicial', 
        nome:'Espada de Treino', 
        preco:0, 
        tipo:'arma', 
        isEquipavel:true, 
        min:5, 
        max:10, 
        crit:2, 
        vel:1.0, 
        elem:'Neutro' 
    };
    
    const itemInicialPocao = { 
        id:'pocao_inicial', 
        nome:'Po√ß√£o de Cura', 
        preco:0, 
        tipo:'consum', 
        isEquipavel:false, 
        heal: 100 
    };
    
    heroi.inventory.push({ ...itemInicialArma, quantidade: 1 });
    heroi.inventory.push({ ...itemInicialPocao, quantidade: 1 });
    
    // Equipar a arma inicial automaticamente
    heroi.equipWeapon = itemInicialArma;
    
    // Resetar inimigo atual se houver
    inimigoAtual = null;
    document.getElementById('enemyIcon').textContent='?';
    document.getElementById('enemyNome').textContent='Nenhum inimigo';
    document.getElementById('enemyHP').textContent='0/0';
    document.getElementById('enemyMaxHP').textContent='0';
    document.getElementById('btnAtacar').disabled=true;
    document.getElementById('btnSair').disabled = true;
    
    // Recalcular status
    recalcularStatus();
    
    // Atualizar interface
    atualizarStatus();
    atualizarInventario();
    atualizarListaBackups();
    
    // Salvar estado resetado
    salvarNoLocalStorage();
    
    // Mostrar notifica√ß√£o de sucesso
    mostrarNotificacao('Jogo recome√ßado com sucesso! Status resetados para os valores iniciais.');
    
    // Mostrar mensagem adicional
    setTimeout(() => {
        alert('‚úÖ Jogo recome√ßado!\n\n‚Ä¢ N√≠vel: 1\n‚Ä¢ HP/MP: M√°ximos\n‚Ä¢ Invent√°rio: Resetado\n‚Ä¢ Equipamentos: Apenas espada inicial\n‚Ä¢ Ouro: 0\n\nBoa sorte na nova jornada!');
    }, 500);
}

// ========================
// Gera√ß√£o de itens
function gerarItens() {
const itens = [];
const nomes = ['Espada', 'Adaga', 'Lan√ßa', 'Escudo', 'Amuleto', 'Armadura', 'Elmo', 'Broquel', 'Cajado', 'Chicote', 'Disco', 'Cetro', 'Garras', 'Foice', 'Martelo'];
const elems = ['Fogo', '√Ågua', 'Terra', 'Vento', 'Luz', 'Trevas', 'Veneno', 'Impacto', 'Raio', 'Neutro', 'Sagrado'];

// Adiciona a Po√ß√£o de Cura como primeiro item
const pocaoCura = {
    id: 'pocao_cura',
    nome: 'Po√ß√£o de Cura',
    preco: 50,
    tipo: 'consum',
    isEquipavel: false,
    heal: 100
};
itens.push(pocaoCura);

for(let i=1; i<=1000; i++){
const tipoRand = Math.random();
let preco;
let tipo = '';
let isEquipavel = true;
let nomeItem;

// Propor√ß√£o 3:2:1
if (tipoRand < 0.5) { // 50% - Itens baratos (1-100)
preco = Math.floor(Math.random() * 100) + 1;
const tiposEquip = ['equip', 'off', 'amu'];
tipo = tiposEquip[Math.floor(Math.random() * tiposEquip.length)];
nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
} else if (tipoRand < 0.833) { // 33.3% - Itens de pre√ßo m√©dio (101-5000)
preco = Math.floor(Math.random() * 4900) + 101;
const tiposArma = ['arma', 'off', 'amu'];
tipo = tiposArma[Math.floor(Math.random() * tiposArma.length)];
nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
} else { // 16.7% - Itens caros (5001-5000000)
preco = Math.floor(Math.random() * 4995000) + 5001;
const tiposArma = ['arma', 'off', 'amu', 'equip'];
tipo = tiposArma[Math.floor(Math.random() * tiposArma.length)];
nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
}

const elem = elems[Math.floor(Math.random()*elems.length)];
let item = { id:'auto'+i, nome:`${nomeItem} #${i}`, preco:preco, tipo:tipo, isEquipavel:isEquipavel };

// Atributos baseados no pre√ßo (a raiz c√∫bica suaviza a progress√£o)
const statBase = Math.cbrt(preco);

if(tipo==='arma'){
item.min = Math.floor(statBase * 1.5) + 3;
item.max = item.min + Math.floor(statBase) + 1;
item.crit = Math.floor(statBase / 2) + 1;
item.vel = (Math.random()*0.5+0.5).toFixed(2);
item.elem = elem;
} else if(tipo==='off'){
item.def = Math.floor(statBase) + 2;
item.bloco = Math.floor(statBase * 1.5) + 10;
} else if(tipo==='amu'){
if(Math.random()<0.5) item.bonusHP = Math.floor(statBase * 4) + 10;
if(Math.random()<0.5) item.bonusCRIT = Math.floor(statBase / 3) + 1;
if(Math.random()<0.5) item.bonusMP = Math.floor(statBase * 2) + 5;
if(Math.random()<0.5) item.bonusATK = Math.floor(statBase / 2) + 1;
} else if(tipo==='equip'){
if(nomeItem==='Espada'){
item.min = Math.floor(statBase * 1.5) + 5;
item.max = item.min + Math.floor(statBase) + 5;
item.elem = elems[Math.floor(Math.random()*elems.length)];
} else if(nomeItem==='Escudo'){
item.def = Math.floor(statBase * 1.5) + 3;
item.bloco = Math.floor(statBase * 2) + 5;
} else if(nomeItem==='Armadura'){
item.def = Math.floor(statBase * 2) + 5;
} else if(nomeItem==='Elmo'){
item.def = Math.floor(statBase * 0.8) + 2;
}
}
itens.push(item);
}
return itens;
}
const ITEMS = gerarItens();

// Vari√°vel para itens ordenados na loja
let itensOrdenados = [...ITEMS];
let paginaAtual = 1;
const ITENS_POR_PAGINA = 10;

// ========================
// Her√≥i
let heroi = {
nome:'Her√≥i',
lv:1,
hp:100,
maxHp:100,
mp:30,
maxMp:30,
xp:0,
gold:0,
atk:10,
def:5,
crit:3,
elem:'Neutro',
inventory:[],
equipWeapon:null,
equipOffhand:null,
equipAmulet:null
};

// Itens iniciais (definidos novamente para uso no recome√ßo)
const itemInicialArma = { id:'arma_inicial', nome:'Espada de Treino', preco:0, tipo:'arma', isEquipavel:true, min:5, max:10, crit:2, vel:1.0, elem:'Neutro' };
const itemInicialPocao = { id:'pocao_inicial', nome:'Po√ß√£o de Cura', preco:0, tipo:'consum', isEquipavel:false, heal: 100 };

// Inimigo atual
let inimigoAtual = null;

// Lista de inimigos e chefes
const ENEMIES = [
{ nome:'Esqueleto', hp:50, atk:8, def:2, icon:'üíÄ', gold:[10,20], drops:[['Po√ß√£o de Cura',0.3]] },
{ nome:'M√∫mia', hp:80, atk:12, def:4, icon:'üíÄ', gold:[20,50], drops:[['Po√ß√£o de Cura',0.4]] },
{ nome:'Fara√≥ Fantasma', hp:120, atk:20, def:6, icon:'üëª', gold:[50,100], drops:[['Po√ß√£o de Cura',0.5]] }
];

const BOSSES = [
{ nome:'Lorde das Sombras', hp:500, atk:50, def:20, icon:'üòà', gold:[500,1000], drops:[['Amuleto #990', 0.2]] },
{ nome:'Drag√£o Anci√£o', hp:800, atk:80, def:30, icon:'üêâ', gold:[1000,2000], drops:[['Espada #995', 0.2]] },
{ nome:'Guerreiro Amaldi√ßoado', hp:600, atk:60, def:25, icon:'üëπ', gold:[700,1500], drops:[['Elmo #980', 0.2]] }
];

const nomesExtras = ['Lobisomem', 'G√°rgula', 'Drag√£o Pequeno', 'Goblin', 'Orc', 'Troll', 'Basilisco', 'Vampiro', 'Serpente Gigante', 'Manticora', 'Hidra', 'S√∫cubo', 'Quimera', 'Lamia', 'Harpia', 'F√™nix', 'Minotauro', 'Espectro', 'Demonio', 'Verdadeiro Dem√¥nio', 'Lobo Sombrio', 'Esquilo Assassino', 'Rato Gigante', 'Aranha Mortal', 'Cobra Gigante', 'Le√£o Selvagem', 'Urso Selvagem', 'Lobo Polido', 'Saci', 'Bicho-Pap√£o', 'Cuca', 'Sereia', 'Sirene', 'Naga'];
for(let i=0; i<396; i++){
const nomeAleatorio = nomesExtras[Math.floor(Math.random()*nomesExtras.length)];
const hpBase=40+Math.floor(Math.random()*30);
const atkBase=6+Math.floor(Math.random()*6);
const defBase=2+Math.floor(Math.random()*3);
const goldMin=5+Math.floor(Math.random()*10);
const goldMax=goldMin+Math.floor(Math.random()*10);
ENEMIES.push({ nome:nomeAleatorio, hp:hpBase, atk:atkBase, def:defBase, icon:'üëπ', gold:[goldMin,goldMax], drops:[['Po√ß√£o de Cura',0.2+Math.random()*0.3]] });
}

// ========================
// Sistema de Pesquisa
// ========================

function pesquisarItens(termo) {
    const resultadosDiv = document.getElementById('searchResults');
    resultadosDiv.innerHTML = '';
    
    if (termo.length < 2) {
        resultadosDiv.style.display = 'none';
        return;
    }
    
    const termoLower = termo.toLowerCase();
    const resultados = ITEMS.filter(item => 
        item.nome.toLowerCase().includes(termoLower) || 
        item.tipo.toLowerCase().includes(termoLower) ||
        (item.elem && item.elem.toLowerCase().includes(termoLower))
    ).slice(0, 10); // Limita a 10 resultados
    
    if (resultados.length === 0) {
        resultadosDiv.innerHTML = '<div class="search-result-item">Nenhum item encontrado</div>';
    } else {
        resultados.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'search-result-item';
            itemDiv.innerHTML = `
                <div class="search-result-name">${item.nome} (${item.tipo})</div>
                <div class="search-result-stats">${formatarStatsResumo(item)} | Pre√ßo: PO ${item.preco.toLocaleString()}</div>
            `;
            itemDiv.onclick = () => {
                document.getElementById('searchInput').value = item.nome;
                resultadosDiv.style.display = 'none';
                // Foca no item na loja (opcional)
                focarNoItem(item.id);
            };
            resultadosDiv.appendChild(itemDiv);
        });
    }
    
    resultadosDiv.style.display = 'block';
}

function formatarStatsResumo(item) {
    const stats = [];
    if (item.min && item.max) stats.push(`ATK:${item.min}-${item.max}`);
    if (item.crit) stats.push(`CRIT:+${item.crit}%`);
    if (item.def) stats.push(`DEF:+${item.def}`);
    if (item.bloco) stats.push(`BLOCO:${item.bloco}%`);
    if (item.elem) stats.push(item.elem);
    if (item.bonusHP) stats.push(`HP:+${item.bonusHP}`);
    if (item.bonusMP) stats.push(`MP:+${item.bonusMP}`);
    if (item.bonusATK) stats.push(`ATK:+${item.bonusATK}`);
    if (item.bonusCRIT) stats.push(`CRIT:+${item.bonusCRIT}%`);
    if (item.heal) stats.push(`CURA:${item.heal}`);
    
    return stats.join(' ');
}

function focarNoItem(itemId) {
    // Encontra a p√°gina onde est√° o item
    const itemIndex = itensOrdenados.findIndex(item => item.id === itemId);
    if (itemIndex !== -1) {
        const novaPagina = Math.floor(itemIndex / ITENS_POR_PAGINA) + 1;
        paginaAtual = novaPagina;
        mostrarItens();
        
        // Destaca o item (opcional)
        setTimeout(() => {
            const itemElement = document.querySelector(`[onclick="comprarItem('${itemId}')"]`);
            if (itemElement) {
                itemElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                itemElement.parentElement.style.backgroundColor = 'var(--accent)';
                itemElement.parentElement.style.color = 'var(--bg)';
                setTimeout(() => {
                    itemElement.parentElement.style.backgroundColor = '';
                    itemElement.parentElement.style.color = '';
                }, 2000);
            }
        }, 100);
    }
}

// Event Listeners para o sistema de pesquisa
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    
    searchInput.addEventListener('input', function(e) {
        pesquisarItens(e.target.value);
    });
    
    searchInput.addEventListener('focus', function() {
        if (searchInput.value.length >= 2) {
            pesquisarItens(searchInput.value);
        }
    });
    
    // Fecha os resultados ao clicar fora
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.style.display = 'none';
        }
    });
    
    // Tecla ESC fecha os resultados
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            searchResults.style.display = 'none';
            searchInput.blur();
        }
    });
    
    // Inicializar sistema de backup
    inicializarBackup();
    
    // Fechar modais ao clicar fora
    const backupModal = document.getElementById('backupModal');
    backupModal.addEventListener('click', function(e) {
        if (e.target === backupModal) {
            fecharModalBackup();
        }
    });
    
    const confirmModal = document.getElementById('confirmRecomecarModal');
    confirmModal.addEventListener('click', function(e) {
        if (e.target === confirmModal) {
            fecharConfirmacaoRecomecar();
        }
    });
    
    // Tecla ESC fecha os modais
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            fecharModalBackup();
            fecharConfirmacaoRecomecar();
        }
    });
});

// ========================
// Fun√ß√µes para salvar e carregar
function salvarNoLocalStorage() {
localStorage.setItem('gameState', JSON.stringify(heroi));
}
function carregarDoLocalStorage() {
const data = localStorage.getItem('gameState');
if (data) {
const p = JSON.parse(data);
Object.assign(heroi, p);
recalcularStatus(); // Recalcula status baseados nos equipamentos carregados
}
}

// ========================
// Fun√ß√µes de notifica√ß√£o
function mostrarNotificacao(mensagem) {
const notification = document.getElementById('notification');
notification.textContent = mensagem;
notification.style.opacity = '1';
setTimeout(() => {
notification.style.opacity = '0';
}, 3000);
}

// ==========================================================
// FUN√á√ïES DE EXIBI√á√ÉO DE ITENS (COM ATRIBUTOS) - ALTERA√á√ÉO AQUI
// ==========================================================

// Fun√ß√£o auxiliar para formatar os atributos de um item em HTML
function formatarAtributos(item) {
    let html = '';
    const stats = [];

    if (item.min && item.max) stats.push(`ATK: ${item.min}-${item.max}`);
    if (item.crit) stats.push(`CRIT: +${item.crit}%`);
    if (item.def) stats.push(`DEF: +${item.def}`);
    if (item.bloco) stats.push(`BLOCO: ${item.bloco}%`);
    if (item.elem) stats.push(`Elemento: ${item.elem}`);
    if (item.bonusHP) stats.push(`B√¥nus HP: +${item.bonusHP}`);
    if (item.bonusMP) stats.push(`B√¥nus MP: +${item.bonusMP}`);
    if (item.bonusATK) stats.push(`B√¥nus ATK: +${item.bonusATK}`);
    if (item.bonusCRIT) stats.push(`B√¥nus CRIT: +${item.bonusCRIT}%`);
    if (item.heal) stats.push(`Cura: ${item.heal} HP`);

    if (stats.length > 0) {
        html = `<span style="font-size: 12px; color: var(--muted); margin-left: 10px;">(${stats.join(' | ')})</span>`;
    }
    return html;
}

// 1. Mostrar itens na loja com pagina√ß√£o (ATUALIZADA)
function mostrarItens() {
    const container = document.getElementById('itensContainer');
    container.innerHTML = '';

    const inicio = (paginaAtual - 1) * ITENS_POR_PAGINA;
    const fim = inicio + ITENS_POR_PAGINA;
    const itensNaPagina = itensOrdenados.slice(inicio, fim);

    for(let item of itensNaPagina){
        const statsHtml = formatarAtributos(item);
        container.innerHTML += `<div class="item-entry" style="display:flex; justify-content:space-between; align-items:center; padding:4px; border-bottom:1px solid #555;">
            <div class="item-info">
                <b>${item.nome}</b> (${item.tipo}) ${statsHtml}<br>
                Pre√ßo: PO ${item.preco.toLocaleString()}
            </div>
            <button class="buttonnn" onclick="comprarItem('${item.id}')">Comprar</button>
        </div>`;
    }

    // Atualiza os controles de pagina√ß√£o
    document.getElementById('pageInfo').textContent = `P√°gina ${paginaAtual} de ${Math.ceil(ITEMS.length / ITENS_POR_PAGINA)}`;
    document.getElementById('prevPageBtn').disabled = paginaAtual === 1;
    document.getElementById('nextPageBtn').disabled = paginaAtual === Math.ceil(ITEMS.length / ITENS_POR_PAGINA);
}

// Ordenar itens e resetar a p√°gina para a primeira
function ordenarItens(ordem) {
if(ordem==='asc'){
itensOrdenados = [...ITEMS].sort((a,b)=>a.preco-b.preco);
} else {
itensOrdenados = [...ITEMS].sort((a,b)=>b.preco-a.preco);
}
paginaAtual = 1; // Reseta para a primeira p√°gina ao ordenar
mostrarItens();
}

// Fun√ß√£o para mudar a p√°gina
function mudarPagina(direcao) {
const totalPaginas = Math.ceil(ITEMS.length / ITENS_POR_PAGINA);
if (direcao === 1 && paginaAtual < totalPaginas) {
paginaAtual++;
} else if (direcao === -1 && paginaAtual > 1) {
paginaAtual--;
}
mostrarItens();
}

// Comprar item
function comprarItem(id) {
const item = ITEMS.find(i=>i.id===id);
if(!item) return;
if(heroi.gold < item.preco){
alert('Ouro insuficiente para comprar este item.');
return;
}
heroi.gold -= item.preco;
// Adiciona ao invent√°rio
let invItem = heroi.inventory.find(i=>i.id===item.id);
if(invItem){
invItem.quantidade=(invItem.quantidade||1)+1;
} else {
heroi.inventory.push({ ...item, quantidade:1 });
}
alert(`Voc√™ comprou: ${item.nome}`);
atualizarInventario();
atualizarStatus();
}

// 2. Atualizar invent√°rio (ATUALIZADA)
function atualizarInventario() {
    const div = document.getElementById('inventory');
    div.innerHTML='';
    heroi.inventory.forEach(i => {
        const statsHtml = formatarAtributos(i);
        let itemHtml = `<div style="display: flex; justify-content: space-between; align-items: center;">
            <div><b>${i.nome}</b> x${i.quantidade} ${statsHtml}</div>`;
        if (i.isEquipavel) {
            itemHtml += ` <button class="buttonnn" style="background: #d4a761; font-size: 12px; padding: 2px 6px;" onclick="equiparItemDoInventario('${i.id}')">Equipar</button>`;
        } else if (i.tipo === 'consum' && i.heal) {
            itemHtml += ` <button class="buttonnn" style="background: #a3bf3f; font-size: 12px; padding: 2px 6px;" onclick="usarPocaoEspecifica('${i.id}')">Usar</button>`;
        }
        itemHtml += `</div>`;
        div.innerHTML += itemHtml;
    });
}

// Usar Po√ß√£o Espec√≠fica do Invent√°rio
function usarPocaoEspecifica(id) {
    const pocaoIndex = heroi.inventory.findIndex(i => i.id === id && i.tipo === 'consum' && i.heal);
    if(pocaoIndex === -1){
        alert('Po√ß√£o n√£o encontrada no invent√°rio.');
        return;
    }
    
    const pocao = heroi.inventory[pocaoIndex];
    
    // Verifica se o HP j√° est√° no m√°ximo
    if(heroi.hp >= heroi.maxHp){
        alert('Seu HP j√° est√° no m√°ximo!');
        return;
    }
    
    // Aplica a cura
    heroi.hp = Math.min(heroi.maxHp, heroi.hp + pocao.heal);
    
    // Remove uma unidade da po√ß√£o
    pocao.quantidade--;
    if(pocao.quantidade <= 0){
        heroi.inventory.splice(pocaoIndex, 1);
    }
    
    alert(`Voc√™ usou uma ${pocao.nome} e recuperou ${pocao.heal} HP. HP atual: ${heroi.hp}/${heroi.maxHp}`);
    atualizarStatus();
}

// Equipar itens do invent√°rio
function equiparItemDoInventario(id) {
const itemIndex = heroi.inventory.findIndex(i => i.id === id);
if (itemIndex === -1) return;
const item = heroi.inventory[itemIndex];

let slotEquip = null;
if (item.tipo === 'arma') slotEquip = 'equipWeapon';
else if (item.tipo === 'off') slotEquip = 'equipOffhand';
else if (item.tipo === 'amu') slotEquip = 'equipAmulet';
else if (item.tipo === 'equip') slotEquip = 'equipWeapon'; // Assume equip vai para o slot de arma por padr√£o

if (!slotEquip) {
alert('Este item n√£o pode ser equipado.');
return;
}

const itemRemovido = heroi[slotEquip];
heroi[slotEquip] = item;
heroi.inventory.splice(itemIndex, 1);

if (itemRemovido) {
heroi.inventory.push(itemRemovido);
alert(`Voc√™ removeu ${itemRemovido.nome} e equipou ${item.nome}.`);
} else {
alert(`Voc√™ equipou ${item.nome}.`);
}

recalcularStatus();
atualizarStatus();
}

// Usar Po√ß√£o (fun√ß√£o original - usa qualquer po√ß√£o dispon√≠vel)
function usarPocao() {
const pocaoIndex = heroi.inventory.findIndex(i => i.nome.includes('Po√ß√£o') && i.tipo === 'consum');
if(pocaoIndex === -1){
alert('Voc√™ n√£o tem po√ß√µes de HP no invent√°rio.');
return;
}

const pocao = heroi.inventory[pocaoIndex];

// Verifica se o HP j√° est√° no m√°ximo
if(heroi.hp >= heroi.maxHp){
    alert('Seu HP j√° est√° no m√°ximo!');
    return;
}

// Aplica a cura
heroi.hp = Math.min(heroi.maxHp, heroi.hp + pocao.heal);
pocao.quantidade--;
if(pocao.quantidade <= 0){
heroi.inventory.splice(pocaoIndex, 1);
}
alert(`Voc√™ usou uma po√ß√£o e recuperou ${pocao.heal} HP. HP atual: ${heroi.hp}/${heroi.maxHp}`);
atualizarStatus();
}

// ========================
// Sistema de luta (ATUALIZADO - n√£o perde status/invent√°rio ao morrer)
// ========================

function encontrarInimigo() {
// Chance de encontrar um chefe
if (Math.random() < 0.05) { // 5% de chance
const boss = BOSSES[Math.floor(Math.random() * BOSSES.length)];
inimigoAtual = { ...boss };
inimigoAtual.hpMax = boss.hp;
mostrarNotificacao(`Um monstro muito forte apareceu: ${boss.nome}!`);
} else {
const inim = ENEMIES[Math.floor(Math.random() * ENEMIES.length)];
inimigoAtual = { ...inim };
inimigoAtual.hpMax = inim.hp;
}
document.getElementById('enemyIcon').textContent = inimigoAtual.icon;
document.getElementById('enemyNome').textContent = inimigoAtual.nome;
document.getElementById('enemyHP').textContent = `${inimigoAtual.hp}/${inimigoAtual.hp}`;
document.getElementById('enemyMaxHP').textContent = inimigoAtual.hp;
document.getElementById('btnAtacar').disabled = false;
document.getElementById('btnSair').disabled = false; // Habilita o Sair
}

// Fun√ß√£o para sair do combate (ATUALIZADA)
function sairDoCombate() {
    if (!inimigoAtual) return;

    // 1. Oculta a interface do jogo (opcional, mas bom para focar no v√≠deo)
    document.querySelector('.container').style.display = 'none';
    document.getElementById('lutaSistema').style.display = 'none';

    // 2. Prepara e exibe o container do v√≠deo
    const videoContainer = document.getElementById('videoContainer');
    const cutsceneVideo = document.getElementById('cutsceneVideo');

    videoContainer.style.display = 'block';

    // 3. Define a a√ß√£o ao finalizar o v√≠deo
    cutsceneVideo.onended = function() {
        // Tenta fechar a aba/janela (na maioria dos navegadores s√≥ funciona se for aberta pelo script)
        window.close();
        
        // Ou, uma alternativa mais confi√°vel: reseta o jogo (simulando o "fechamento" para a p√°gina inicial)
        alert('O jogo ser√° reiniciado. Fim da cutscene!');
        location.reload(); 
    };

    // 4. Inicia a reprodu√ß√£o
    // Nota: Navegadores modernos podem bloquear a reprodu√ß√£o autom√°tica.
    cutsceneVideo.play().catch(error => {
        // Caso o play seja bloqueado (comum em navegadores):
        alert('Falha ao iniciar a cutscene. Clique em OK para reiniciar o jogo.');
        location.reload();
    });
}


function atacar() {
if(!inimigoAtual) return;
// Dano do her√≥i
let danoHer√≥i = Math.max(1, Math.floor(heroi.atk * (1 + Math.random()*0.5))) - (inimigoAtual.def || 0);
if(danoHer√≥i<1) danoHer√≥i=1;
inimigoAtual.hp -= danoHer√≥i;
if(inimigoAtual.hp<0) inimigoAtual.hp=0;
// Atualiza o HP do inimigo
document.getElementById('enemyHP').textContent = `${inimigoAtual.hp}/${inimigoAtual.hpMax}`;

alert(`Voc√™ causou ${danoHer√≥i} de dano!`);

if(inimigoAtual.hp<=0){
alert(`Inimigo ${inimigoAtual.nome} derrotado!`);
const ouroGanhos = Math.floor(Math.random()*(inimigoAtual.gold[1]-inimigoAtual.gold[0]+1))+inimigoAtual.gold[0];
heroi.gold+=ouroGanhos;
const xpGanhos = 10+Math.floor(Math.random()*10);
heroi.xp+=xpGanhos;
alert(`Ganhou ${ouroGanhos} ouro e ${xpGanhos} XP!`);

// Drop de item raro (somente se for um boss)
if (inimigoAtual.drops && inimigoAtual.drops.length > 0) {
for(const [itemName, dropChance] of inimigoAtual.drops){
if (Math.random() < dropChance) {
const itemDrop = ITEMS.find(i => i.nome === itemName);
if (itemDrop) {
let invItem = heroi.inventory.find(i=>i.id===itemDrop.id);
if(invItem){
invItem.quantidade=(invItem.quantidade||1)+1;
} else {
heroi.inventory.push({ ...itemDrop, quantidade:1 });
}
mostrarNotificacao(`Voc√™ recebeu um item raro: ${itemDrop.nome}!`);
}
}
}
}

// Subir de n√≠vel
const xpNecessaria=heroi.lv*50;
if(heroi.xp>=xpNecessaria) {
heroi.lv++;
heroi.xp-=xpNecessaria;
heroi.maxHp+=10;
heroi.hp=heroi.maxHp;
heroi.maxMp+=5;
heroi.mp=heroi.maxMp;
alert(`Parab√©ns! Voc√™ subiu para o n√≠vel ${heroi.lv}!`);
}
atualizarInventario();
atualizarStatus();
salvarNoLocalStorage(); // salva ap√≥s ganhar xp e subir de n√≠vel

// reset inimigo
inimigoAtual=null;
document.getElementById('enemyIcon').textContent='?';
document.getElementById('enemyNome').textContent='Nenhum inimigo';
document.getElementById('enemyHP').textContent='0/0';
document.getElementById('enemyMaxHP').textContent='0';
document.getElementById('btnAtacar').disabled=true;
document.getElementById('btnSair').disabled = true; // Desabilita o Sair
return;
}

// Inimigo ataca
const danoInimigo = Math.max(0, inimigoAtual.atk - heroi.def);
heroi.hp -= danoInimigo;
if(heroi.hp<0) heroi.hp=0;
alert(`${inimigoAtual.nome} causou ${danoInimigo} de dano em voc√™!`);
if(heroi.hp<=0){
// ALTERA√á√ÉO AQUI: Ao morrer, apenas recupera HP/MP sem perder status, invent√°rio ou equipamentos
alert('Voc√™ foi derrotado! Recuperando HP e MP...');
heroi.hp = heroi.maxHp;
heroi.mp = heroi.maxMp;
// N√£o chama resetHer√≥i() - mant√©m todo o progresso
}
atualizarStatus();
salvarNoLocalStorage(); // salva ap√≥s ataque
}

// Fun√ß√£o resetHer√≥i mantida para outros usos, mas n√£o √© mais chamada ao morrer
function resetHer√≥i() {
heroi.hp=heroi.maxHp;
heroi.mp=heroi.maxMp;
heroi.xp=0;
heroi.gold=0;
heroi.inventory = [{ ...itemInicialArma, quantidade: 1 }]; // Reseta com item inicial
heroi.inventory.push({ ...itemInicialPocao, quantidade: 1 });
heroi.equipWeapon=null;
heroi.equipOffhand=null;
heroi.equipAmulet=null;
recalcularStatus();
salvarNoLocalStorage(); // salva o reset
}

// Recalcular status do her√≥i com base nos equipamentos
function recalcularStatus() {
// Status base
heroi.atk = 10;
heroi.def = 5;
heroi.crit = 3;
heroi.maxHp = 100 + (heroi.lv - 1) * 10; // Mant√©m o b√¥nus de n√≠vel
heroi.maxMp = 30 + (heroi.lv - 1) * 5; // Mant√©m o b√¥nus de n√≠vel

// Adiciona status dos equipamentos
if (heroi.equipWeapon) {
heroi.atk += heroi.equipWeapon.min || 0;
heroi.crit += heroi.equipWeapon.crit || 0;
}
if (heroi.equipOffhand) {
heroi.def += heroi.equipOffhand.def || 0;
}
if (heroi.equipAmulet) {
heroi.maxHp += heroi.equipAmulet.bonusHP || 0;
heroi.maxMp += heroi.equipAmulet.bonusMP || 0;
heroi.crit += heroi.equipAmulet.bonusCRIT || 0;
heroi.atk += heroi.equipAmulet.bonusATK || 0;
}
}

// ========================
// Inicializa a loja ao carregar
// ========================
mostrarItens();

// ========================
// 3. Atualiza a UI (incluindo Equipamento) (ATUALIZADA)
// ========================
function atualizarStatus() {
document.getElementById('hpLabel').textContent = `${heroi.hp}/${heroi.maxHp}`;
document.getElementById('hpBar').style.width = (heroi.hp / heroi.maxHp * 100) + '%';

document.getElementById('mpLabel').textContent = `${heroi.mp}/${heroi.maxMp}`;
document.getElementById('mpBar').style.width = (heroi.mp / heroi.maxMp * 100) + '%';

const xpNecessaria=heroi.lv*50;
document.getElementById('xpLabel').textContent = `${heroi.xp} / ${xpNecessaria}`;
document.getElementById('xpBar').style.width = (heroi.xp / xpNecessaria * 100) + '%';

document.getElementById('rankTag').textContent = `Nv ${heroi.lv}`;
document.getElementById('goldVal').textContent = heroi.gold;
document.getElementById('atkVal').textContent=heroi.atk;
document.getElementById('defVal').textContent=heroi.def;
document.getElementById('critVal').textContent=heroi.crit+'%';

// Atualiza equipamentos na UI com os stats
const weaponName = heroi.equipWeapon ? heroi.equipWeapon.nome : 'Nenhuma';
const weaponStats = heroi.equipWeapon ? formatarAtributos(heroi.equipWeapon) : '';
document.getElementById('eq-weapon').innerHTML = `${weaponName} ${weaponStats}`;

const offhandName = heroi.equipOffhand ? heroi.equipOffhand.nome : 'Nenhum';
const offhandStats = heroi.equipOffhand ? formatarAtributos(heroi.equipOffhand) : '';
document.getElementById('eq-offhand').innerHTML = `${offhandName} ${offhandStats}`;

const amuletName = heroi.equipAmulet ? heroi.equipAmulet.nome : 'Nenhum';
const amuletStats = heroi.equipAmulet ? formatarAtributos(heroi.equipAmulet) : '';
document.getElementById('eq-amulet').innerHTML = `${amuletName} ${amuletStats}`;

// Atualiza invent√°rio
atualizarInventario();

// Salva toda vez que atualiza
salvarNoLocalStorage();
}

// ========================
// Carregar o estado salvo ao iniciar
// ========================
if(heroi.inventory.length === 0) {
heroi.inventory.push({ ...itemInicialArma, quantidade: 1 });
heroi.inventory.push({ ...itemInicialPocao, quantidade: 1 });
}
carregarDoLocalStorage();
atualizarStatus();
</script>
</body>
</html>
