<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>bAttle text-based game - Todos Itens com Status</title>
<link rel="preconnect" href="https://fonts.gatsbyjs.io" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet" />

<style>
/* --- In√≠cio do C√≥digo CSS Original (Desktop) --- */
.buttonnn {
border: 2px solid #d4a761;
background-color: #d4a761 ;
}
#hpBar, #mpBar, #xpBar {
height: 16px;
background: #444;
border-radius: 8px;
overflow: hidden;
width: 150px;
}
:root {
--bg: #1a170f; --card: #1f1c14; --muted: #8a8a7c; --text: #f0e9d9; --accent: #d4a761; --accent2: #bfa33f; --danger: #bf6d3f; --ok: #a3bf3f;
}
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; font-family: Roboto, system-ui, -apple-system, Segoe UI, Arial; color: var(--text); background: radial-gradient(1200px 800px at 20% 10%, #252219, var(--bg)); }
#lutaSistema { display: flex; align-items: center; gap: 10px; padding: 10px; background: #2a2a25; border-radius: 12px; margin-bottom: 16px; position: relative; }
#lutaSistema button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; background: #d4a761; font-weight: 700; }
#lutaSistema button:hover { filter: brightness(1.1); }
.grid { display: grid; grid-template-columns: 320px 1fr; gap: 16px; }
@media(max-width: 900px) { .grid { grid-template-columns: 1fr; } }
.panel { background: var(--card); border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); overflow: hidden; }
.panel h2, .panel h3 { margin: 0 0 8px; }
.pad { padding: 16px 18px; }
.title { display: flex; align-items: center; gap: 10px; font-size: 20px; font-weight: 700; }
.section { border-top: 1px solid #323025; margin-top: 12px; padding-top: 12px; }
.list { display: grid; gap: 10px; }
.stat { display: flex; justify-content: space-between; margin-top: 4px; }
.bar #hpBar span { background-color: green; }
.bar #xpBar span { background-color: blue; }
.bar #xpBar span { background-color: white; }
.bar { width: 150px; height: 16px; border-radius: 8px; overflow: hidden; margin-top: 4px; border: white }
#statusPanel .equip-slot { display: grid; grid-template-columns: 110px 1fr; gap: 8px; align-items: center; margin-bottom: 4px; }
#statusPanel span.equip { font-weight: bold; }
#enemyInfo { display: flex; align-items: center; gap: 12px; background: #2a2a25; padding: 10px; border-radius: 8px; margin-top: 8px; position: relative; }
#enemyIcon { font-size: 30px; }
/* NOTIFICA√á√ÉO REMOVIDA DAQUI */
/* --- Fim do C√≥digo CSS Original --- */

/* --- Estilos para exibi√ß√£o de status dos itens --- */
.item-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 10px;
    margin-top: 15px;
}

.item-card {
    background: var(--card);
    border: 1px solid #323025;
    border-radius: 8px;
    padding: 12px;
    transition: all 0.2s;
}

.item-card:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.item-card.boss-item {
    border: 2px solid var(--accent);
    background: rgba(212, 167, 97, 0.05);
}

.item-card.legendary-item {
    border: 2px solid gold;
    background: rgba(255, 215, 0, 0.05);
}

.item-card.consumable {
    border: 2px solid var(--ok);
    background: rgba(163, 191, 63, 0.05);
}

.item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid #323025;
}

.item-name {
    font-weight: bold;
    font-size: 16px;
    color: var(--accent);
}

.item-type {
    font-size: 12px;
    background: var(--muted);
    color: var(--bg);
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
}

.item-price {
    font-size: 14px;
    color: gold;
    font-weight: bold;
}

.item-stats {
    margin-top: 8px;
}

.stat-line {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    margin-bottom: 4px;
    padding: 2px 4px;
    border-radius: 3px;
}

.stat-line:nth-child(odd) {
    background: rgba(255, 255, 255, 0.03);
}

.stat-label {
    color: var(--muted);
}

.stat-value {
    color: var(--text);
    font-weight: bold;
}

.stat-value.positive {
    color: #a3bf3f;
}

.stat-value.negative {
    color: #bf6d3f;
}

.stat-value.special {
    color: #d4a761;
}

.stat-value.element {
    color: #8a6dff;
}

.item-tags {
    display: flex;
    gap: 5px;
    margin-top: 8px;
    flex-wrap: wrap;
}

.item-tag {
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 10px;
    background: var(--bg);
    color: var(--text);
}

.item-tag.boss {
    background: var(--accent);
    color: var(--bg);
}

.item-tag.legendary {
    background: gold;
    color: #8a6d00;
}

.item-tag.consumable {
    background: var(--ok);
    color: var(--bg);
}

/* --- Estilos para o Filtro de Pesquisa --- */
.search-container {
    position: relative;
    width: 38%;
    margin-left: auto;
}

.search-input {
    width: 100%;
    padding: 10px 15px;
    background: var(--bg);
    border: 2px solid var(--accent);
    border-radius: 8px;
    color: var(--text);
    font-size: 14px;
    outline: none;
}

.search-input::placeholder {
    color: var(--muted);
}

.search-input:focus {
    border-color: var(--accent2);
    box-shadow: 0 0 5px var(--accent);
}

.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--card);
    border: 2px solid var(--accent);
    border-top: none;
    border-radius: 0 0 8px 8px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    display: none;
}

.search-result-item {
    padding: 10px 15px;
    border-bottom: 1px solid #323025;
    cursor: pointer;
    transition: background 0.2s;
}

.search-result-item:hover {
    background: var(--accent);
    color: var(--bg);
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-name {
    font-weight: bold;
    margin-bottom: 5px;
}

.search-result-stats {
    font-size: 12px;
    color: var(--muted);
}

.search-result-item:hover .search-result-stats {
    color: var(--bg);
}

/* --- Estilos para o Sistema de Backup --- */
.backup-section {
    border-top: 1px solid #323025;
    margin-top: 12px;
    padding-top: 12px;
}

.backup-controls {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 12px;
}

.backup-btn {
    padding: 8px 12px;
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
}

.backup-btn:hover {
    background: var(--accent2);
    transform: translateY(-1px);
}

.backup-btn.delete {
    background: var(--danger);
    font-size: 12px;
    padding: 4px 8px;
}

.backup-btn.delete:hover {
    background: #9a5530;
}

.backup-btn.danger {
    background: var(--danger);
    color: white;
}

.backup-btn.danger:hover {
    background: #9a5530;
}

.backup-list {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #323025;
    border-radius: 6px;
    padding: 8px;
    background: rgba(0, 0, 0, 0.2);
}

.backup-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 8px;
    margin-bottom: 6px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    border-left: 3px solid var(--accent);
}

.backup-item:last-child {
    margin-bottom: 0;
}

.backup-item-info {
    flex: 1;
}

.backup-item-name {
    font-weight: bold;
    font-size: 14px;
}

.backup-item-details {
    font-size: 11px;
    color: var(--muted);
    display: flex;
    gap: 10px;
}

.backup-item-actions {
    display: flex;
    gap: 6px;
}

.backup-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
}

.backup-modal.active {
    opacity: 1;
    visibility: visible;
}

.backup-modal-content {
    background: var(--card);
    border-radius: 12px;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    border: 2px solid var(--accent);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

.backup-modal h3 {
    margin-top: 0;
    color: var(--accent);
}

.backup-input {
    width: 100%;
    padding: 10px;
    background: var(--bg);
    border: 2px solid var(--accent);
    border-radius: 6px;
    color: var(--text);
    margin-bottom: 15px;
    font-size: 14px;
}

.backup-input:focus {
    outline: none;
    border-color: var(--accent2);
}

.backup-modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.backup-confirm-btn {
    padding: 8px 16px;
    background: var(--ok);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}

.backup-cancel-btn {
    padding: 8px 16px;
    background: var(--danger);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}

.backup-warning-btn {
    padding: 8px 16px;
    background: var(--danger);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}

.backup-confirm-btn:hover {
    background: #8aaf36;
}

.backup-cancel-btn:hover {
    background: #9a5530;
}

.backup-warning-btn:hover {
    background: #9a5530;
}

/* --- Modal de Confirma√ß√£o de Recome√ßo --- */
.confirm-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 3000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s;
}

.confirm-modal.active {
    opacity: 1;
    visibility: visible;
}

.confirm-modal-content {
    background: var(--card);
    border-radius: 12px;
    padding: 25px;
    width: 90%;
    max-width: 450px;
    border: 2px solid var(--danger);
    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    text-align: center;
}

.confirm-icon {
    font-size: 48px;
    color: var(--danger);
    margin-bottom: 15px;
}

.confirm-modal h3 {
    margin-top: 0;
    color: var(--danger);
    font-size: 22px;
}

.confirm-message {
    margin: 15px 0;
    color: var(--text);
    line-height: 1.5;
}

.confirm-details {
    background: rgba(191, 109, 63, 0.1);
    padding: 10px;
    border-radius: 6px;
    margin: 15px 0;
    border-left: 3px solid var(--danger);
}

.confirm-details p {
    margin: 5px 0;
    font-size: 14px;
}

.confirm-modal-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
}

.confirm-cancel-btn {
    padding: 10px 20px;
    background: var(--muted);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    flex: 1;
}

.confirm-proceed-btn {
    padding: 10px 20px;
    background: var(--danger);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    flex: 1;
}

.confirm-cancel-btn:hover {
    background: #6a6a5c;
}

.confirm-proceed-btn:hover {
    background: #9a5530;
}

.warning-text {
    color: var(--danger);
    font-weight: bold;
}

/* --- Estilos para bot√µes de equipamento --- */
.equip-btn {
    background: #d4a761 !important;
    color: var(--bg) !important;
    border: none !important;
    border-radius: 4px !important;
    padding: 2px 8px !important;
    font-size: 12px !important;
    cursor: pointer !important;
    margin-left: 5px !important;
    font-weight: bold !important;
}

.desequip-btn {
    background: #bf6d3f !important;
    color: white !important;
    border: none !important;
    border-radius: 4px !important;
    padding: 2px 8px !important;
    font-size: 12px !important;
    cursor: pointer !important;
    margin-left: 5px !important;
    font-weight: bold !important;
}

.equip-btn:hover, .desequip-btn:hover {
    filter: brightness(1.1);
}

/* --- Indicador de Rebirth --- */
.rebirth-indicator {
    background: linear-gradient(45deg, #ffd700, #ffed4e);
    color: #8a6d00;
    border-radius: 4px;
    padding: 2px 6px;
    font-weight: bold;
    font-size: 12px;
    margin-left: 5px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

/* --- ANIMA√á√ïES DE DANO ATUALIZADAS --- */
.damage-popup {
    position: absolute;
    font-size: 24px;
    font-weight: bold;
    z-index: 1000;
    pointer-events: none;
    animation: damageFloat 1.5s ease-out forwards;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
}

@keyframes damageFloat {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    50% {
        opacity: 1;
        transform: translateY(-30px) scale(1.2);
    }
    100% {
        opacity: 0;
        transform: translateY(-60px) scale(1.5);
    }
}

.damage-enemy {
    color: #ff4444; /* Vermelho para dano no inimigo (MANTIDO) */
}

.damage-crit {
    color: #ffaa00; /* Laranja para cr√≠tico */
    font-size: 28px;
    text-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
}

.damage-blocked {
    color: #cccccc; /* Cinza para bloqueado */
    font-size: 20px;
}

/* NOVO: Anima√ß√£o verde para cura */
.damage-heal {
    color: #44ff44; /* Verde para cura */
    font-size: 24px;
    text-shadow: 0 0 8px rgba(68, 255, 68, 0.5);
}

/* Container para anima√ß√µes de dano */
#damageContainer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 999;
}

/* --- NOVO: Estilos para o Dropdown de Notifica√ß√µes --- */
.notifications-dropdown {
    position: fixed;
    top: 70px;
    right: 20px;
    z-index: 999;
    width: 300px;
}

.notifications-toggle {
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.notifications-toggle:hover {
    background: var(--accent2);
    transform: translateY(-2px);
}

.notifications-toggle .badge {
    background: var(--danger);
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
}

.notifications-container {
    background: var(--card);
    border: 2px solid var(--accent);
    border-radius: 8px;
    margin-top: 8px;
    max-height: 400px;
    overflow-y: auto;
    display: none;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.notifications-container.show {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.notifications-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    border-bottom: 1px solid #323025;
    background: rgba(0, 0, 0, 0.2);
}

.notifications-header h4 {
    margin: 0;
    color: var(--accent);
}

.notifications-clear {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
}

.notifications-clear:hover {
    color: var(--danger);
    background: rgba(191, 109, 63, 0.1);
}

.notifications-list {
    padding: 0;
    margin: 0;
    list-style: none;
}

.notification-item {
    padding: 12px 15px;
    border-bottom: 1px solid #323025;
    transition: background 0.2s;
    cursor: pointer;
}

.notification-item:hover {
    background: rgba(212, 167, 97, 0.1);
}

.notification-item:last-child {
    border-bottom: none;
}

.notification-item.new {
    background: rgba(163, 191, 63, 0.1);
    border-left: 3px solid var(--ok);
}

.notification-item.important {
    background: rgba(212, 167, 97, 0.1);
    border-left: 3px solid var(--accent);
}

.notification-item.warning {
    background: rgba(191, 109, 63, 0.1);
    border-left: 3px solid var(--danger);
}

.notification-content {
    font-size: 14px;
    line-height: 1.4;
}

.notification-time {
    font-size: 11px;
    color: var(--muted);
    margin-top: 4px;
}

.notifications-empty {
    text-align: center;
    padding: 30px 15px;
    color: var(--muted);
    font-style: italic;
}

/* --- In√≠cio do C√≥digo Responsivo (Tema Eg√≠pcio) --- */
@media (max-width: 900px) {
:root {
  --bg: #2b261b; /* Fundo mais escuro */
  --card: #3f3929; /* Card de papiro */
  --muted: #c9c3ac; /* Texto sutil */
  --text: #fef8dd; /* Cor de areia */
  --accent: #e2b714; /* Dourado */
  --accent2: #b47f0e; /* Ouro antigo */
  --danger: #9c3c1e; /* Vermelho ferrugem */
  --ok: #3a8a3f; /* Verde antigo */
}

body {
  background: #2b261b;
  font-family: 'Times New Roman', serif;
  font-weight: 400;
}

/* Layout principal para mobile */
.grid {
  grid-template-columns: 1fr;
}

.panel {
  border-radius: 0;
  box-shadow: none;
  border: 2px solid var(--accent);
  border-left: none;
  border-right: none;
  background: var(--card);
}

.panel:first-of-type {
  border-top: none;
}

.pad {
  padding: 10px;
}

/* Estilo do t√≠tulo e pilhas */
.title {
  font-family: 'Papyrus', 'Georgia', serif;
  font-size: 24px;
  justify-content: center;
  margin-bottom: 15px;
  color: var(--accent);
}

.pill {
  background: var(--accent);
  color: var(--bg);
  border-radius: 4px;
  padding: 2px 6px;
    font-weight: bold;
    text-transform: uppercase;
}

/* Ajustes nas barras de status */
#hpBar, #mpBar, #xpBar {
  width: 100%;
}

#lutaSistema {
  flex-direction: column;
  align-items: stretch;
  padding: 10px;
  background: var(--card);
  border-radius: 0;
  border: 2px solid var(--accent);
  border-bottom: none;
  border-left: none;
  border-right: none;
}

#lutaSistema button {
  background: var(--accent);
  color: var(--bg);
  font-weight: 700;
  width: 100%;
  margin-top: 8px;
}

#enemyDisplay {
  flex-direction: column;
  align-items: center;
  text-align: center;
}

/* Itens da loja e invent√°rio */
.item-entry {
  flex-direction: column;
  align-items: flex-start;
  gap: 5px;
}

.buttonnn {
  width: 100%;
  margin-top: 5px;
}

#inventory .buttonnn {
  width: auto;
  margin-top: 0;
  font-size: 14px;
  padding: 4px 8px;
}

/* NOTIFICA√á√ÉO ORIGINAL REMOVIDA - substitu√≠da pelo dropdown */

/* Ajustes para o filtro em mobile */
.search-container {
    width: 100%;
    margin-left: 0;
    margin-bottom: 10px;
}

/* Ajustes para backup em mobile */
.backup-controls {
    flex-direction: column;
}

.backup-btn {
    width: 100%;
}

.backup-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
}

.backup-item-actions {
    width: 100%;
    justify-content: flex-end;
}

.backup-modal-content {
    width: 95%;
    padding: 15px;
}

.confirm-modal-content {
    width: 95%;
    padding: 20px;
}

.confirm-modal-buttons {
    flex-direction: column;
    gap: 10px;
}

.confirm-cancel-btn,
.confirm-proceed-btn {
    width: 100%;
}

/* Ajustes para exibi√ß√£o de itens em mobile */
.item-stats-grid {
    grid-template-columns: 1fr;
}

.item-card {
    padding: 10px;
}

.stat-line {
    font-size: 12px;
}

/* Ajustes para o dropdown de notifica√ß√µes em mobile */
.notifications-dropdown {
    position: fixed;
    top: 60px;
    right: 10px;
    left: 10px;
    width: auto;
    z-index: 1000;
}

.notifications-container {
    max-height: 300px;
}

.notifications-toggle {
    width: 100%;
    justify-content: center;
}

/* Ajustes para anima√ß√µes de dano em mobile */
.damage-popup {
    font-size: 20px;
}

.damage-crit {
    font-size: 24px;
}
}
/* --- Fim do C√≥digo Responsivo --- */

/* --- Estilo para exibir atributos dos itens na loja --- */
.item-attributes {
    font-size: 12px;
    color: var(--accent);
    margin-top: 4px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.attr-badge {
    background: rgba(212, 167, 97, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    border: 1px solid rgba(212, 167, 97, 0.3);
    font-weight: bold;
}

.item-info {
    flex-grow: 1;
}
</style>
</head>
<body>
<!-- Container para anima√ß√µes de dano -->
<div id="damageContainer"></div>

<!-- Dropdown de Notifica√ß√µes -->
<div class="notifications-dropdown">
    <button class="notifications-toggle" onclick="toggleNotifications()">
        üîî Notifica√ß√µes <span class="badge" id="notificationBadge">0</span>
    </button>
    <div class="notifications-container" id="notificationsContainer">
        <div class="notifications-header">
            <h4>Notifica√ß√µes</h4>
            <button class="notifications-clear" onclick="clearNotifications()">Limpar Tudo</button>
        </div>
        <ul class="notifications-list" id="notificationsList">
            <li class="notifications-empty">Nenhuma notifica√ß√£o</li>
        </ul>
    </div>
</div>

<div id="frame" style="width: 100%;margin: auto;position: relative; z-index: 99998;">
          <iframe data-aa='2420409' src='//acceptable.a-ads.com/2420409/?size=Adaptive'
                            style='border:0; padding:0; width:70%; height:auto; overflow:hidden;display: block;margin: auto'></iframe>
        </div>
<div class="container">

<div id="lutaSistema">
<button onclick="encontrarInimigo()">Encontrar Inimigo</button>
<div id="enemyDisplay" style="display:flex; align-items:center; gap:10px;">
<div id="enemyIcon">?</div>
<div>
<div id="enemyNome">Nenhum inimigo</div>
<div>HP: <span id="enemyHP">0/0</span> / <span id="enemyMaxHP">0</span></div>
</div>
<button id="btnAtacar" disabled onclick="atacar()">Atacar</button>
</div>
<button id="btnSair" onclick="sairDoCombate()" style="background: #d4a761; font-weight: 700;">Sair</button>
</div>

<div class="grid">
<aside class="panel" id="statusPanel">
<div class="pad">
<div class="title">‚öîÔ∏è bAttle <span class="pill" id="rankTag">Nv 1</span></div>

<div class="stat"><span>HP</span><span id="hpLabel">100/100</span></div>
<div class="bar"><span id="hpBar"></span></div>

<div class="stat"><span>MP</span><span id="mpLabel">30/30</span></div>
<div class="bar"><span id="mpBar"></span></div>

<div class="stat"><span>XP</span><span id="xpLabel">0 / 50</span></div>
<div class="bar"><span id="xpBar"></span></div>

<div class="row" style="margin-top:10px">
<span class="pill">ATQ <b id="atkVal">10</b></span>
<span class="pill">DEF <b id="defVal">5</b></span>
<span class="pill">CRIT <b id="critVal">3%</b></span>
<span class="pill">BLOCO <b id="blocoVal">0%</b></span>
<span class="pill">OURO <b id="goldVal">0</b></span>
</div>

<!-- Se√ß√£o de Backup -->
<div class="backup-section">
    <h3>üíæ Sistema de Backup</h3>
    <div class="backup-controls">
        <button class="backup-btn" onclick="criarBackup()">Criar Backup</button>
        <button class="backup-btn" onclick="exportarBackup()">Exportar Backup</button>
        <button class="backup-btn" onclick="importarBackup()">Importar Backup</button>
        <button class="backup-btn danger" onclick="mostrarConfirmacaoRecomecar()">Recome√ßar Jogo</button>
    </div>
    
    <div class="backup-list" id="backupList">
        <!-- Lista de backups ser√° carregada aqui -->
    </div>
</div>

<div class="section">
<h3>üéí Invent√°rio</h3>
<div id="inventory" class="list"></div>
<button id="btnUsarPocao" class="buttonnn" style="background: #a3bf3f; margin-top: 10px;" onclick="usarPocao()">Usar Po√ß√£o</button>
</div>

<div class="section">
<h3>üß∞ Equipamento</h3>
<div class="equip-slot">
    <span class="muted">Arma</span>
    <div>
        <span id="eq-weapon">Nenhuma</span>
        <button id="btn-desequipar-weapon" class="desequip-btn" style="display: none;" onclick="desequiparItem('weapon')">X</button>
    </div>
</div>
<div class="equip-slot">
    <span class="muted">Off-hand</span>
    <div>
        <span id="eq-offhand">Nenhum</span>
        <button id="btn-desequipar-offhand" class="desequip-btn" style="display: none;" onclick="desequiparItem('offhand')">X</button>
    </div>
</div>
<div class="equip-slot">
    <span class="muted">Amuleto</span>
    <div>
        <span id="eq-amulet">Nenhum</span>
        <button id="btn-desequipar-amulet" class="desequip-btn" style="display: none;" onclick="desequiparItem('amulet')">X</button>
    </div>
</div>
</div>
</div>
</aside>

<main class="panel" id="shopPanel">
<div class="pad">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
    <h2 style="margin: 0;">Loja (3000+ itens)</h2>
    <div class="search-container">
        <input type="text" class="search-input" placeholder="Pesquisar itens..." id="searchInput">
        <div class="search-results" id="searchResults"></div>
    </div>
</div>

<div id="filterButtons" style="margin-bottom: 10px;">
<button class="buttonnn" style="background: #d4a761" onclick="ordenarItens('asc')">Ordenar por Menor Pre√ßo</button>
<button class="buttonnn" style="background: #d4a761;" onclick="ordenarItens('desc')">Ordenar por Maior Pre√ßo</button>
<button class="buttonnn" style="background: #a3bf3f;" onclick="mostrarTodosItens()">Ver Todos Itens com Status</button>
</div>

<div id="itensContainer"></div>

<div id="paginationControls" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
<button class="buttonnn" onclick="mudarPagina(-1)" disabled id="prevPageBtn">Anterior</button>
<span id="pageInfo">P√°gina 1 de 150</span>
<button class="buttonnn" onclick="mudarPagina(1)" id="nextPageBtn">Pr√≥xima</button>
</div>

<h3>Comprar item</h3>
<p>Selecione um item para comprar e adicionar ao invent√°rio.</p>

<!-- Se√ß√£o para mostrar todos os itens com status -->
<div id="todosItensContainer" style="display: none; margin-top: 20px;">
    <h3>Todos os Itens com Status Completos</h3>
    <div id="todosItens" class="item-stats-grid"></div>
</div>

</div>
</main>
</div>

<div class="foot"> grind f√°cil at√© 10 ¬∑ m√©dio at√© 60 ¬∑ XP reduzida no 100 ¬∑ itens at√© 50.000.000 ouro ¬∑ N√≠veis ilimitados</div>

<!-- NOTIFICA√á√ÉO ORIGINAL REMOVIDA -->

<div id="videoContainer" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; display: none;">
    <video id="cutsceneVideo" src="./cust_scene_getting_out.mp4" style="width: 100%; height: 100%; object-fit: contain;"></video>
</div>

<!-- Modal para criar/importar backup -->
<div class="backup-modal" id="backupModal">
    <div class="backup-modal-content">
        <h3 id="backupModalTitle">Criar Backup</h3>
        <input type="text" id="backupNameInput" class="backup-input" placeholder="Nome do backup (opcional)" maxlength="30">
        <div class="backup-modal-buttons">
            <button id="backupConfirmBtn" class="backup-confirm-btn">Confirmar</button>
            <button onclick="fecharModalBackup()" class="backup-cancel-btn">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal de confirma√ß√£o para recome√ßar -->
<div class="confirm-modal" id="confirmRecomecarModal">
    <div class="confirm-modal-content">
        <div class="confirm-icon">‚ö†Ô∏è</div>
        <h3>CONFIRMAR RECOME√áO</h3>
        <div class="confirm-message">
            <p>Voc√™ est√° prestes a <span class="warning-text">recome√ßar o jogo completamente</span>.</p>
            <p>Todos os seus dados atuais ser√£o <span class="warning-text">perdidos permanentemente</span>.</p>
        </div>
        
        <div class="confirm-details">
            <p><strong>O que ser√° perdido:</strong></p>
            <p>‚Ä¢ N√≠vel atual: <span id="confirmNivel">1</span></p>
            <p>‚Ä¢ Ouro: <span id="confirmOuro">0</span></p>
            <p>‚Ä¢ Itens no invent√°rio: <span id="confirmItens">0</span></p>
            <p>‚Ä¢ Equipamentos: <span id="confirmEquips">0</span></p>
            <p>‚Ä¢ XP acumulada: <span id="confirmXP">0</span></p>
        </div>
        
        <div class="confirm-message">
            <p><strong>Recomenda√ß√£o:</strong> Crie um backup antes de recome√ßar!</p>
        </div>
        
        <div class="confirm-modal-buttons">
            <button onclick="fecharConfirmacaoRecomecar()" class="confirm-cancel-btn">Cancelar</button>
            <button onclick="confirmarRecomecar()" class="confirm-proceed-btn">Sim, Recome√ßar Agora</button>
        </div>
    </div>
</div>

<script>
// ========================
// Sistema de Notifica√ß√µes
// ========================

let notifications = [];
const MAX_NOTIFICATIONS = 20; // LIMITE DE 20 NOTIFICA√á√ïES

// Inicializar sistema de notifica√ß√µes
function inicializarNotificacoes() {
    const savedNotifications = localStorage.getItem('gameNotifications');
    if (savedNotifications) {
        notifications = JSON.parse(savedNotifications);
        // Garantir que n√£o exceda o limite ao carregar
        if (notifications.length > MAX_NOTIFICATIONS) {
            notifications = notifications.slice(0, MAX_NOTIFICATIONS);
        }
        atualizarBadgeNotificacoes();
    }
}

// Adicionar uma nova notifica√ß√£o (CORRIGIDO)
function adicionarNotificacao(mensagem, tipo = 'normal') {
    const novaNotificacao = {
        id: Date.now(),
        mensagem: mensagem,
        tipo: tipo,
        timestamp: new Date().toLocaleTimeString('pt-BR'),
        lida: false
    };
    
    // ADICIONA NO IN√çCIO (notifica√ß√µes mais recentes primeiro)
    notifications.unshift(novaNotificacao);
    
    // LIMITE DE 20 NOTIFICA√á√ïES - REMOVE AS MAIS ANTIGAS SE NECESS√ÅRIO
    if (notifications.length > MAX_NOTIFICATIONS) {
        // Remove as notifica√ß√µes mais antigas (do final do array)
        notifications = notifications.slice(0, MAX_NOTIFICATIONS);
    }
    
    salvarNotificacoes();
    atualizarListaNotificacoes();
    atualizarBadgeNotificacoes();
    
    // Se o dropdown estiver aberto, atualizar
    if (document.getElementById('notificationsContainer').classList.contains('show')) {
        mostrarNotificacoesNoDropdown();
    }
}

// Toggle do dropdown de notifica√ß√µes
function toggleNotifications() {
    const container = document.getElementById('notificationsContainer');
    container.classList.toggle('show');
    
    if (container.classList.contains('show')) {
        mostrarNotificacoesNoDropdown();
        marcarNotificacoesComoLidas();
    }
}

// Mostrar notifica√ß√µes no dropdown (CORRIGIDO)
function mostrarNotificacoesNoDropdown() {
    const lista = document.getElementById('notificationsList');
    lista.innerHTML = '';
    
    if (notifications.length === 0) {
        lista.innerHTML = '<li class="notifications-empty">Nenhuma notifica√ß√£o</li>';
        return;
    }
    
    // As notifica√ß√µes j√° est√£o na ordem correta (mais recentes primeiro)
    notifications.forEach(notif => {
        const item = document.createElement('li');
        item.className = `notification-item ${notif.lida ? '' : 'new'} ${notif.tipo}`;
        item.innerHTML = `
            <div class="notification-content">${notif.mensagem}</div>
            <div class="notification-time">${notif.timestamp}</div>
        `;
        lista.appendChild(item);
    });
}

// Marcar todas as notifica√ß√µes como lidas
function marcarNotificacoesComoLidas() {
    notifications.forEach(notif => {
        notif.lida = true;
    });
    salvarNotificacoes();
    atualizarBadgeNotificacoes();
}

// Limpar todas as notifica√ß√µes
function clearNotifications() {
    if (notifications.length === 0) return;
    
    if (confirm('Tem certeza que deseja limpar todas as notifica√ß√µes?')) {
        notifications = [];
        salvarNotificacoes();
        mostrarNotificacoesNoDropdown();
        atualizarBadgeNotificacoes();
    }
}

// Atualizar badge de notifica√ß√µes
function atualizarBadgeNotificacoes() {
    const badge = document.getElementById('notificationBadge');
    const naoLidas = notifications.filter(n => !n.lida).length;
    badge.textContent = naoLidas;
    badge.style.display = naoLidas > 0 ? 'flex' : 'none';
}

// Salvar notifica√ß√µes no localStorage
function salvarNotificacoes() {
    localStorage.setItem('gameNotifications', JSON.stringify(notifications));
}

// Atualizar lista de notifica√ß√µes
function atualizarListaNotificacoes() {
    const lista = document.getElementById('notificationsList');
    if (!lista) return;
    
    if (document.getElementById('notificationsContainer').classList.contains('show')) {
        mostrarNotificacoesNoDropdown();
    }
}

// Fechar dropdown quando clicar fora
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('notificationsContainer');
    const toggle = document.querySelector('.notifications-toggle');
    
    if (!dropdown.contains(event.target) && !toggle.contains(event.target)) {
        dropdown.classList.remove('show');
    }
});

// ========================
// SISTEMA DE ANIMA√á√ÉO DE DANO ATUALIZADO
// ========================

function mostrarAnimacaoDano(dano, tipo, elemento, isCritico = false, isBloqueado = false, isCura = false) {
    const damageContainer = document.getElementById('damageContainer');
    
    // Cria o elemento de dano
    const damageElement = document.createElement('div');
    damageElement.className = 'damage-popup';
    
    // Define o texto e cor baseado no tipo
    let textoDano = '';
    let classeCor = '';
    
    if (isCura) {
        // ANIMA√á√ÉO VERDE PARA CURA
        textoDano = `+${dano} HP`;
        classeCor = 'damage-heal';
    } else if (isBloqueado) {
        textoDano = 'BLOQUEADO';
        classeCor = 'damage-blocked';
    } else if (isCritico) {
        textoDano = `-${dano} CR√çTICO!`;
        classeCor = 'damage-crit';
    } else if (tipo === 'enemy') {
        // ANIMA√á√ÉO VERMELHA PARA DANO NO INIMIGO (MANTIDA)
        textoDano = `-${dano}`;
        classeCor = 'damage-enemy';
    }
    // REMOVIDO: anima√ß√£o azul para dano no jogador
    
    damageElement.textContent = textoDano;
    if (classeCor) {
        damageElement.classList.add(classeCor);
    }
    
    // Posiciona o elemento relativo ao alvo
    const rect = elemento.getBoundingClientRect();
    const centerX = rect.left + (rect.width / 2);
    const centerY = rect.top + (rect.height / 2);
    
    // Posi√ß√£o aleat√≥ria levemente deslocada para parecer mais natural
    const offsetX = (Math.random() * 40) - 20;
    const offsetY = (Math.random() * 20) - 10;
    
    damageElement.style.left = `${centerX + offsetX}px`;
    damageElement.style.top = `${centerY + offsetY}px`;
    
    // Adiciona ao container
    damageContainer.appendChild(damageElement);
    
    // Remove ap√≥s a anima√ß√£o
    setTimeout(() => {
        if (damageElement.parentNode) {
            damageElement.parentNode.removeChild(damageElement);
        }
    }, 1500);
}

// ========================
// Sistema de Backup
// ========================

let backups = [];
const MAX_BACKUPS = 10;

// Inicializar sistema de backup
function inicializarBackup() {
    const savedBackups = localStorage.getItem('gameBackups');
    if (savedBackups) {
        backups = JSON.parse(savedBackups);
        atualizarListaBackups();
    }
}

// Criar um novo backup
function criarBackup() {
    if (backups.length >= MAX_BACKUPS) {
        adicionarNotificacao(`Limite de ${MAX_BACKUPS} backups atingido. Exclua um backup antigo para criar um novo.`, 'warning');
        return;
    }
    
    abrirModalBackup('criar');
}

// Abrir modal de backup
function abrirModalBackup(tipo) {
    const modal = document.getElementById('backupModal');
    const title = document.getElementById('backupModalTitle');
    const input = document.getElementById('backupNameInput');
    const confirmBtn = document.getElementById('backupConfirmBtn');
    
    if (tipo === 'criar') {
        title.textContent = 'Criar Backup';
        input.placeholder = 'Nome do backup (opcional)';
        input.value = '';
        confirmBtn.onclick = confirmarCriarBackup;
    } else if (tipo === 'importar') {
        title.textContent = 'Importar Backup';
        input.placeholder = 'Cole o c√≥digo do backup aqui';
        input.value = '';
        confirmBtn.onclick = confirmarImportarBackup;
    }
    
    modal.classList.add('active');
    input.focus();
}

// Fechar modal de backup
function fecharModalBackup() {
    document.getElementById('backupModal').classList.remove('active');
}

// Confirmar cria√ß√£o de backup
function confirmarCriarBackup() {
    const nome = document.getElementById('backupNameInput').value.trim();
    const timestamp = new Date().toLocaleString('pt-BR');
    
    const backupData = {
        id: Date.now(),
        nome: nome || `Backup ${backups.length + 1}`,
        data: timestamp,
        heroi: JSON.parse(JSON.stringify(heroi)), // Deep clone do her√≥i
        version: '1.0'
    };
    
    backups.unshift(backupData); // Adiciona no in√≠cio
    
    if (backups.length > MAX_BACKUPS) {
        backups = backups.slice(0, MAX_BACKUPS); // Mant√©m apenas os mais recentes
    }
    
    salvarBackups();
    atualizarListaBackups();
    fecharModalBackup();
    
    adicionarNotificacao(`Backup "${backupData.nome}" criado com sucesso!`, 'important');
}

// Restaurar backup
function restaurarBackup(backupId) {
    if (!confirm('Tem certeza que deseja restaurar este backup? O progresso atual ser√° perdido.')) {
        return;
    }
    
    const backup = backups.find(b => b.id === backupId);
    if (!backup) return;
    
    // Restaura o estado do her√≥i
    Object.assign(heroi, backup.heroi);
    atualizarStatus();
    atualizarInventario();
    
    adicionarNotificacao(`Backup "${backup.nome}" restaurado com sucesso!`, 'important');
}

// Excluir backup
function excluirBackup(backupId) {
    if (!confirm('Tem certeza que deseja excluir este backup?')) {
        return;
    }
    
    backups = backups.filter(b => b.id !== backupId);
    salvarBackups();
    atualizarListaBackups();
    
    adicionarNotificacao('Backup exclu√≠do com sucesso!');
}

// Exportar backup como texto
function exportarBackup() {
    const backupParaExportar = {
        nome: `Backup_${new Date().toISOString().slice(0, 10)}`,
        data: new Date().toLocaleString('pt-BR'),
        heroi: heroi,
        version: '1.0'
    };
    
    const backupString = JSON.stringify(backupParaExportar, null, 2);
    const blob = new Blob([backupString], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `battle_backup_${Date.now()}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    adicionarNotificacao('Backup exportado com sucesso!', 'important');
}

// Importar backup
function importarBackup() {
    // Cria um input de arquivo oculto
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.json';
    fileInput.style.display = 'none';
    
    fileInput.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const backupData = JSON.parse(e.target.result);
                
                // Valida√ß√£o do backup
                if (!backupData.heroi || !backupData.heroi.nome) {
                    throw new Error('Formato de backup inv√°lido.');
                }
                
                // Verifica limite de backups
                if (backups.length >= MAX_BACKUPS) {
                    adicionarNotificacao(`Limite de ${MAX_BACKUPS} backups atingido. Exclua um backup antigo primeiro.`, 'warning');
                    return;
                }
                
                // Prepara o backup para salvar
                const novoBackup = {
                    id: Date.now(),
                    nome: backupData.nome || `Backup Importado ${new Date().toLocaleDateString()}`,
                    data: backupData.data || new Date().toLocaleString('pt-BR'),
                    heroi: backupData.heroi,
                    version: backupData.version || '1.0'
                };
                
                // Confirma√ß√£o antes de importar
                if (confirm(`Deseja importar o backup "${novoBackup.nome}"?\nN√≠vel: ${novoBackup.heroi.lv}\nOuro: ${novoBackup.heroi.gold}`)) {
                    backups.unshift(novoBackup);
                    
                    if (backups.length > MAX_BACKUPS) {
                        backups = backups.slice(0, MAX_BACKUPS);
                    }
                    
                    salvarBackups();
                    atualizarListaBackups();
                    
                    adicionarNotificacao(`Backup "${novoBackup.nome}" importado com sucesso!`, 'important');
                }
                
            } catch (error) {
                adicionarNotificacao('Erro ao importar backup. Verifique se o arquivo est√° correto.', 'warning');
                console.error(error);
            }
        };
        
        reader.readAsText(file);
    };
    
    // Adiciona ao corpo e clica
    document.body.appendChild(fileInput);
    fileInput.click();
    document.body.removeChild(fileInput);
}

// Confirmar importa√ß√£o de backup (para importa√ß√£o manual via texto)
function confirmarImportarBackup() {
    const input = document.getElementById('backupNameInput');
    const backupString = input.value.trim();
    
    if (!backupString) {
        adicionarNotificacao('Por favor, cole o c√≥digo do backup.', 'warning');
        return;
    }
    
    try {
        const backupData = JSON.parse(backupString);
        
        // Valida√ß√£o b√°sica do backup
        if (!backupData.heroi || !backupData.heroi.nome) {
            throw new Error('Formato de backup inv√°lido.');
        }
        
        if (backups.length >= MAX_BACKUPS) {
            adicionarNotificacao(`Limite de ${MAX_BACKUPS} backups atingido. Exclua um backup antigo primeiro.`, 'warning');
            return;
        }
        
        backupData.id = Date.now();
        if (!backupData.data) {
            backupData.data = new Date().toLocaleString('pt-BR');
        }
        if (!backupData.nome) {
            backupData.nome = 'Backup Importado';
        }
        
        backups.unshift(backupData);
        
        if (backups.length > MAX_BACKUPS) {
            backups = backups.slice(0, MAX_BACKUPS);
        }
        
        salvarBackups();
        atualizarListaBackups();
        fecharModalBackup();
        
        adicionarNotificacao(`Backup "${backupData.nome}" importado com sucesso!`, 'important');
        
    } catch (error) {
        adicionarNotificacao('Erro ao importar backup. Verifique se o c√≥digo est√° correto.', 'warning');
        console.error(error);
    }
}

// Atualizar lista de backups na UI
function atualizarListaBackups() {
    const backupList = document.getElementById('backupList');
    backupList.innerHTML = '';
    
    if (backups.length === 0) {
        backupList.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px;">Nenhum backup criado ainda</div>';
        return;
    }
    
    backups.forEach(backup => {
        const backupItem = document.createElement('div');
        backupItem.className = 'backup-item';
        
        backupItem.innerHTML = `
            <div class="backup-item-info">
                <div class="backup-item-name">${backup.nome}</div>
                <div class="backup-item-details">
                    <span>Nv ${backup.heroi.lv}</span>
                    <span>${backup.heroi.gold} ouro</span>
                    <span>${backup.data}</span>
                </div>
            </div>
            <div class="backup-item-actions">
                <button class="backup-btn" onclick="restaurarBackup(${backup.id})">Restaurar</button>
                <button class="backup-btn delete" onclick="excluirBackup(${backup.id})">Excluir</button>
            </div>
        `;
        
        backupList.appendChild(backupItem);
    });
}

// Salvar backups no localStorage
function salvarBackups() {
    localStorage.setItem('gameBackups', JSON.stringify(backups));
}

// ========================
// Sistema de Recome√ßo
// ========================

// Mostrar modal de confirma√ß√£o para recome√ßar
function mostrarConfirmacaoRecomecar() {
    const modal = document.getElementById('confirmRecomecarModal');
    
    // Preencher dados atuais para confirma√ß√£o
    document.getElementById('confirmNivel').textContent = heroi.lv;
    document.getElementById('confirmOuro').textContent = heroi.gold.toLocaleString();
    document.getElementById('confirmItens').textContent = heroi.inventory.reduce((total, item) => total + (item.quantidade || 1), 0);
    document.getElementById('confirmEquips').textContent = 
        (heroi.equipWeapon ? 1 : 0) + 
        (heroi.equipOffhand ? 1 : 0) + 
        (heroi.equipAmulet ? 1 : 0);
    document.getElementById('confirmXP').textContent = heroi.xp;
    
    modal.classList.add('active');
}

// Fechar modal de confirma√ß√£o
function fecharConfirmacaoRecomecar() {
    document.getElementById('confirmRecomecarModal').classList.remove('active');
}

// Confirmar e executar o recome√ßo
function confirmarRecomecar() {
    // Fechar modal
    fecharConfirmacaoRecomecar();
    
    // Executar o reset completo
    recomecarJogoCompleto();
}

// Fun√ß√£o principal para recome√ßar o jogo
function recomecarJogoCompleto() {
    // Criar um √∫ltimo backup autom√°tico antes de recome√ßar (opcional)
    const timestamp = new Date().toLocaleString('pt-BR');
    const backupFinal = {
        id: Date.now(),
        nome: `√öltimo backup antes do recome√ßo`,
        data: timestamp,
        heroi: JSON.parse(JSON.stringify(heroi)), // Salva estado atual
        version: '1.0'
    };
    
    // Adicionar ao in√≠cio dos backups
    backups.unshift(backupFinal);
    if (backups.length > MAX_BACKUPS) {
        backups = backups.slice(0, MAX_BACKUPS);
    }
    salvarBackups();
    
    // ========================
    // RESET COMPLETO DO HER√ìI
    // ========================
    
    // Resetar todos os atributos do her√≥i para valores iniciais
    heroi.lv = 1;
    heroi.hp = 100;
    heroi.maxHp = 100;
    heroi.mp = 30;
    heroi.maxMp = 30;
    heroi.xp = 0;
    heroi.gold = 0;
    heroi.atk = 10;
    heroi.def = 5;
    heroi.crit = 3;
    heroi.bloco = 0;
    heroi.elem = 'Neutro';
    
    // Limpar invent√°rio completamente
    heroi.inventory = [];
    
    // Remover todos os equipamentos
    heroi.equipWeapon = null;
    heroi.equipOffhand = null;
    heroi.equipAmulet = null;
    
    // Adicionar itens iniciais novamente
    const itemInicialArma = { 
        id:'arma_inicial', 
        nome:'Espada de Treino', 
        preco:0, 
        tipo:'arma', 
        isEquipavel:true, 
        min:5, 
        max:10, 
        crit:2, 
        vel:1.0, 
        elem:'Neutro' 
    };
    
    const itemInicialPocao = { 
        id:'pocao_inicial', 
        nome:'Po√ß√£o de Cura', 
        preco:0, 
        tipo:'consum', 
        isEquipavel:false, 
        heal: 100 
    };
    
    heroi.inventory.push({ ...itemInicialArma, quantidade: 1 });
    heroi.inventory.push({ ...itemInicialPocao, quantidade: 1 });
    
    // Equipar a arma inicial automaticamente
    heroi.equipWeapon = itemInicialArma;
    heroi.crit += itemInicialArma.crit || 0; // Adiciona o cr√≠tico da arma inicial
    
    // Resetar inimigo atual se houver
    inimigoAtual = null;
    document.getElementById('enemyIcon').textContent='?';
    document.getElementById('enemyNome').textContent='Nenhum inimigo';
    document.getElementById('enemyHP').textContent='0/0';
    document.getElementById('enemyMaxHP').textContent='0';
    document.getElementById('btnAtacar').disabled=true;
    document.getElementById('btnSair').disabled = true;
    
    // Atualizar interface
    atualizarStatus();
    atualizarInventario();
    atualizarListaBackups();
    
    // Salvar estado resetado
    salvarNoLocalStorage();
    
    // Adicionar notifica√ß√£o de sucesso
    adicionarNotificacao('Jogo recome√ßado com sucesso! Status resetados para os valores iniciais.', 'important');
}

// ========================
// Gera√ß√£o de itens (3000 ITENS) COM STATUS COMPLETOS
// ========================

function gerarItens() {
const itens = [];
const nomes = ['Espada', 'Adaga', 'Lan√ßa', 'Escudo', 'Amuleto', 'Armadura', 'Elmo', 'Broquel', 'Cajado', 'Chicote', 'Disco', 'Cetro', 'Garras', 'Foice', 'Martelo', 'Machado', 'Arco', 'Besta', 'Tridente', 'Nunchaku', 'Kunai', 'Shuriken', 'Katana', 'Wakizashi', 'Claymore', 'Gl√°dio', 'Ma√ßa', 'Cimitarra', 'Rapieira', 'Alabarda'];
const elems = ['Fogo', '√Ågua', 'Terra', 'Vento', 'Luz', 'Trevas', 'Veneno', 'Impacto', 'Raio', 'Neutro', 'Sagrado', 'C√≥smico', 'Temporal', 'Vazio', 'Caos'];

// Adiciona a Po√ß√£o de Cura como primeiro item (COM STATUS)
const pocaoCura = {
    id: 'pocao_cura',
    nome: 'Po√ß√£o de Cura',
    preco: 50,
    tipo: 'consum',
    isEquipavel: false,
    heal: 100,
    descricao: 'Po√ß√£o b√°sica que recupera 100 HP'
};
itens.push(pocaoCura);

// Adiciona po√ß√µes mais poderosas (COM STATUS)
const pocaoCuraGrande = {
    id: 'pocao_cura_grande',
    nome: 'Po√ß√£o de Cura Grande',
    preco: 200,
    tipo: 'consum',
    isEquipavel: false,
    heal: 300,
    descricao: 'Po√ß√£o m√©dia que recupera 300 HP'
};
itens.push(pocaoCuraGrande);

const pocaoCuraEpica = {
    id: 'pocao_cura_epica',
    nome: 'Po√ß√£o de Cura √âpica',
    preco: 1000,
    tipo: 'consum',
    isEquipavel: false,
    heal: 1000,
    descricao: 'Po√ß√£o √©pica que recupera 1000 HP'
};
itens.push(pocaoCuraEpica);

// Gerar 3000 itens - GARANTINDO QUE TODOS TENHAM ATRIBUTOS
for(let i=1; i<=3000; i++){
    const tipoRand = Math.random();
    let preco;
    let tipo = '';
    let isEquipavel = true;
    let nomeItem;
    
    // Distribui√ß√£o ajustada para 3000 itens
    if (tipoRand < 0.4) { // 40% - Itens baratos (1-500)
        preco = Math.floor(Math.random() * 500) + 1;
        const tiposEquip = ['equip', 'off', 'amu'];
        tipo = tiposEquip[Math.floor(Math.random() * tiposEquip.length)];
        nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
    } else if (tipoRand < 0.75) { // 35% - Itens de pre√ßo m√©dio (501-50000)
        preco = Math.floor(Math.random() * 49500) + 501;
        const tiposArma = ['arma', 'off', 'amu'];
        tipo = tiposArma[Math.floor(Math.random() * tiposArma.length)];
        nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
    } else if (tipoRand < 0.95) { // 20% - Itens caros (50001-5000000)
        preco = Math.floor(Math.random() * 4950000) + 50001;
        const tiposArma = ['arma', 'off', 'amu', 'equip'];
        tipo = tiposArma[Math.floor(Math.random() * tiposArma.length)];
        nomeItem = nomes[Math.floor(Math.random() * nomes.length)];
    } else { // 5% - Itens lend√°rios (5000001-50000000)
        preco = Math.floor(Math.random() * 45000000) + 5000001;
        const tiposArma = ['arma', 'off', 'amu', 'equip'];
        tipo = tiposArma[Math.floor(Math.random() * tiposArma.length)];
        nomeItem = 'Lend√°rio ' + nomes[Math.floor(Math.random() * nomes.length)];
    }

    const elem = elems[Math.floor(Math.random()*elems.length)];
    let item = { 
        id:'item_'+i, 
        nome:`${nomeItem} #${i}`, 
        preco:preco, 
        tipo:tipo, 
        isEquipavel:isEquipavel,
        elem: elem // TODOS os itens t√™m elemento
    };

    // Atributos baseados no pre√ßo (escalonado para 3000 itens)
    const statBase = Math.pow(preco, 1/3.5); // Ajustado para melhor progress√£o

    // GARANTIR QUE TODOS OS ITENS TENHAM PELO MENOS 3 ATRIBUTOS VIS√çVEIS
    if(tipo==='arma'){
        item.min = Math.floor(statBase * 2) + 5;
        item.max = item.min + Math.floor(statBase * 1.5) + 10;
        item.crit = Math.floor(statBase) + 2;
        item.vel = (Math.random()*0.7+0.5).toFixed(2);
        // Adiciona b√¥nus para itens caros
        if(preco > 1000000) {
            item.bonusATK = Math.floor(statBase / 4) + 5;
            item.bonusCRIT = Math.floor(statBase / 5) + 3;
        }
        // Garante pelo menos 3 atributos
        if (!item.bonusATK) item.bonusATK = Math.floor(statBase / 3) + 1;
        if (!item.bonusHP) item.bonusHP = Math.floor(statBase * 2) + 10;
    } else if(tipo==='off'){
        item.def = Math.floor(statBase * 1.5) + 5;
        item.bloco = Math.floor(statBase * 2) + 15;
        // Adiciona b√¥nus para itens caros
        if(preco > 1000000) {
            item.bonusDEF = Math.floor(statBase / 3) + 5;
            item.bonusHP = Math.floor(statBase * 3) + 20;
        }
        // Garante pelo menos 3 atributos
        if (!item.bonusDEF) item.bonusDEF = Math.floor(statBase / 2) + 2;
        if (!item.bonusHP) item.bonusHP = Math.floor(statBase * 1.5) + 15;
        item.bonusMP = Math.floor(statBase) + 5;
    } else if(tipo==='amu'){
        // Amuletos podem ter m√∫ltiplos b√¥nus
        const numBonus = Math.floor(Math.random() * 4) + 2;
        for(let b=0; b<numBonus; b++){
            const bonusType = Math.floor(Math.random() * 6);
            switch(bonusType){
                case 0: item.bonusHP = Math.floor(statBase * 5) + 20; break;
                case 1: item.bonusMP = Math.floor(statBase * 3) + 10; break;
                case 2: item.bonusATK = Math.floor(statBase / 2) + 3; break;
                case 3: item.bonusCRIT = Math.floor(statBase / 3) + 2; break;
                case 4: item.bonusBLOCO = Math.floor(statBase) + 8; break;
                case 5: item.bonusDEF = Math.floor(statBase / 2) + 2; break;
            }
        }
        // Itens muito caros tem b√¥nus adicionais
        if(preco > 5000000) {
            item.bonusHP = (item.bonusHP || 0) + 100;
            item.bonusATK = (item.bonusATK || 0) + 20;
            item.bonusMP = (item.bonusMP || 0) + 50;
        }
        // Garante pelo menos 3 atributos
        if (!item.bonusHP) item.bonusHP = Math.floor(statBase * 3) + 15;
        if (!item.bonusMP) item.bonusMP = Math.floor(statBase * 2) + 10;
        if (!item.bonusATK) item.bonusATK = Math.floor(statBase / 3) + 1;
    } else if(tipo==='equip'){
        if(nomeItem.includes('Espada') || nomeItem.includes('Arma')){
            item.min = Math.floor(statBase * 2.5) + 10;
            item.max = item.min + Math.floor(statBase * 2) + 15;
            item.crit = Math.floor(statBase) + 3;
            item.bonusHP = Math.floor(statBase * 2) + 10;
            item.bonusATK = Math.floor(statBase / 3) + 2;
        } else if(nomeItem.includes('Escudo') || nomeItem.includes('Defesa')){
            item.def = Math.floor(statBase * 2) + 10;
            item.bloco = Math.floor(statBase * 2.5) + 20;
            item.bonusHP = Math.floor(statBase * 2) + 15;
            item.bonusDEF = Math.floor(statBase / 2) + 3;
        } else if(nomeItem.includes('Armadura') || nomeItem.includes('Prote√ß√£o')){
            item.def = Math.floor(statBase * 2.5) + 15;
            item.bloco = Math.floor(statBase * 1.5) + 15;
            item.bonusHP = Math.floor(statBase * 4) + 30;
            item.bonusDEF = Math.floor(statBase / 2) + 5;
            item.bonusMP = Math.floor(statBase) + 10;
        } else if(nomeItem.includes('Elmo') || nomeItem.includes('Capacete')){
            item.def = Math.floor(statBase * 1.2) + 5;
            item.bonusHP = Math.floor(statBase * 2) + 15;
            item.bonusMP = Math.floor(statBase) + 10;
            item.bonusDEF = Math.floor(statBase / 3) + 2;
        } else {
            // Tipo gen√©rico de equipamento - GARANTE ATRIBUTOS
            item.def = Math.floor(statBase) + 3;
            item.bonusHP = Math.floor(statBase * 1.5) + 10;
            item.bonusMP = Math.floor(statBase) + 5;
            item.bonusATK = Math.floor(statBase / 4) + 1;
        }
    } else if(tipo==='consum'){
        // Itens consum√≠veis sempre t√™m atributos
        item.heal = Math.floor(statBase * 3) + 50;
        item.bonusHP = Math.floor(statBase) + 10;
        item.descricao = 'Item consum√≠vel de uso √∫nico';
    } else {
        // Para qualquer outro tipo - GARANTE ATRIBUTOS
        item.def = Math.floor(statBase) + 2;
        item.bonusHP = Math.floor(statBase * 1.2) + 8;
        item.bonusMP = Math.floor(statBase) + 3;
    }
    
    // Adiciona descri√ß√£o para itens lend√°rios
    if(preco > 5000000) {
        item.descricao = 'Item lend√°rio de poder incompar√°vel';
        item.bonusATK = (item.bonusATK || 0) + 30;
        item.bonusHP = (item.bonusHP || 0) + 150;
        item.bonusMP = (item.bonusMP || 0) + 80;
        item.crit = (item.crit || 0) + 10;
        item.bloco = (item.bloco || 0) + 15;
    }
    
    // GARANTIR que o item tenha pelo menos 2 atributos vis√≠veis
    const atributosContagem = [
        item.min, item.max, item.crit, item.def, item.bloco, item.bonusHP,
        item.bonusMP, item.bonusATK, item.bonusDEF, item.bonusCRIT, item.bonusBLOCO, item.heal
    ].filter(attr => attr !== undefined && attr !== null && attr !== 0).length;
    
    if (atributosContagem < 2) {
        // Adiciona atributos autom√°ticos se necess√°rio
        item.bonusHP = Math.floor(statBase) + 10;
        item.bonusMP = Math.floor(statBase / 2) + 5;
    }
    
    itens.push(item);
}
return itens;
}
const ITEMS = gerarItens();

// ========================
// 13 BOSSES COMPLETOS COM ITENS RAROS (COM STATUS COMPLETOS)
// ========================

// Item raro do Lorde das Sombras
const itemLordeSombra = {
    id: 'boss_item_lorde_sombras',
    nome: 'Sombra da Perdi√ß√£o',
    preco: 50000,
    tipo: 'amu',
    isEquipavel: true,
    bonusHP: 200,
    bonusMP: 100,
    bonusATK: 30,
    bonusCRIT: 10,
    bonusBLOCO: 15,
    bonusDEF: 10,
    descricao: 'Amuleto ancestral que pertenceu ao Lorde das Sombras',
    elem: 'Trevas'
};

// Item raro do Drag√£o Anci√£o
const itemDragaoAnciao = {
    id: 'boss_item_dragao_anciao',
    nome: 'Cora√ß√£o do Drag√£o Anci√£o',
    preco: 100000,
    tipo: 'amu',
    isEquipavel: true,
    bonusHP: 500,
    bonusMP: 200,
    bonusATK: 50,
    bonusCRIT: 20,
    bonusBLOCO: 25,
    bonusDEF: 30,
    descricao: 'O cora√ß√£o cristalizado do lend√°rio Drag√£o Anci√£o. Concede poder imenso.',
    elem: 'Fogo'
};

// Item raro do Guerreiro Amaldi√ßoado
const itemGuerreiroAmaldicoado = {
    id: 'boss_item_guerreiro_amaldicoado',
    nome: 'Elmo da Maldi√ß√£o Eterna',
    preco: 75000,
    tipo: 'equip',
    isEquipavel: true,
    def: 40,
    bloco: 20,
    bonusHP: 150,
    bonusCRIT: 5,
    bonusDEF: 15,
    bonusMP: 50,
    descricao: 'Elmo do Guerreiro Amaldi√ßoado, ainda pulsando com energia sombria',
    elem: 'Trevas'
};

// Item raro do Rei Esqueleto
const itemReiEsqueleto = {
    id: 'boss_item_rei_esqueleto',
    nome: 'Coroa do Rei Esqueleto',
    preco: 60000,
    tipo: 'amu',
    isEquipavel: true,
    bonusHP: 180,
    bonusMP: 80,
    bonusATK: 25,
    bonusCRIT: 8,
    bonusDEF: 20,
    bonusBLOCO: 12,
    descricao: 'Coroa do antigo Rei Esqueleto, ainda emanando poder real',
    elem: 'Trevas'
};

// Item raro da F√™nix
const itemFenix = {
    id: 'boss_item_fenix',
    nome: 'Pena da F√™nix',
    preco: 85000,
    tipo: 'amu',
    isEquipavel: true,
    bonusHP: 300,
    bonusMP: 150,
    bonusATK: 35,
    bonusCRIT: 12,
    bonusBLOCO: 18,
    bonusDEF: 15,
    descricao: 'Pena da lend√°ria F√™nix, pulsando com energia de renascimento',
    elem: 'Fogo'
};

// Item raro do Kraken
const itemKraken = {
    id: 'boss_item_kraken',
    nome: 'Tent√°culo do Kraken',
    preco: 90000,
    tipo: 'arma',
    isEquipavel: true,
    min: 40,
    max: 70,
    crit: 15,
    vel: 1.2,
    elem: '√Ågua',
    bonusATK: 20,
    bonusHP: 100,
    bonusMP: 60,
    descricao: 'Tent√°culo petrificado do temido Kraken das profundezas'
};

// Item raro do Colosso de Pedra
const itemColossoPedra = {
    id: 'boss_item_colosso_pedra',
    nome: 'Cora√ß√£o de Pedra',
    preco: 70000,
    tipo: 'amu',
    isEquipavel: true,
    bonusHP: 400,
    bonusDEF: 40,
    bonusBLOCO: 25,
    bonusATK: 15,
    descricao: 'Cora√ß√£o do Colosso de Pedra, extremamente resistente',
    elem: 'Terra'
};

// Item raro do Lich
const itemLich = {
    id: 'boss_item_lich',
    nome: 'Cetro do Lich',
    preco: 95000,
    tipo: 'arma',
    isEquipavel: true,
    min: 35,
    max: 65,
    crit: 18,
    vel: 1.1,
    elem: 'Trevas',
    bonusMP: 200,
    bonusCRIT: 10,
    bonusATK: 15,
    bonusHP: 120,
    descricao: 'Cetro do poderoso Lich, canalizador de magias das trevas'
};

// Item raro do Behemoth
const itemBehemoth = {
    id: 'boss_item_behemoth',
    nome: 'Pele do Behemoth',
    preco: 80000,
    tipo: 'equip',
    isEquipavel: true,
    def: 50,
    bloco: 30,
    bonusHP: 350,
    bonusDEF: 25,
    bonusBLOCO: 15,
    bonusATK: 10,
    descricao: 'Pele endurecida do colossal Behemoth, quase indestrut√≠vel',
    elem: 'Terra'
};

// Item raro da Quimera
const itemQuimera = {
    id: 'boss_item_quimera',
    nome: 'Cabe√ßa da Quimera',
    preco: 88000,
    tipo: 'amu',
    isEquipavel: true,
    bonusHP: 250,
    bonusATK: 40,
    bonusCRIT: 15,
    bonusDEF: 15,
    bonusMP: 100,
    elem: 'Fogo',
    descricao: 'Cabe√ßa da terr√≠vel Quimera, com poder de m√∫ltiplas bestas'
};

// Item raro do S√∫cubo
const itemSucubo = {
    id: 'boss_item_sucubo',
    nome: 'Asas do S√∫cubo',
    preco: 78000,
    tipo: 'amu',
    isEquipavel: true,
    bonusMP: 180,
    bonusCRIT: 20,
    bonusATK: 28,
    vel: 1.3,
    bonusHP: 120,
    bonusDEF: 10,
    descricao: 'Asas da S√∫cubo, concedendo agilidade sobrenatural',
    elem: 'Trevas'
};

// Item raro do Titan
const itemTitan = {
    id: 'boss_item_titan',
    nome: 'Sangue do Titan',
    preco: 120000,
    tipo: 'amu',
    isEquipavel: true,
    bonusHP: 600,
    bonusATK: 60,
    bonusDEF: 35,
    bonusBLOCO: 20,
    bonusCRIT: 15,
    bonusMP: 150,
    descricao: 'Sangue divino do Titan, concedendo for√ßa sobre-humana',
    elem: 'Sagrado'
};

// Item raro do Deus Antigo
const itemDeusAntigo = {
    id: 'boss_item_deus_antigo',
    nome: 'Olho do Deus Antigo',
    preco: 150000,
    tipo: 'amu',
    isEquipavel: true,
    bonusHP: 400,
    bonusMP: 300,
    bonusATK: 45,
    bonusCRIT: 25,
    bonusDEF: 30,
    bonusBLOCO: 25,
    vel: 1.2,
    descricao: 'Olho de um Deus Antigo, concedendo vis√£o e poder divinos',
    elem: 'C√≥smico'
};

// Adicionar os itens raros √† lista de itens
ITEMS.push(itemLordeSombra);
ITEMS.push(itemDragaoAnciao);
ITEMS.push(itemGuerreiroAmaldicoado);
ITEMS.push(itemReiEsqueleto);
ITEMS.push(itemFenix);
ITEMS.push(itemKraken);
ITEMS.push(itemColossoPedra);
ITEMS.push(itemLich);
ITEMS.push(itemBehemoth);
ITEMS.push(itemQuimera);
ITEMS.push(itemSucubo);
ITEMS.push(itemTitan);
ITEMS.push(itemDeusAntigo);

// ========================
// 13 BOSSES COMPLETOS
// ========================

const BOSSES = [
{ 
    nome:'Lorde das Sombras', 
    hp:500, 
    atk:50, 
    def:20, 
    icon:'üòà', 
    gold:[500,1000], 
    drops:[
        ['Po√ß√£o de Cura',0.5],
        ['Sombra da Perdi√ß√£o', 0.4]
    ] 
},
{ 
    nome:'Drag√£o Anci√£o', 
    hp:800, 
    atk:80, 
    def:30, 
    icon:'üêâ', 
    gold:[1000,2000], 
    drops:[
        ['Po√ß√£o de Cura',0.6],
        ['Cora√ß√£o do Drag√£o Anci√£o', 0.35]
    ] 
},
{ 
    nome:'Guerreiro Amaldi√ßoado', 
    hp:600, 
    atk:60, 
    def:25, 
    icon:'üëπ', 
    gold:[700,1500], 
    drops:[
        ['Po√ß√£o de Cura',0.5],
        ['Elmo da Maldi√ß√£o Eterna', 0.4]
    ] 
},
{ 
    nome:'Rei Esqueleto', 
    hp:550, 
    atk:55, 
    def:22, 
    icon:'üíÄ', 
    gold:[600,1200], 
    drops:[
        ['Po√ß√£o de Cura',0.5],
        ['Coroa do Rei Esqueleto', 0.4]
    ] 
},
{ 
    nome:'F√™nix', 
    hp:650, 
    atk:65, 
    def:24, 
    icon:'üî•', 
    gold:[750,1400], 
    drops:[
        ['Po√ß√£o de Cura',0.5],
        ['Pena da F√™nix', 0.35]
    ] 
},
{ 
    nome:'Kraken', 
    hp:700, 
    atk:70, 
    def:26, 
    icon:'üêô', 
    gold:[800,1600], 
    drops:[
        ['Po√ß√£o de Cura',0.6],
        ['Tent√°culo do Kraken', 0.3]
    ] 
},
{ 
    nome:'Colosso de Pedra', 
    hp:900, 
    atk:45, 
    def:50, 
    icon:'üóø', 
    gold:[900,1800], 
    drops:[
        ['Po√ß√£o de Cura',0.5],
        ['Cora√ß√£o de Pedra', 0.4]
    ] 
},
{ 
    nome:'Lich', 
    hp:580, 
    atk:75, 
    def:18, 
    icon:'üßô', 
    gold:[850,1700], 
    drops:[
        ['Po√ß√£o de Cura',0.5],
        ['Cetro do Lich', 0.35]
    ] 
},
{ 
    nome:'Behemoth', 
    hp:1000, 
    atk:85, 
    def:35, 
    icon:'üêó', 
    gold:[1100,2200], 
    drops:[
        ['Po√ß√£o de Cura',0.6],
        ['Pele do Behemoth', 0.3]
    ] 
},
{ 
    nome:'Quimera', 
    hp:720, 
    atk:68, 
    def:28, 
    icon:'üê≤', 
    gold:[950,1900], 
    drops:[
        ['Po√ß√£o de Cura',0.5],
        ['Cabe√ßa da Quimera', 0.4]
    ] 
},
{ 
    nome:'S√∫cubo', 
    hp:520, 
    atk:72, 
    def:16, 
    icon:'üëø', 
    gold:[780,1500], 
    drops:[
        ['Po√ß√£o de Cura',0.5],
        ['Asas do S√∫cubo', 0.4]
    ] 
},
{ 
    nome:'Titan', 
    hp:1200, 
    atk:95, 
    def:40, 
    icon:'üëë', 
    gold:[1500,3000], 
    drops:[
        ['Po√ß√£o de Cura',0.7],
        ['Sangue do Titan', 0.25]
    ] 
},
{ 
    nome:'Deus Antigo', 
    hp:1500, 
    atk:100, 
    def:45, 
    icon:'üåå', 
    gold:[2000,4000], 
    drops:[
        ['Po√ß√£o de Cura',0.8],
        ['Olho do Deus Antigo', 0.2]
    ] 
}
];

// ========================
// Vari√°vel para itens ordenados na loja
let itensOrdenados = [...ITEMS];
let paginaAtual = 1;
const ITENS_POR_PAGINA = 20; // Aumentado para 20 itens por p√°gina

// ========================
// Her√≥i com suporte para rebirth
let heroi = {
nome:'Her√≥i',
lv:1,
hp:100,
maxHp:100,
mp:30,
maxMp:30,
xp:0,
gold:0,
atk:10,
def:5,
crit:3,
bloco:0,
elem:'Neutro',
inventory:[],
equipWeapon:null,
equipOffhand:null,
equipAmulet:null,
// Vari√°veis de rebirth
baseAtkBonus: 0,
baseDefBonus: 0,
baseCritBonus: 0,
xpMultiplier: 1,
rebirthCount: 0
};

// Itens iniciais
const itemInicialArma = { 
    id:'arma_inicial', 
    nome:'Espada de Treino', 
    preco:0, 
    tipo:'arma', 
    isEquipavel:true, 
    min:5, 
    max:10, 
    crit:2, 
    vel:1.0, 
    elem:'Neutro',
    descricao: 'Espada b√°sica para iniciantes'
};
const itemInicialPocao = { 
    id:'pocao_inicial', 
    nome:'Po√ß√£o de Cura', 
    preco:0, 
    tipo:'consum', 
    isEquipavel:false, 
    heal: 100,
    descricao: 'Po√ß√£o b√°sica de cura'
};

// Inimigo atual
let inimigoAtual = null;

// ========================
// LISTA DE INIMIGOS NORMAIS
// ========================

const ENEMIES = [
{ nome:'Esqueleto', hp:50, atk:8, def:2, icon:'üíÄ', gold:[10,20], drops:[['Po√ß√£o de Cura',0.3]] },
{ nome:'M√∫mia', hp:80, atk:12, def:4, icon:'üíÄ', gold:[20,50], drops:[['Po√ß√£o de Cura',0.4]] },
{ nome:'Fara√≥ Fantasma', hp:120, atk:20, def:6, icon:'üëª', gold:[50,100], drops:[['Po√ß√£o de Cura',0.5]] }
];

const nomesExtras = ['Lobisomem', 'G√°rgula', 'Drag√£o Pequeno', 'Goblin', 'Orc', 'Troll', 'Basilisco', 'Vampiro', 'Serpente Gigante', 'Manticora', 'Hidra', 'S√∫cubo', 'Quimera', 'Lamia', 'Harpia', 'F√™nix', 'Minotauro', 'Espectro', 'Demonio', 'Verdadeiro Dem√¥nio', 'Lobo Sombrio', 'Esquilo Assassino', 'Rato Gigante', 'Aranha Mortal', 'Cobra Gigante', 'Le√£o Selvagem', 'Urso Selvagem', 'Lobo Polido', 'Saci', 'Bicho-Pap√£o', 'Cuca', 'Sereia', 'Sirene', 'Naga'];
for(let i=0; i<396; i++){
const nomeAleatorio = nomesExtras[Math.floor(Math.random()*nomesExtras.length)];
const hpBase=40+Math.floor(Math.random()*30);
const atkBase=6+Math.floor(Math.random()*6);
const defBase=2+Math.floor(Math.random()*3);
const goldMin=5+Math.floor(Math.random()*10);
const goldMax=goldMin+Math.floor(Math.random()*10);
ENEMIES.push({ nome:nomeAleatorio, hp:hpBase, atk:atkBase, def:defBase, icon:'üëπ', gold:[goldMin,goldMax], drops:[['Po√ß√£o de Cura',0.2+Math.random()*0.3]] });
}

// ========================
// Sistema de Pesquisa
// ========================

function pesquisarItens(termo) {
    const resultadosDiv = document.getElementById('searchResults');
    resultadosDiv.innerHTML = '';
    
    if (termo.length < 2) {
        resultadosDiv.style.display = 'none';
        return;
    }
    
    const termoLower = termo.toLowerCase();
    const resultados = ITEMS.filter(item => 
        item.nome.toLowerCase().includes(termoLower) || 
        item.tipo.toLowerCase().includes(termoLower) ||
        (item.elem && item.elem.toLowerCase().includes(termoLower)) ||
        (item.descricao && item.descricao.toLowerCase().includes(termoLower))
    ).slice(0, 15); // Aumentado para 15 resultados
    
    if (resultados.length === 0) {
        resultadosDiv.innerHTML = '<div class="search-result-item">Nenhum item encontrado</div>';
    } else {
        resultados.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'search-result-item';
            itemDiv.innerHTML = `
                <div class="search-result-name">${item.nome} (${item.tipo})</div>
                <div class="search-result-stats">${formatarStatsResumo(item)} | Pre√ßo: PO ${item.preco.toLocaleString()}</div>
            `;
            itemDiv.onclick = () => {
                document.getElementById('searchInput').value = item.nome;
                resultadosDiv.style.display = 'none';
                focarNoItem(item.id);
            };
            resultadosDiv.appendChild(itemDiv);
        });
    }
    
    resultadosDiv.style.display = 'block';
}

function formatarStatsResumo(item) {
    const stats = [];
    if (item.min && item.max) stats.push(`ATK:${item.min}-${item.max}`);
    if (item.crit) stats.push(`CRIT:+${item.crit}%`);
    if (item.def) stats.push(`DEF:+${item.def}`);
    if (item.bloco) stats.push(`BLOCO:${item.bloco}%`);
    if (item.elem) stats.push(item.elem);
    if (item.bonusHP) stats.push(`HP:+${item.bonusHP}`);
    if (item.bonusMP) stats.push(`MP:+${item.bonusMP}`);
    if (item.bonusATK) stats.push(`ATK:+${item.bonusATK}`);
    if (item.bonusCRIT) stats.push(`CRIT:+${item.bonusCRIT}%`);
    if (item.bonusBLOCO) stats.push(`BLOCO:+${item.bonusBLOCO}%`);
    if (item.heal) stats.push(`CURA:${item.heal}`);
    
    return stats.slice(0, 3).join(' '); // Limita a 3 stats para n√£o ficar muito longo
}

function focarNoItem(itemId) {
    const itemIndex = itensOrdenados.findIndex(item => item.id === itemId);
    if (itemIndex !== -1) {
        const novaPagina = Math.floor(itemIndex / ITENS_POR_PAGINA) + 1;
        paginaAtual = novaPagina;
        mostrarItens();
        
        setTimeout(() => {
            const itemElement = document.querySelector(`[onclick="comprarItem('${itemId}')"]`);
            if (itemElement) {
                itemElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                itemElement.parentElement.style.backgroundColor = 'var(--accent)';
                itemElement.parentElement.style.color = 'var(--bg)';
                setTimeout(() => {
                    itemElement.parentElement.style.backgroundColor = '';
                    itemElement.parentElement.style.color = '';
                }, 2000);
            }
        }, 100);
    }
}

// ========================
// FUN√á√ÉO PARA MOSTRAR TODOS OS ITENS COM STATUS
// ========================

function mostrarTodosItens() {
    const container = document.getElementById('todosItens');
    const todosContainer = document.getElementById('todosItensContainer');
    
    // Alternar visibilidade
    if (todosContainer.style.display === 'none' || todosContainer.style.display === '') {
        todosContainer.style.display = 'block';
        container.innerHTML = '';
        
        // Ordenar itens por tipo e pre√ßo para melhor visualiza√ß√£o
        const itensOrdenados = [...ITEMS].sort((a, b) => {
            // Primeiro ordena por tipo
            if (a.tipo !== b.tipo) {
                const tipoOrder = { 'arma': 1, 'off': 2, 'amu': 3, 'equip': 4, 'consum': 5 };
                return (tipoOrder[a.tipo] || 6) - (tipoOrder[b.tipo] || 6);
            }
            // Depois por pre√ßo (decrescente)
            return b.preco - a.preco;
        });
        
        itensOrdenados.forEach(item => {
            const card = document.createElement('div');
            const isBossItem = item.id && item.id.includes('boss_item');
            const isLendario = item.preco > 5000000;
            const isConsumivel = item.tipo === 'consum';
            
            let cardClass = 'item-card';
            if (isBossItem) cardClass += ' boss-item';
            if (isLendario) cardClass += ' legendary-item';
            if (isConsumivel) cardClass += ' consumable';
            
            card.className = cardClass;
            
            // Montar HTML do card
            card.innerHTML = `
                <div class="item-header">
                    <div>
                        <div class="item-name">${item.nome}</div>
                        <div class="item-type">${item.tipo.toUpperCase()}</div>
                    </div>
                    <div class="item-price">PO ${item.preco.toLocaleString()}</div>
                </div>
                
                <div class="item-stats">
                    ${formatarTodosStats(item)}
                </div>
                
                <div class="item-tags">
                    ${isBossItem ? '<span class="item-tag boss">BOSS</span>' : ''}
                    ${isLendario ? '<span class="item-tag legendary">LEND√ÅRIO</span>' : ''}
                    ${item.isEquipavel ? '<span class="item-tag">EQUIP√ÅVEL</span>' : ''}
                    ${item.elem ? `<span class="item-tag">${item.elem}</span>` : ''}
                    ${item.heal ? '<span class="item-tag consumable">CONSUM√çVEL</span>' : ''}
                </div>
            `;
            
            container.appendChild(card);
        });
        
        document.getElementById('searchInput').scrollIntoView({ behavior: 'smooth' });
    } else {
        todosContainer.style.display = 'none';
    }
}

function formatarTodosStats(item) {
    let html = '';
    
    // Dano para armas
    if (item.min && item.max) {
        html += `<div class="stat-line">
            <span class="stat-label">Dano:</span>
            <span class="stat-value positive">${item.min}-${item.max}</span>
        </div>`;
    }
    
    // Cr√≠tico
    if (item.crit) {
        html += `<div class="stat-line">
            <span class="stat-label">Cr√≠tico:</span>
            <span class="stat-value positive">+${item.crit}%</span>
        </div>`;
    }
    
    // Defesa
    if (item.def) {
        html += `<div class="stat-line">
            <span class="stat-label">Defesa:</span>
            <span class="stat-value positive">+${item.def}</span>
        </div>`;
    }
    
    // Bloqueio
    if (item.bloco) {
        html += `<div class="stat-line">
            <span class="stat-label">Bloqueio:</span>
            <span class="stat-value positive">+${item.bloco}%</span>
        </div>`;
    }
    
    // Velocidade
    if (item.vel) {
        html += `<div class="stat-line">
            <span class="stat-label">Velocidade:</span>
            <span class="stat-value">${item.vel}</span>
        </div>`;
    }
    
    // Elemento
    if (item.elem) {
        html += `<div class="stat-line">
            <span class="stat-label">Elemento:</span>
            <span class="stat-value element">${item.elem}</span>
        </div>`;
    }
    
    // B√¥nus HP
    if (item.bonusHP) {
        html += `<div class="stat-line">
            <span class="stat-label">B√¥nus HP:</span>
            <span class="stat-value positive">+${item.bonusHP}</span>
        </div>`;
    }
    
    // B√¥nus MP
    if (item.bonusMP) {
        html += `<div class="stat-line">
            <span class="stat-label">B√¥nus MP:</span>
            <span class="stat-value positive">+${item.bonusMP}</span>
        </div>`;
    }
    
    // B√¥nus ATK
    if (item.bonusATK) {
        html += `<div class="stat-line">
            <span class="stat-label">B√¥nus ATK:</span>
            <span class="stat-value positive">+${item.bonusATK}</span>
        </div>`;
    }
    
    // B√¥nus DEF
    if (item.bonusDEF) {
        html += `<div class="stat-line">
            <span class="stat-label">B√¥nus DEF:</span>
            <span class="stat-value positive">+${item.bonusDEF}</span>
        </div>`;
    }
    
    // B√¥nus CRIT
    if (item.bonusCRIT) {
        html += `<div class="stat-line">
            <span class="stat-label">B√¥nus CRIT:</span>
            <span class="stat-value positive">+${item.bonusCRIT}%</span>
        </div>`;
    }
    
    // B√¥nus BLOCO
    if (item.bonusBLOCO) {
        html += `<div class="stat-line">
            <span class="stat-label">B√¥nus BLOCO:</span>
            <span class="stat-value positive">+${item.bonusBLOCO}%</span>
        </div>`;
    }
    
    // Cura (para consum√≠veis)
    if (item.heal) {
        html += `<div class="stat-line">
            <span class="stat-label">Cura:</span>
            <span class="stat-value positive">${item.heal} HP</span>
        </div>`;
    }
    
    // Descri√ß√£o
    if (item.descricao) {
        html += `<div class="stat-line" style="margin-top: 8px; font-style: italic; color: var(--muted);">
            <span>${item.descricao}</span>
        </div>`;
    }
    
    return html;
}

// ========================
// FUN√á√ïES PARA O CICLO COMPLETO DE EQUIPAR/DESEQUIPAR
// ========================

function desequiparItem(slot) {
    let itemRemovido = null;
    let statsRemovidos = { atk: 0, def: 0, crit: 0, bloco: 0 };
    
    if (slot === 'weapon' && heroi.equipWeapon) {
        itemRemovido = heroi.equipWeapon;
        heroi.equipWeapon = null;
        statsRemovidos.crit = itemRemovido.crit || 0;
        statsRemovidos.atk = itemRemovido.bonusATK || 0;
    } else if (slot === 'offhand' && heroi.equipOffhand) {
        itemRemovido = heroi.equipOffhand;
        heroi.equipOffhand = null;
        statsRemovidos.def = itemRemovido.def || 0;
        statsRemovidos.bloco = itemRemovido.bloco || 0;
    } else if (slot === 'amulet' && heroi.equipAmulet) {
        itemRemovido = heroi.equipAmulet;
        heroi.equipAmulet = null;
        statsRemovidos.atk = itemRemovido.bonusATK || 0;
        statsRemovidos.crit = itemRemovido.bonusCRIT || 0;
        statsRemovidos.bloco = itemRemovido.bonusBLOCO || 0;
        statsRemovidos.def = itemRemovido.bonusDEF || 0;
    }
    
    if (itemRemovido) {
        heroi.atk -= statsRemovidos.atk;
        heroi.def -= statsRemovidos.def;
        heroi.crit -= statsRemovidos.crit;
        heroi.bloco -= statsRemovidos.bloco;
        
        heroi.atk = Math.max(1, heroi.atk);
        heroi.def = Math.max(0, heroi.def);
        heroi.crit = Math.max(0, heroi.crit);
        heroi.bloco = Math.max(0, heroi.bloco);
        
        let itemExistente = heroi.inventory.find(i => i.id === itemRemovido.id);
        if (itemExistente) {
            itemExistente.quantidade = (itemExistente.quantidade || 1) + 1;
        } else {
            heroi.inventory.push({ ...itemRemovido, quantidade: 1 });
        }
        
        atualizarInventario();
        atualizarStatus();
    }
}

function equiparItemDoInventario(id) {
    const itemIndex = heroi.inventory.findIndex(i => i.id === id);
    if (itemIndex === -1) return;
    const item = heroi.inventory[itemIndex];

    let itemRemovido = null;
    let statsAdicionados = { atk: 0, def: 0, crit: 0, bloco: 0 };
    let statsRemovidos = { atk: 0, def: 0, crit: 0, bloco: 0 };
    
    let slotAlvo = '';
    if (item.tipo === 'arma') {
        slotAlvo = 'weapon';
        itemRemovido = heroi.equipWeapon;
        heroi.equipWeapon = item;
        statsAdicionados.crit = item.crit || 0;
        statsAdicionados.atk = item.bonusATK || 0;
        if (itemRemovido) {
            statsRemovidos.crit = itemRemovido.crit || 0;
            statsRemovidos.atk = itemRemovido.bonusATK || 0;
        }
    } else if (item.tipo === 'off') {
        slotAlvo = 'offhand';
        itemRemovido = heroi.equipOffhand;
        heroi.equipOffhand = item;
        statsAdicionados.def = item.def || 0;
        statsAdicionados.bloco = item.bloco || 0;
        if (itemRemovido) {
            statsRemovidos.def = itemRemovido.def || 0;
            statsRemovidos.bloco = itemRemovido.bloco || 0;
        }
    } else if (item.tipo === 'amu') {
        slotAlvo = 'amulet';
        itemRemovido = heroi.equipAmulet;
        heroi.equipAmulet = item;
        statsAdicionados.atk = item.bonusATK || 0;
        statsAdicionados.crit = item.bonusCRIT || 0;
        statsAdicionados.bloco = item.bonusBLOCO || 0;
        statsAdicionados.def = item.bonusDEF || 0;
        if (itemRemovido) {
            statsRemovidos.atk = itemRemovido.bonusATK || 0;
            statsRemovidos.crit = itemRemovido.bonusCRIT || 0;
            statsRemovidos.bloco = itemRemovido.bonusBLOCO || 0;
            statsRemovidos.def = itemRemovido.bonusDEF || 0;
        }
    } else if (item.tipo === 'equip') {
        slotAlvo = 'weapon';
        itemRemovido = heroi.equipWeapon;
        heroi.equipWeapon = item;
        statsAdicionados.crit = item.crit || 0;
        statsAdicionados.def = item.def || 0;
        statsAdicionados.bloco = item.bloco || 0;
        if (itemRemovido) {
            statsRemovidos.crit = itemRemovido.crit || 0;
            statsRemovidos.def = itemRemovido.def || 0;
            statsRemovidos.bloco = itemRemovido.bloco || 0;
        }
    } else {
        adicionarNotificacao('Este item n√£o pode ser equipado.', 'warning');
        return;
    }

    if (item.quantidade && item.quantidade > 1) {
        item.quantidade--;
    } else {
        heroi.inventory.splice(itemIndex, 1);
    }

    heroi.atk -= statsRemovidos.atk;
    heroi.def -= statsRemovidos.def;
    heroi.crit -= statsRemovidos.crit;
    heroi.bloco -= statsRemovidos.bloco;
    
    heroi.atk += statsAdicionados.atk;
    heroi.def += statsAdicionados.def;
    heroi.crit += statsAdicionados.crit;
    heroi.bloco += statsAdicionados.bloco;
    
    heroi.atk = Math.max(1, heroi.atk);
    heroi.def = Math.max(0, heroi.def);
    heroi.crit = Math.max(0, heroi.crit);
    heroi.bloco = Math.max(0, heroi.bloco);

    if (itemRemovido) {
        let itemExistente = heroi.inventory.find(i => i.id === itemRemovido.id);
        if (itemExistente) {
            itemExistente.quantidade = (itemExistente.quantidade || 1) + 1;
        } else {
            heroi.inventory.push({ ...itemRemovido, quantidade: 1 });
        }
    }

    atualizarInventario();
    atualizarStatus();
}

// ========================
// FUN√á√ÉO PARA DESCARTAR ITEM DO INVENT√ÅRIO
// ========================

function descartarItemDoInventario(id) {
    const itemIndex = heroi.inventory.findIndex(i => i.id === id);
    if (itemIndex === -1) return;
    
    const item = heroi.inventory[itemIndex];
    
    if (confirm(`Tem certeza que deseja descartar "${item.nome}"?\n\nATEN√á√ÉO: Este item ser√° PERDIDO permanentemente!`)) {
        const isEquipped = 
            (heroi.equipWeapon && heroi.equipWeapon.id === id) ||
            (heroi.equipOffhand && heroi.equipOffhand.id === id) ||
            (heroi.equipAmulet && heroi.equipAmulet.id === id);
        
        if (isEquipped) {
            adicionarNotificacao('N√£o √© poss√≠vel descartar um item que est√° equipado! Desequipe-o primeiro.', 'warning');
            return;
        }
        
        if (item.quantidade && item.quantidade > 1) {
            item.quantidade--;
        } else {
            heroi.inventory.splice(itemIndex, 1);
        }
        
        atualizarInventario();
        atualizarStatus();
        salvarNoLocalStorage();
    }
}

// ========================
// SISTEMA DE LUTA ATUALIZADO PARA N√çVEIS ALTOS
// ========================

function calcularDano(atacanteATK, defensorDEF, nivelAtacante = 1) {
    let danoBase = atacanteATK - defensorDEF;
    
    const bonusNivel = 1 + (Math.log10(nivelAtacante) * 0.1);
    
    let dano = Math.max(1, Math.floor(danoBase * bonusNivel));
    
    const variacao = 0.9 + Math.random() * 0.2;
    dano = Math.floor(dano * variacao);
    
    return dano;
}

// ========================
// SISTEMA DE REBIRTH
// ========================

function verificarRebirth() {
    if (heroi.lv >= 1000 && confirm(`Voc√™ atingiu o n√≠vel ${heroi.lv}! Deseja fazer Rebirth?\n\nReiniciar√° para n√≠vel 1 mas ganhar√°:\n‚Ä¢ +10% em todos os status base\n‚Ä¢ T√≠tulo de prest√≠gio\n‚Ä¢ Multiplicador de XP: 2.0x`)) {
        const bonusPercent = 0.1;
        
        heroi.baseAtkBonus = (heroi.baseAtkBonus || 0) + Math.floor(heroi.atk * bonusPercent);
        heroi.baseDefBonus = (heroi.baseDefBonus || 0) + Math.floor(heroi.def * bonusPercent);
        heroi.baseCritBonus = (heroi.baseCritBonus || 0) + (heroi.crit * bonusPercent);
        heroi.xpMultiplier = (heroi.xpMultiplier || 1) * 2;
        heroi.rebirthCount = (heroi.rebirthCount || 0) + 1;
        
        heroi.lv = 1;
        heroi.xp = 0;
        heroi.gold = Math.floor(heroi.gold * 0.1);
        heroi.maxHp = 100 + (heroi.rebirthCount * 50);
        heroi.hp = heroi.maxHp;
        heroi.maxMp = 30 + (heroi.rebirthCount * 10);
        heroi.mp = heroi.maxMp;
        
        heroi.atk = 10 + (heroi.baseAtkBonus || 0);
        heroi.def = 5 + (heroi.baseDefBonus || 0);
        heroi.crit = 3 + (heroi.baseCritBonus || 0);
        
        adicionarNotificacao(`üéâ REBIRTH COMPLETO! Voc√™ agora tem ${heroi.rebirthCount} rebirth(s)!`, 'important');
        
        atualizarStatus();
    }
}

// ========================
// FUN√á√ÉO CORRIGIDA PARA USAR PO√á√ÉO
// ========================

function usarPocao() {
    // Procura por po√ß√µes de cura no invent√°rio
    const pocaoIndex = heroi.inventory.findIndex(i => 
        (i.nome && i.nome.includes('Po√ß√£o') && i.tipo === 'consum' && i.heal) ||
        (i.id && i.id.includes('pocao'))
    );
    
    if(pocaoIndex === -1){
        adicionarNotificacao('Voc√™ n√£o tem po√ß√µes de cura no invent√°rio.', 'warning');
        return;
    }

    const pocao = heroi.inventory[pocaoIndex];

    if(heroi.hp >= heroi.maxHp){
        adicionarNotificacao('Seu HP j√° est√° no m√°ximo!', 'warning');
        return;
    }

    const curaAntes = heroi.hp;
    const curaReal = Math.min(pocao.heal || 100, heroi.maxHp - heroi.hp);
    heroi.hp += curaReal;
    
    // Encontra o bot√£o "Usar Po√ß√£o" para posicionar a anima√ß√£o
    const btnUsarPocao = document.getElementById('btnUsarPocao');
    if (btnUsarPocao) {
        // ANIMA√á√ÉO VERDE PARA CURA - aparecendo no bot√£o da po√ß√£o
        mostrarAnimacaoDano(curaReal, '', btnUsarPocao, false, false, true);
    }
    
    // Decrementa a quantidade ou remove do invent√°rio
    if (pocao.quantidade && pocao.quantidade > 1) {
        pocao.quantidade--;
    } else {
        heroi.inventory.splice(pocaoIndex, 1);
    }
    
    adicionarNotificacao(`Voc√™ usou uma ${pocao.nome} e recuperou ${curaReal} HP.`);
    atualizarStatus();
    atualizarInventario();
    salvarNoLocalStorage();
}

// ========================
// FUN√á√ÉO CORRIGIDA PARA USAR PO√á√ÉO ESPEC√çFICA
// ========================

function usarPocaoEspecifica(id) {
    const pocaoIndex = heroi.inventory.findIndex(i => i.id === id && i.tipo === 'consum' && i.heal);
    if(pocaoIndex === -1){
        adicionarNotificacao('Po√ß√£o n√£o encontrada no invent√°rio.', 'warning');
        return;
    }
    
    const pocao = heroi.inventory[pocaoIndex];
    
    if(heroi.hp >= heroi.maxHp){
        adicionarNotificacao('Seu HP j√° est√° no m√°ximo!', 'warning');
        return;
    }
    
    const curaAntes = heroi.hp;
    const curaReal = Math.min(pocao.heal, heroi.maxHp - heroi.hp);
    heroi.hp += curaReal;
    
    // Encontra o bot√£o espec√≠fico da po√ß√£o no invent√°rio
    const btnUsarEspecifico = document.querySelector(`button[onclick*="${id}"]`);
    if (btnUsarEspecifico) {
        // ANIMA√á√ÉO VERDE PARA CURA - aparecendo no bot√£o da po√ß√£o espec√≠fica
        mostrarAnimacaoDano(curaReal, '', btnUsarEspecifico, false, false, true);
    } else {
        // Fallback para o bot√£o geral de po√ß√£o
        const btnUsarPocao = document.getElementById('btnUsarPocao');
        if (btnUsarPocao) {
            mostrarAnimacaoDano(curaReal, '', btnUsarPocao, false, false, true);
        }
    }
    
    if (pocao.quantidade && pocao.quantidade > 1) {
        pocao.quantidade--;
    } else {
        heroi.inventory.splice(pocaoIndex, 1);
    }
    
    adicionarNotificacao(`Voc√™ usou uma ${pocao.nome} e recuperou ${curaReal} HP.`);
    atualizarStatus();
    atualizarInventario();
    salvarNoLocalStorage();
}

// Event Listeners para o sistema de pesquisa
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    
    searchInput.addEventListener('input', function(e) {
        pesquisarItens(e.target.value);
    });
    
    searchInput.addEventListener('focus', function() {
        if (searchInput.value.length >= 2) {
            pesquisarItens(searchInput.value);
        }
    });
    
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.style.display = 'none';
        }
    });
    
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            searchResults.style.display = 'none';
            searchInput.blur();
        }
    });
    
    inicializarBackup();
    inicializarNotificacoes();
    
    const backupModal = document.getElementById('backupModal');
    backupModal.addEventListener('click', function(e) {
        if (e.target === backupModal) {
            fecharModalBackup();
        }
    });
    
    const confirmModal = document.getElementById('confirmRecomecarModal');
    confirmModal.addEventListener('click', function(e) {
        if (e.target === confirmModal) {
            fecharConfirmacaoRecomecar();
        }
    });
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            fecharModalBackup();
            fecharConfirmacaoRecomecar();
        }
    });
});

// ========================
// Fun√ß√µes para salvar e carregar
function salvarNoLocalStorage() {
localStorage.setItem('gameState', JSON.stringify(heroi));
}
function carregarDoLocalStorage() {
const data = localStorage.getItem('gameState');
if (data) {
const p = JSON.parse(data);
Object.assign(heroi, p);
}
}

// ==========================================================
// FUN√á√ïES DE EXIBI√á√ÉO DE ITENS (COM ATRIBUTOS VIS√çVEIS)
// ==========================================================

function gerarAtributosParaItem(item) {
    const atributos = [];
    
    // Adiciona atributos baseados no tipo de item
    if (item.min && item.max) atributos.push(`${item.min}-${item.max} ATK`);
    if (item.crit) atributos.push(`${item.crit}% CRIT`);
    if (item.def) atributos.push(`${item.def} DEF`);
    if (item.bloco) atributos.push(`${item.bloco}% BLOCO`);
    if (item.elem) atributos.push(`${item.elem}`);
    if (item.bonusHP) atributos.push(`${item.bonusHP} HP`);
    if (item.bonusMP) atributos.push(`${item.bonusMP} MP`);
    if (item.bonusATK) atributos.push(`${item.bonusATK} B-ATK`);
    if (item.bonusDEF) atributos.push(`${item.bonusDEF} B-DEF`);
    if (item.bonusCRIT) atributos.push(`${item.bonusCRIT}% B-CRIT`);
    if (item.bonusBLOCO) atributos.push(`${item.bonusBLOCO}% B-BLOCO`);
    if (item.heal) atributos.push(`${item.heal} CURA`);
    
    // Se n√£o tiver atributos suficientes, gera alguns baseados no pre√ßo
    if (atributos.length < 2) {
        const baseVal = Math.floor(Math.pow(item.preco, 1/3.5));
        
        // Gera atributos autom√°ticos baseados no tipo
        if (item.tipo === 'arma' || item.tipo === 'equip') {
            if (!item.min && !item.max) {
                const atk = Math.floor(baseVal * 1.5) + 3;
                atributos.push(`${atk} ATK`);
            }
            if (!item.crit) {
                const crit = Math.floor(baseVal / 2) + 1;
                if (crit > 0) atributos.push(`${crit}% CRIT`);
            }
        } else if (item.tipo === 'off') {
            if (!item.def) {
                const def = Math.floor(baseVal) + 2;
                atributos.push(`${def} DEF`);
            }
            if (!item.bloco) {
                const bloco = Math.floor(baseVal / 2) + 3;
                if (bloco > 0) atributos.push(`${bloco}% BLOCO`);
            }
        } else if (item.tipo === 'amu') {
            const hp = Math.floor(baseVal * 2) + 10;
            const mp = Math.floor(baseVal) + 5;
            atributos.push(`${hp} HP`);
            atributos.push(`${mp} MP`);
        } else if (item.tipo === 'consum') {
            if (!item.heal) {
                const heal = Math.floor(baseVal * 3) + 50;
                atributos.push(`${heal} CURA`);
            }
        }
        
        // Adiciona atributos gen√©ricos se ainda estiver faltando
        if (atributos.length < 2) {
            const hpBonus = Math.floor(baseVal * 1.2) + 8;
            const mpBonus = Math.floor(baseVal * 0.8) + 3;
            atributos.push(`${hpBonus} HP`);
            atributos.push(`${mpBonus} MP`);
        }
    }
    
    return atributos;
}

function formatarAtributosVisiveis(item) {
    // Garante que o item tenha atributos
    const atributos = gerarAtributosParaItem(item);
    
    let html = `<div class="item-attributes">`;
    
    // Limita a 4 atributos para n√£o ficar muito longo
    atributos.slice(0, 4).forEach(attr => {
        html += `<span class="attr-badge">${attr}</span>`;
    });
    
    // Adiciona indicador se for item raro ou lend√°rio
    if (item.id && item.id.includes('boss_item')) {
        html += `<span class="attr-badge" style="background: rgba(212, 167, 97, 0.3); border-color: var(--accent);">‚ú® RARO</span>`;
    }
    if (item.preco > 5000000) {
        html += `<span class="attr-badge" style="background: rgba(255, 215, 0, 0.2); border-color: gold;">üëë LEND√ÅRIO</span>`;
    }
    
    html += `</div>`;
    return html;
}

// 1. Mostrar itens na loja com pagina√ß√£o
function mostrarItens() {
    const container = document.getElementById('itensContainer');
    container.innerHTML = '';

    const inicio = (paginaAtual - 1) * ITENS_POR_PAGINA;
    const fim = inicio + ITENS_POR_PAGINA;
    const itensNaPagina = itensOrdenados.slice(inicio, fim);

    for(let item of itensNaPagina){
        const statsHtml = formatarAtributosVisiveis(item);
        const isBossItem = item.id && item.id.includes('boss_item');
        const isLendario = item.preco > 5000000;
        const itemStyle = isBossItem ? 'border: 2px solid var(--accent); background: rgba(212, 167, 97, 0.1);' : 
                         isLendario ? 'border: 2px solid gold; background: rgba(255, 215, 0, 0.05);' : '';
        const precoColor = isLendario ? 'color: gold; font-weight: bold;' : '';
        
        container.innerHTML += `<div class="item-entry" style="display:flex; justify-content:space-between; align-items:center; padding:8px; border-bottom:1px solid #555; ${itemStyle}">
            <div class="item-info">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <b>${item.nome}</b> ${isBossItem ? '‚ú®' : ''}${isLendario ? ' üëë' : ''} 
                    <span style="font-size: 12px; color: var(--muted);">(${item.tipo})</span>
                </div>
                ${statsHtml}
                <div style="${precoColor} margin-top: 4px;">Pre√ßo: <b>PO ${item.preco.toLocaleString()}</b></div>
            </div>
            <button class="buttonnn" onclick="comprarItem('${item.id}')">Comprar</button>
        </div>`;
    }

    const totalPaginas = Math.ceil(itensOrdenados.length / ITENS_POR_PAGINA);
    document.getElementById('pageInfo').textContent = `P√°gina ${paginaAtual} de ${totalPaginas}`;
    document.getElementById('prevPageBtn').disabled = paginaAtual === 1;
    document.getElementById('nextPageBtn').disabled = paginaAtual === totalPaginas;
}

function ordenarItens(ordem) {
if(ordem==='asc'){
itensOrdenados = [...ITEMS].sort((a,b)=>a.preco-b.preco);
} else {
itensOrdenados = [...ITEMS].sort((a,b)=>b.preco-a.preco);
}
paginaAtual = 1;
mostrarItens();
}

function mudarPagina(direcao) {
const totalPaginas = Math.ceil(ITEMS.length / ITENS_POR_PAGINA);
if (direcao === 1 && paginaAtual < totalPaginas) {
paginaAtual++;
} else if (direcao === -1 && paginaAtual > 1) {
paginaAtual--;
}
mostrarItens();
}

function comprarItem(id) {
const item = ITEMS.find(i=>i.id===id);
if(!item) return;
if(heroi.gold < item.preco){
adicionarNotificacao('Ouro insuficiente para comprar este item.', 'warning');
return;
}
heroi.gold -= item.preco;
let invItem = heroi.inventory.find(i=>i.id===item.id);
if(invItem){
invItem.quantidade=(invItem.quantidade||1)+1;
} else {
heroi.inventory.push({ ...item, quantidade:1 });
}

const isBossItem = item.id && item.id.includes('boss_item');
const isLendario = item.preco > 5000000;
if (isBossItem) {
    adicionarNotificacao(`üéâ VOC√ä COMPROU UM ITEM RARO: ${item.nome}!`, 'important');
} else if (isLendario) {
    adicionarNotificacao(`üëë VOC√ä COMPROU UM ITEM LEND√ÅRIO: ${item.nome}!`, 'important');
} else {
    adicionarNotificacao(`Voc√™ comprou: ${item.nome}`);
}

atualizarInventario();
atualizarStatus();
}

// 2. Atualizar invent√°rio COM BOT√ïES DE USAR PO√á√ÉO ESPEC√çFICA
function atualizarInventario() {
    const div = document.getElementById('inventory');
    div.innerHTML='';
    heroi.inventory.forEach(i => {
        const statsHtml = formatarAtributosVisiveis(i);
        const isBossItem = i.id && i.id.includes('boss_item');
        const isLendario = i.preco > 5000000;
        const isConsumivel = i.tipo === 'consum' && i.heal;
        const itemStyle = isBossItem ? 'border-left: 3px solid var(--accent); padding-left: 5px;' : 
                         isLendario ? 'border-left: 3px solid gold; padding-left: 5px;' : '';
        
        let itemHtml = `<div style="display: flex; justify-content: space-between; align-items: center; ${itemStyle}">
            <div style="flex-grow: 1;">
                <div><b>${i.nome}</b> ${isBossItem ? '‚ú®' : ''}${isLendario ? ' üëë' : ''} x${i.quantidade}</div>
                ${statsHtml}
            </div>
            <div>`;
        
        if (i.isEquipavel) {
            itemHtml += `<button class="equip-btn" onclick="equiparItemDoInventario('${i.id}')">Equipar</button>`;
        }
        
        // Adiciona bot√£o de usar para po√ß√µes
        if (isConsumivel) {
            itemHtml += `<button class="equip-btn" style="background: #a3bf3f !important;" onclick="usarPocaoEspecifica('${i.id}')">Usar</button>`;
        }
        
        itemHtml += `<button class="desequip-btn" onclick="descartarItemDoInventario('${i.id}')" style="margin-left: 5px;">üóëÔ∏è</button>`;
        
        itemHtml += `</div></div>`;
        div.innerHTML += itemHtml;
    });
}

// ========================
// Sistema de luta com escalonamento de n√≠vel
// ========================

function encontrarInimigo() {
    const chanceBoss = 0.05 + (Math.min(heroi.lv, 1000) * 0.0001);
    if (Math.random() < chanceBoss) {
        const boss = BOSSES[Math.floor(Math.random() * BOSSES.length)];
        inimigoAtual = { ...boss };
        
        const multiplicadorNivel = 1 + (heroi.lv * 0.01);
        inimigoAtual.hp = Math.floor(inimigoAtual.hp * multiplicadorNivel);
        inimigoAtual.atk = Math.floor(inimigoAtual.atk * multiplicadorNivel);
        inimigoAtual.def = Math.floor(inimigoAtual.def * multiplicadorNivel);
        
        inimigoAtual.hpMax = inimigoAtual.hp;
        adicionarNotificacao(`üö® UM CHEFE APARECEU: ${boss.nome}! üö®`, 'important');
    } else {
        const inim = ENEMIES[Math.floor(Math.random() * ENEMIES.length)];
        inimigoAtual = { ...inim };
        
        const multiplicadorNivel = 1 + (heroi.lv * 0.005);
        inimigoAtual.hp = Math.floor(inimigoAtual.hp * multiplicadorNivel);
        inimigoAtual.atk = Math.floor(inimigoAtual.atk * multiplicadorNivel);
        inimigoAtual.def = Math.floor(inimigoAtual.def * multiplicadorNivel);
        
        inimigoAtual.hpMax = inimigoAtual.hp;
    }
    
    const nivelTexto = heroi.lv > 100 ? ` (Escalonado Nv ${heroi.lv})` : '';
    document.getElementById('enemyIcon').textContent = inimigoAtual.icon;
    document.getElementById('enemyNome').textContent = inimigoAtual.nome + nivelTexto;
    document.getElementById('enemyHP').textContent = `${inimigoAtual.hp}/${inimigoAtual.hp}`;
    document.getElementById('enemyMaxHP').textContent = inimigoAtual.hp;
    document.getElementById('btnAtacar').disabled = false;
    document.getElementById('btnSair').disabled = false;
}

function sairDoCombate() {
    if (!inimigoAtual) return;

    document.querySelector('.container').style.display = 'none';
    document.getElementById('lutaSistema').style.display = 'none';

    const videoContainer = document.getElementById('videoContainer');
    const cutsceneVideo = document.getElementById('cutsceneVideo');

    videoContainer.style.display = 'block';

    cutsceneVideo.onended = function() {
        window.close();
        location.reload(); 
    };

    cutsceneVideo.play().catch(error => {
        adicionarNotificacao('Falha ao iniciar a cutscene. O jogo ser√° reiniciado.', 'warning');
        setTimeout(() => location.reload(), 1000);
    });
}

// ========================
// ATUALIZA√á√ÉO DAS FUN√á√ïES QUE USAM ANIMA√á√ÉO
// ========================

function atacar() {
    if(!inimigoAtual) return;
    
    const chanceBloco = heroi.bloco / 100;
    const isBloqueado = Math.random() < chanceBloco;
    
    let danoHeroi = 0;
    
    if (isBloqueado) {
        adicionarNotificacao("üõ°Ô∏è ATAQUE BLOQUEADO!", 'important');
        // Anima√ß√£o de bloqueado no inimigo
        mostrarAnimacaoDano(0, 'enemy', document.getElementById('enemyDisplay'), false, true);
    } else {
        const ataqueHeroi = heroi.atk;
        const defesaInimigo = parseInt(inimigoAtual.def) || 0;
        danoHeroi = calcularDano(ataqueHeroi, defesaInimigo, heroi.lv);
        
        const chanceCrit = (heroi.crit || 0) / 100;
        const isCritico = Math.random() < chanceCrit;
        
        if (isCritico) {
            danoHeroi = Math.floor(danoHeroi * 1.5);
            adicionarNotificacao("üéØ CR√çTICO!", 'important');
        }
        
        inimigoAtual.hp -= danoHeroi;
        if(inimigoAtual.hp < 0) inimigoAtual.hp = 0;
        
        // Anima√ß√£o de dano VERMELHA no inimigo
        mostrarAnimacaoDano(danoHeroi, 'enemy', document.getElementById('enemyDisplay'), isCritico, false);
        
        let mensagemDano = isCritico ? 
            `Voc√™ causou ${danoHeroi} de dano CR√çTICO em ${inimigoAtual.nome}!` :
            `Voc√™ causou ${danoHeroi} de dano em ${inimigoAtual.nome}.`;
        adicionarNotificacao(mensagemDano);
    }
    
    document.getElementById('enemyHP').textContent = `${inimigoAtual.hp}/${inimigoAtual.hpMax}`;
    
    if(inimigoAtual.hp <= 0){
        const ouroGanhos = Math.floor(Math.random()*(inimigoAtual.gold[1]-inimigoAtual.gold[0]+1))+inimigoAtual.gold[0];
        heroi.gold += ouroGanhos;
        
        // XP com multiplicador de rebirth
        const xpBase = Math.floor((10 + Math.floor(Math.random() * 10)) * (1 + heroi.lv * 0.001));
        const xpGanhos = Math.floor(xpBase * (heroi.xpMultiplier || 1));
        heroi.xp += xpGanhos;
        
        adicionarNotificacao(`üéâ Inimigo ${inimigoAtual.nome} derrotado! Ganhou ${ouroGanhos} ouro e ${xpGanhos} XP!`, 'important');

        // Drop de itens
        if (inimigoAtual.drops && inimigoAtual.drops.length > 0) {
            for(const [itemName, dropChance] of inimigoAtual.drops){
                if (Math.random() < dropChance) {
                    const itemDrop = ITEMS.find(i => i.nome === itemName);
                    if (itemDrop) {
                        let invItem = heroi.inventory.find(i=>i.id===itemDrop.id);
                        if(invItem){
                            invItem.quantidade = (invItem.quantidade || 1) + 1;
                        } else {
                            heroi.inventory.push({ ...itemDrop, quantidade:1 });
                        }
                        
                        const isBossItem = itemDrop.id.includes('boss_item');
                        if (isBossItem) {
                            adicionarNotificacao(`üéÅ VOC√ä ENCONTROU UM ITEM RARO: ${itemDrop.nome}!`, 'important');
                        } else {
                            adicionarNotificacao(`Voc√™ recebeu: ${itemDrop.nome}!`);
                        }
                    }
                }
            }
        }

        // Subir de n√≠vel com escalonamento para n√≠veis altos
        const xpNecessaria = heroi.lv * 50 * (1 + Math.floor(heroi.lv / 100) * 0.5);
        if(heroi.xp >= xpNecessaria) {
            heroi.lv++;
            heroi.xp -= xpNecessaria;
            
            heroi.maxHp += 10 + Math.floor(heroi.lv / 50);
            heroi.hp = heroi.maxHp;
            heroi.maxMp += 5 + Math.floor(heroi.lv / 100);
            heroi.mp = heroi.maxMp;
            
            heroi.atk += 1 + Math.floor(heroi.lv / 200);
            heroi.def += 1 + Math.floor(heroi.lv / 200);
            heroi.crit += 0.5 + (Math.floor(heroi.lv / 500) * 0.1);
            
            if (heroi.lv > 10000) {
                heroi.lv = 10000;
            }
            
            adicionarNotificacao(`üèÜ Parab√©ns! Voc√™ subiu para o n√≠vel ${heroi.lv}!`, 'important');
            
            // Verifica se pode fazer rebirth
            if (heroi.lv >= 1000 && heroi.lv % 100 === 0) {
                setTimeout(verificarRebirth, 1000);
            }
        }
        
        atualizarInventario();
        atualizarStatus();
        salvarNoLocalStorage();

        inimigoAtual=null;
        document.getElementById('enemyIcon').textContent='?';
        document.getElementById('enemyNome').textContent='Nenhum inimigo';
        document.getElementById('enemyHP').textContent='0/0';
        document.getElementById('enemyMaxHP').textContent='0';
        document.getElementById('btnAtacar').disabled=true;
        document.getElementById('btnSair').disabled = true;
        return;
    }
    
    if (!isBloqueado) {
        const ataqueInimigo = parseInt(inimigoAtual.atk) || 5;
        const defesaHeroi = parseInt(heroi.def) || 5;
        const danoInimigo = calcularDano(ataqueInimigo, defesaHeroi, Math.max(1, heroi.lv/10));
        
        heroi.hp -= danoInimigo;
        if(heroi.hp < 0) heroi.hp = 0;
        
        // REMOVIDO: anima√ß√£o de dano no jogador (azul)
        // mostrarAnimacaoDano(danoInimigo, 'player', document.getElementById('lutaSistema'), false, false);
        
        adicionarNotificacao(`${inimigoAtual.nome} contra-atacou e causou ${danoInimigo} de dano em voc√™!`, 'warning');
        
        if(heroi.hp <= 0){
            adicionarNotificacao('üíÄ Voc√™ foi derrotado! Recuperando HP e MP...', 'warning');
            heroi.hp = heroi.maxHp;
            heroi.mp = heroi.maxMp;
            atualizarStatus();
            salvarNoLocalStorage();
            return;
        }
    }
    
    atualizarStatus();
    salvarNoLocalStorage();
}

// ========================
// Inicializa a loja
// ========================
mostrarItens();

// ========================
// Atualiza a UI
// ========================

function atualizarStatus() {
    document.getElementById('hpLabel').textContent = `${heroi.hp}/${heroi.maxHp}`;
    document.getElementById('hpBar').style.width = (heroi.hp / heroi.maxHp * 100) + '%';

    document.getElementById('mpLabel').textContent = `${heroi.mp}/${heroi.maxMp}`;
    document.getElementById('mpBar').style.width = (heroi.mp / heroi.maxMp * 100) + '%';

    const xpNecessaria = heroi.lv * 50 * (1 + Math.floor(heroi.lv / 100) * 0.5);
    document.getElementById('xpLabel').textContent = `${Math.floor(heroi.xp)} / ${Math.floor(xpNecessaria)}`;
    document.getElementById('xpBar').style.width = Math.min(100, (heroi.xp / xpNecessaria * 100)) + '%';

    const rebirthText = heroi.rebirthCount > 0 ? `<span class="rebirth-indicator">Rebirth ${heroi.rebirthCount}</span>` : '';
    document.getElementById('rankTag').innerHTML = `Nv ${heroi.lv} ${rebirthText}`;
    document.getElementById('goldVal').textContent = heroi.gold.toLocaleString();
    document.getElementById('atkVal').textContent=heroi.atk;
    document.getElementById('defVal').textContent=heroi.def;
    document.getElementById('critVal').textContent=heroi.crit.toFixed(1)+'%';
    document.getElementById('blocoVal').textContent=heroi.bloco.toFixed(1)+'%';

    const weaponName = heroi.equipWeapon ? heroi.equipWeapon.nome : 'Nenhuma';
    const weaponStats = heroi.equipWeapon ? formatarAtributosVisiveis(heroi.equipWeapon) : '';
    document.getElementById('eq-weapon').innerHTML = weaponName + ' ' + weaponStats;
    document.getElementById('btn-desequipar-weapon').style.display = heroi.equipWeapon ? 'inline-block' : 'none';

    const offhandName = heroi.equipOffhand ? heroi.equipOffhand.nome : 'Nenhum';
    const offhandStats = heroi.equipOffhand ? formatarAtributosVisiveis(heroi.equipOffhand) : '';
    document.getElementById('eq-offhand').innerHTML = offhandName + ' ' + offhandStats;
    document.getElementById('btn-desequipar-offhand').style.display = heroi.equipOffhand ? 'inline-block' : 'none';

    const amuletName = heroi.equipAmulet ? heroi.equipAmulet.nome : 'Nenhum';
    const amuletStats = heroi.equipAmulet ? formatarAtributosVisiveis(heroi.equipAmulet) : '';
    document.getElementById('eq-amulet').innerHTML = amuletName + ' ' + amuletStats;
    document.getElementById('btn-desequipar-amulet').style.display = heroi.equipAmulet ? 'inline-block' : 'none';

    atualizarInventario();
    salvarNoLocalStorage();
}

// ========================
// Carregar o estado salvo ao iniciar
// ========================
if(heroi.inventory.length === 0) {
heroi.inventory.push({ ...itemInicialArma, quantidade: 1 });
heroi.inventory.push({ ...itemInicialPocao, quantidade: 1 });
heroi.equipWeapon = itemInicialArma;
heroi.crit += itemInicialArma.crit || 0;
}
carregarDoLocalStorage();
atualizarStatus();
</script>
</body>
</html>
